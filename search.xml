<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>Vueå­¦ä¹ ä¹‹å®ç°Vuexæ ¸å¿ƒğŸ”</title>
      <link href="/blog/2019/05/03/vue%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%AE%9E%E7%8E%B0vuex%E6%A0%B8%E5%BF%83/"/>
      <url>/blog/2019/05/03/vue%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%AE%9E%E7%8E%B0vuex%E6%A0%B8%E5%BF%83/</url>
      <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¿™ç¯‡ç¬”è®°åº”è¯¥æ˜¯æ¥ç€Reduxæ ¸å¿ƒæ¥å†™çš„,å› ä¸ºä¸¤è€…ä½œç”¨ç›¸åŒ, éƒ½æ˜¯ç”¨æ¥åšçŠ¶æ€ç®¡ç†çš„, ä¸è¿‡æ— å¥ˆè¦å­¦çš„ä¸œè¥¿å¤ªå¤š, vuexæ ¸å¿ƒä¸€ç›´ææµ…åˆ°ä»Šå¤©, åºŸè¯ä¸å¤šè¯´, æˆ‘ä»¬æ‹¿ä¸€ç™¾å¤šè¡Œä»£ç æ¥ç®€å•ä¸€æ­¥æ­¥å®ç°ä¸‹ğŸ‘‡, å®Œæ•´ä»£ç æ‰”<a href="https://github.com/HanRenHui/Vuex" target="_blank" rel="noopener">githubä»“åº“</a></p><h1 id="Vuexçš„çŠ¶æ€"><a href="#Vuexçš„çŠ¶æ€" class="headerlink" title="Vuexçš„çŠ¶æ€"></a>Vuexçš„çŠ¶æ€</h1><p>æƒ³æƒ³æˆ‘ä»¬åœ¨ä½¿ç”¨vuexä¹‹å‰, éƒ½åšäº†å“ªäº›å·¥ä½œ? </p><ul><li>Vue.use(Vuex)</li><li>å®ä¾‹åŒ– Vuex.Store</li><li>å°†storeå®ä¾‹æŒ‚è½½åˆ°vueä¸Š</li></ul><p>é‚£ä¹ˆ, åœ¨ä½¿ç”¨ä¹‹å‰ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆéº»çƒ¦å‘¢? å®ƒä»¬æ¯ä¸€æ­¥çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ ğŸ‘‡</p><ul><li>ç¬¬ä¸€æ­¥: Vue.use(Vuex), å¤§ä¼™éƒ½çŸ¥é“è°ƒç”¨Vue.useæ–¹æ³•æ—¶, Vueé»˜è®¤ä¼šè°ƒç”¨Vuexå¯¹è±¡é‡Œçš„installæ–¹æ³•, åŒæ—¶ä¼šæŠŠVueå®ä¾‹ä¼ ç»™è¯¥æ–¹æ³• ç»è¿‡è¿™ä¸€æ­¥ä»¥å, åœ¨æ‰€æœ‰Vueçš„ç»„ä»¶ä¸Šå°±éƒ½å¯ä»¥æ‹¿åˆ°$storeå¯¹è±¡äº†</li><li>ç¬¬äºŒä¸‰æ­¥: è¿™ä¸¤éƒ¨å…¶å®æ˜¯ä¸ºç¬¬ä¸€æ­¥èƒ½æ‹¿åˆ°$storeåšé“ºå«, ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´, å¾…ä¼šå°±çŸ¥é“äº†</li></ul><p>ä»¥è¿™ä¸ªä¸ºå‰æ, å’±ä»¬å¼€å§‹å†™ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¾ˆæ˜æ˜¾Vuexæ˜¯ä¸ªå¯¹è±¡, å¯¹è±¡é‡Œé¢æœ‰ä¸€ä¸ªStoreæ„é€ å‡½æ•° å¦å¤–è‚¯å®šæœ‰ä¸€ä¸ªinstallæ–¹æ³•</span></span><br><span class="line"><span class="comment">// åŒæ—¶installæ–¹æ³•åº”è¯¥ç»™æ‰€ä»¥vueç»„ä»¶å®ä¾‹ä¸Šéƒ½æŒ‚è½½ä¸€ä¸ª$storeå¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> _Vue</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">    <span class="comment">// stateç”¨æ¥å­˜æ”¾çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">let</span> state = options.state</span><br><span class="line">    <span class="comment">// ä¸ºäº†ä½¿Vuexé‡Œçš„stateå…·å¤‡å“åº”å¼çš„åŠŸèƒ½ï¼Œ æˆ‘ä»¬æŠŠå®ƒæŒ‚è½½åˆ°vueå®ä¾‹ä¸­</span></span><br><span class="line">    <span class="keyword">this</span>._vm = <span class="keyword">new</span> _Vue(&#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        state</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å½“é€šè¿‡storeå®åŠ›æ¥è°ƒç”¨stateæ—¶ ä¼šæŠŠvmä¸­çš„stateè¿”å›å›å» è¿™æ ·stateå°±å…·å¤‡</span></span><br><span class="line">  <span class="comment">// å“åº”å¼çš„åŠŸèƒ½äº†</span></span><br><span class="line">  get state() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._vm.state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue.use é»˜è®¤ä¼šè°ƒç”¨è¯¥å‡½æ•° å¹¶æŠŠVueä¼ è¿›æ¥</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">install</span>(<span class="params">Vue</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¤šæ¬¡è°ƒç”¨Vue.useåªæœ‰ä¸€æ¬¡æœ‰æ•ˆ</span></span><br><span class="line">  <span class="keyword">if</span> (_Vue) <span class="keyword">return</span> </span><br><span class="line">  _Vue = Vue</span><br><span class="line">  <span class="comment">// ç»™æ‰€æœ‰ç»„ä»¶æŒ‚è½½$storeå¯¹è±¡</span></span><br><span class="line">  <span class="comment">// æˆ‘ä»¬ç»™æ‰€æœ‰çš„vueç»„ä»¶æ··å…¥beforeCreateé’©å­å‡½æ•°</span></span><br><span class="line">  _Vue.mixin(&#123;</span><br><span class="line">    beforeCreate() &#123;</span><br><span class="line">      <span class="comment">// $optionsä¸Šå¦‚æœæœ‰storeçš„è¯è¯´æ˜æ˜¯æ ¹ç»„ä»¶ </span></span><br><span class="line">      <span class="comment">// å› ä¸ºæˆ‘ä»¬åªåœ¨æ ¹ç»„ä»¶ä¸ŠæŒ‚è½½äº†store</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.$options.store) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯æ ¹ç»„ä»¶çš„è¯ this.$storeå°±ç›´æ¥ç»‘å®šstoreå°±å¥½äº†</span></span><br><span class="line">        <span class="keyword">this</span>.$store = <span class="keyword">this</span>.$options.store</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å­ç»„ä»¶çš„è¯å› ä¸ºæ²¡æŒ‚è½½store ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡$parentæ¥ä¸çˆ¶ç»„ä»¶é€šä¿¡, ä»æ¥æ‹¿åˆ°çˆ¶ç»„ä»¶ä¸Šçš„store è¿™ä¹Ÿæ˜¯å‰è¾¹æåˆ°çš„ä¸ºä»€ä¹ˆç¬¬äºŒä¸‰æ­¥æ˜¯ä¸ºç¬¬ä¸€æ­¥åšé“ºå«çš„</span></span><br><span class="line">        <span class="keyword">this</span>.$store = <span class="keyword">this</span>.$parent &amp;&amp; <span class="keyword">this</span>.$parent.$options.store</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  Store, </span><br><span class="line">  install </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡ä¸Šè¾¹ä»£ç , æˆ‘ä»¬å·²ç»å¯ä»¥åœ¨æ‰€æœ‰ç»„ä»¶ä¸­é€šè¿‡this.$store.stateæ¥æ‹¿åˆ°vuexç®¡ç†çš„çŠ¶æ€äº†</p><h1 id="getters"><a href="#getters" class="headerlink" title="getters"></a>getters</h1><p>getterså°±åƒæ˜¯storeé‡ŒçŠ¶æ€çš„è®¡ç®—å±æ€§, çœ‹çœ‹æ€ä¹ˆå†™</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆ‘ä»¬åœ¨storeçš„æ„é€ å‡½æ•°é‡Œæ·»åŠ ä»¥ä¸‹ä»£ç  æˆ‘ä»¬æ¥çœ‹çœ‹æ¯ä¸€è¡Œéƒ½å¹²äº†å•¥</span></span><br><span class="line"><span class="comment">// 1. ä¸ºstoreå®åŠ›æ·»åŠ getterså¯¹è±¡</span></span><br><span class="line"><span class="keyword">this</span>.getters = &#123;&#125;</span><br><span class="line"><span class="comment">// çœ‹çœ‹æ˜¯å¦ä¼ å…¥getters</span></span><br><span class="line"><span class="keyword">if</span> (options.getters) &#123;</span><br><span class="line">  <span class="comment">// forEachæ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„æ–¹æ³• </span></span><br><span class="line">  forEach(options.getters, (getterName, getterFn) =&gt; &#123;</span><br><span class="line">    <span class="comment">// getterName å°±æ˜¯gettersçš„é”®å</span></span><br><span class="line">    <span class="comment">// getterFn æ˜¯gettersçš„é”®å€¼ æ˜¯ä¸€ä¸ªå‡½æ•°</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬å‰é¢è¯´getterså°±åƒæ˜¯è®¡ç®—å±æ€§ è®¡ç®—å±æ€§çš„ç‰¹ç‚¹å°±æ˜¯ æˆ‘å®šä¹‰çš„æ—¶å€™æ˜æ˜æ˜¯å‡½æ•°</span></span><br><span class="line">    <span class="comment">// è°ƒç”¨çš„æ—¶å€™æ€ä¹ˆå˜æˆå€¼æ¥ï¼Ÿ ä¸‹è¾¹çš„é€»è¾‘å°±æ˜¯å®ç°è¿™ä¸ªåŠŸèƒ½çš„</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬ç»™gettersä¸Šå®šä¹‰äº†getterNameå±æ€§ å±æ€§çš„å€¼å°±æ˜¯getterFnçš„è¿”å›å€¼</span></span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>.getters, getterName, &#123;</span><br><span class="line">      get() &#123;</span><br><span class="line">        <span class="keyword">return</span> getterFn(state)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// forEachæ–¹æ³•ç”¨äºä¾¿åˆ©ä¼ å…¥çš„å¯¹è±¡ è€Œå¯¹è±¡çš„æ“ä½œåˆ™ç”±å¤–ç•Œä¼ å…¥çš„æ„é€ å‡½æ•°å†³å®š</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">forEach</span>(<span class="params">getters, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> getters) &#123;</span><br><span class="line">    callback(key, getters[key])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Mutationså’ŒActions"><a href="#Mutationså’ŒActions" class="headerlink" title="Mutationså’ŒActions"></a>Mutationså’ŒActions</h1><p>æŠŠstateå­˜æ”¾åœ¨storeä¸­, å¹¶ä½¿å…¶å…·å¤‡å“åº”å¼çš„åŠŸèƒ½è¿™æ˜¯æœ€æœ€åŸºæœ¬çš„, ä½†æ˜¯ç›®å‰æˆ‘ä»¬åªæ˜¯å¯ä»¥æŠŠstoreä¸­çš„æ•°æ®å–å‡ºæ¥, ä½†æ˜¯ä¸èƒ½æ”¹å•Š, storeé‡Œçš„mutationså’Œactionså°±æ˜¯ç”¨æ¥ä¿®æ”¹æ•°æ®çš„, é‚£ä¹ˆä»–ä»¬æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ Vuexè§„å®š æ‰€æœ‰å¼‚æ­¥æ“ä½œåªèƒ½åœ¨actionsé‡Œè¿›è¡Œ å¹¶ä¸” æƒ³è¦ä¿®æ”¹storeé‡Œçš„çŠ¶æ€, å¿…é¡»è¦é€šè¿‡mutations , å¦‚æœå¯¹storeé‡Œçš„çŠ¶æ€åªæœ‰åŒæ­¥æ“ä½œ, å¯ä»¥ç›´æ¥é€šè¿‡mutationæ¥ä¿®æ”¹è€Œæ— éœ€ç»è¿‡actionsè½¬å‘</p><h2 id="MutationsåŸºæœ¬å®ç°"><a href="#MutationsåŸºæœ¬å®ç°" class="headerlink" title="MutationsåŸºæœ¬å®ç°"></a>MutationsåŸºæœ¬å®ç°</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒæ · æˆ‘ä»¬åœ¨storeæ„é€ å‡½æ•°é‡Œæ·»åŠ ä»¥ä¸‹ä»£ç </span></span><br><span class="line"><span class="keyword">this</span>.mutations = &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (options.mutations) &#123;</span><br><span class="line">    <span class="comment">// å°†æ‰€æœ‰mutationå‡½æ•°åœ¨this.mutationså¯¹è±¡é‡Œå­˜å¥½ ç­‰å¾…commitæ¥è°ƒç”¨</span></span><br><span class="line">    forEach(options.mutations, (mutationName, mutationFn) =&gt; &#123;</span><br><span class="line">        <span class="keyword">this</span>.mutations[mutationName] = <span class="function">(<span class="params">...params</span>) =&gt;</span> &#123;</span><br><span class="line">          mutationFn(state, ...params)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†commitå®šä¹‰åœ¨storeçš„prototypeå¯¹è±¡ä¸­</span></span><br><span class="line"><span class="comment">// commitå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æƒ³è¦è°ƒç”¨çš„mutationçš„å‡½æ•°å</span></span><br><span class="line"><span class="comment">// è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ç»„ä»¶ä¸­é€šè¿‡$store.commit()æ¥è°ƒç”¨mutationäº†</span></span><br><span class="line">commit(mutationName, ...params) &#123;</span><br><span class="line">  <span class="keyword">this</span>.mutations[mutationName](...params)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ActionsåŸºæœ¬å®ç°"><a href="#ActionsåŸºæœ¬å®ç°" class="headerlink" title="ActionsåŸºæœ¬å®ç°"></a>ActionsåŸºæœ¬å®ç°</h2><p>ç¨å¾®å›å¿†ä¸‹actionçš„åŸºæœ¬ä½¿ç”¨ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»„ä»¶é‡Œè°ƒç”¨storeå®ä¾‹ä¸Šçš„dispatch </span></span><br><span class="line"><span class="keyword">this</span>.$store.dispatch(<span class="string">'asyncAdd'</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// actions</span></span><br><span class="line">actions: &#123;</span><br><span class="line">  asyncAdd(&#123;commit&#125;, payload) &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      commit(<span class="string">'add'</span>, payload)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>æ ¹æ®å®ä¾‹æˆ‘ä»¬æ¥å†™actions</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.actions = &#123;&#125;</span><br><span class="line"><span class="keyword">if</span> (options.actions) &#123;</span><br><span class="line">  <span class="comment">// å’Œmutationsä¸€æ ·, å°†actionsé‡Œçš„æ‰€æœ‰å‡½æ•°ä¹Ÿä¿å­˜èµ·æ¥ç­‰å¾…dispatchè°ƒç”¨ </span></span><br><span class="line">  forEach(options.actions, (actionName, actionFn) =&gt; &#123;</span><br><span class="line">    <span class="keyword">this</span>.actions[actionName] = <span class="function">(<span class="params">...params</span>) =&gt;</span> &#123;</span><br><span class="line">      actionFn(<span class="keyword">this</span>, ...params)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">commit(mutationName, ...params) &#123;</span><br><span class="line">  <span class="keyword">this</span>.mutations[mutationName](...params)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç çœ‹èµ·æ¥æ²¡å•¥é—®é¢˜, ä½†æ˜¯åœ¨actioné‡Œè°ƒç”¨commitå°±å‡ºé—®é¢˜äº†, commitåœ¨è°ƒç”¨çš„æ—¶å€™æ˜¯windowsè°ƒç”¨çš„, æ‰€ä»¥thiså°±ä¸æŒ‡å‘storeå®ä¾‹å‘¢, é‚£æˆ‘ä»¬æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ<br>æ–¹æ¡ˆä¸€: åœ¨ç»™actionFnä¼ å…¥commitçš„æ—¶å€™ å°±ç”¨bindæŠŠcommitçš„thisæŒ‡å‘ç»‘æ­»</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">forEach(options.actions, (actionName, actionFn) =&gt; &#123;</span><br><span class="line">  <span class="keyword">this</span>.actions[actionName] = <span class="function">(<span class="params">...params</span>) =&gt;</span> &#123;</span><br><span class="line">    actionFn(&#123;<span class="attr">commit</span>: <span class="keyword">this</span>.commit.bind(<span class="keyword">this</span>)&#125;, ...params)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ–¹æ¡ˆäºŒ: åœ¨å®ä¾‹é‡Œæ·»åŠ ä¸€ä¸ªåŒåæ–¹æ³• åœ¨åˆšæ–¹æ³•ä¸­é€šè¿‡callè°ƒç”¨prototypeä¸Šçš„æ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (options.actions) &#123;</span><br><span class="line">  forEach(options.actions, (actionName, actionFn) =&gt; &#123;</span><br><span class="line">    <span class="keyword">this</span>.actions[actionName] = <span class="function">(<span class="params">...params</span>) =&gt;</span> &#123;</span><br><span class="line">      actionFn(<span class="keyword">this</span>, ...params)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ·»åŠ ä»¥ä¸‹ä»£ç </span></span><br><span class="line"><span class="keyword">this</span>.commit = <span class="function">(<span class="params">type, ...rest</span>) =&gt;</span> &#123;</span><br><span class="line">  commit.call(<span class="keyword">this</span>, type, ...rest)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨storeå®ä¾‹ä¸Šæ·»åŠ äº†commitæ–¹æ³• å› ä¸ºä¸prototypeä¸Šçš„commité‡å æ‰€ä»¥åœ¨actionå‡½æ•°å†…éƒ¨è§£æ„å‡ºæ¥çš„commitå°±æ˜¯å®ä¾‹ä¸Šçš„commitæ–¹æ³• è€Œæˆ‘ä»¬é€šè¿‡å®ä¾‹æ¥è°ƒç”¨prototypeä¸Šçš„commitæ–¹æ³• å› ä¸ºæ˜¯å®ä¾‹è°ƒç”¨çš„ æ‰€ä»¥commitå†…éƒ¨çš„thiså°±æ˜¯æŒ‡å‘å®ä¾‹</p><p><strong>ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç»å®ç°äº†ç¬¬ä¸€ç‰ˆçš„Vuex, åŸºæœ¬å®ç°äº†é€šè¿‡stateè·å–çŠ¶æ€ mutationså’Œactionsä¿®æ”¹çŠ¶æ€, æ¥ä¸‹æ¥å®ç°ç¬¬äºŒç‰ˆ, ä¹Ÿå°±æ˜¯å®˜æ–¹æ­£ç‰ˆ</strong></p><p>ç¬¬äºŒç‰ˆæ¯”èµ·ç¬¬ä¸€ç‰ˆå¤šäº†modulesé€‰é¡¹, çœ‹ä¸€ä¸ªè¶³å¤Ÿæ¶å¿ƒäººçš„ä¾‹å­ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  modules: &#123;</span><br><span class="line">    a2: &#123;</span><br><span class="line">      state: &#123;</span><br><span class="line">        count: <span class="number">200000</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    a: &#123;</span><br><span class="line">      state: &#123;</span><br><span class="line">        count: <span class="number">10</span></span><br><span class="line">      &#125;,</span><br><span class="line">      mutations: &#123;</span><br><span class="line">        change(state) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'a-------------change'</span>);</span><br><span class="line">          state.count = state.count + <span class="number">100</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      modules: &#123;</span><br><span class="line">        b: &#123;</span><br><span class="line">          state: &#123;</span><br><span class="line">            count: <span class="number">300</span></span><br><span class="line">          &#125;,</span><br><span class="line">          mutations: &#123;</span><br><span class="line">            change(state) &#123;</span><br><span class="line">              <span class="built_in">console</span>.log(<span class="string">'b-----------change'</span>);</span><br><span class="line">              state.count = state.count + <span class="number">100</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          modules: &#123;</span><br><span class="line">            c: &#123;</span><br><span class="line">              state: &#123;</span><br><span class="line">                count: <span class="number">4000</span></span><br><span class="line">              &#125;,</span><br><span class="line">              mutations: &#123;</span><br><span class="line">                change(state) &#123;</span><br><span class="line">                  <span class="built_in">console</span>.log(<span class="string">'c-----------change'</span>);</span><br><span class="line">                  state.count = state.count + <span class="number">100</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;,</span><br><span class="line">              getters: &#123;</span><br><span class="line">                mycount(state) &#123;</span><br><span class="line">                  <span class="keyword">return</span> state.count + <span class="number">100000</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  state: &#123;</span><br><span class="line">    count: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  getters</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™ç¬¬ä¸€ç‰ˆçš„storeå¾ˆæ˜æ˜¾å·²ç»holdä¸ä½äº†, æ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦é‡æ„ç¬¬ä¸€ä¸ªç‰ˆæœ¬, ä½¿å…¶èƒ½å¤Ÿæ”¯æŒmodulesé€‰é¡¹</p><h1 id="é‡æ„Vuex"><a href="#é‡æ„Vuex" class="headerlink" title="é‡æ„Vuex"></a>é‡æ„Vuex</h1><p>é‡æ„ä¸»è¦æ˜¯é’ˆå¯¹state getters mutations actionsæ¥é‡æ„, å…¶ä»–éƒ¨åˆ†ä¸å˜<br>é¦–å…ˆæˆ‘ä»¬å…ˆæŠŠæ•´ä¸ªstoreçš„optionsåˆ†ææˆä¸€ä¸ªä¸‹é¢è¿™ç§ç»“æ„: </p><p><img src="1.png" alt=""></p><p>æ˜¯ä¸æ˜¯é•¿å¾—è´¼å“äºº? ä¸è¿‡ä¸è¦æ€•, åˆ†æä¸‹è¿™ä¸ªç»“æ„å°±å¾ˆç®€å•äº†, é¦–å…ˆæ˜¯ä¸€ä¸ªæ ¹å¯¹è±¡å«root, rooté‡Œæœ‰ä¸‰ä¸ªå±æ€§, åˆ†åˆ«æ˜¯: </p><ul><li>_raw:  é‡Œé¢è£…ç€ getters actions mutationsè¿™äº›å±æ€§</li><li>_children æ²¡æœ‰modulesé€‰é¡¹çš„è¯ è¿™ä¸ªå±æ€§å°±æ˜¯ç©º æœ‰moduleçš„è¯ é‡Œé¢è£…ç€ä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡, é”®  åæ˜¯æ¨¡å—å, é”®å€¼æ˜¯å¯¹è±¡ å¯¹è±¡é‡Œåˆå­˜ç€_raw _children _stateä¸‰ä¸ªå¯¹è±¡ ç„¶åchildrenå¯¹è±¡ä¸€ç›´è¿™ä¹ˆå¾ªç¯ä¸‹å» </li><li>_state è£…ç€å±äºå½“å‰æ¨¡å—çš„çŠ¶æ€</li></ul><p>ç»è¿‡ä¸Šé¢çš„åˆ†æ æ˜¯ä¸æ˜¯å°±ç®€å•å¤šäº†ï¼Ÿ å°±æ˜¯childrené‚£é‡Œè¦é€’å½’ä¸€ä¸‹è€Œå·², çœ‹ä»£ç å®ç°ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModuleCollection</span> </span>&#123;</span><br><span class="line">  <span class="comment">// optionså°±æ˜¯è£…ç€state actions mutations modulesçš„é‚£ä¸ªå¯¹è±¡</span></span><br><span class="line">  contructor(options) &#123;</span><br><span class="line">    <span class="comment">// é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥è§£æoptions</span></span><br><span class="line">    <span class="keyword">this</span>.register([], options)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// pathæ˜¯ä¸ªæ¨¡å—è·¯å¾„æ•°ç»„ ç©ºæ•°ç»„è¡¨ç¤ºæ ¹ </span></span><br><span class="line">  <span class="comment">// [a] è¡¨ç¤ºæ ¹è·¯å¾„ä¸‹çš„aæ¨¡å— [a, b] è¡¨ç¤ºaæ¨¡å—ä¸‹çš„bæ¨¡å—</span></span><br><span class="line">  register(path, rawModule) &#123;</span><br><span class="line">    <span class="keyword">let</span> newModule = &#123;</span><br><span class="line">      <span class="comment">// _rawçš„å€¼å°±æ˜¯è£…ç€å±äºè¯¥æ¨¡å—çš„å¯¹è±¡äº† </span></span><br><span class="line">      <span class="comment">// è¯¥å¯¹è±¡é‡Œæœ‰å±äºè¯¥æ¨¡å—çš„state actions mutations modules</span></span><br><span class="line">      _raw: rawModule,</span><br><span class="line">      <span class="comment">// å±äºæœ¬æ¨¡å—çš„state</span></span><br><span class="line">      state: rawModule.sate,</span><br><span class="line">      <span class="comment">// è£…ç€å±äºè¯¥æ¨¡å—çš„å­æ¨¡å— æ²¡æœ‰åˆ™ä¸ºç©ºå¯¹è±¡</span></span><br><span class="line">      _children: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// pathä¸º0 è¯´æ˜ä¸ºæ ¹æ¨¡å— éœ€è¦æ–°å»ºä¸ªroot root æœ‰_raw state _childrenä¸‰ä¸ªå±æ€§</span></span><br><span class="line">    <span class="keyword">if</span> (path.length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.root = newModule</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// è¿™å››è¡Œä»£ç æ˜¯æ ¸å¿ƒæ‰€åœ¨ æˆ‘ä»¬ä»”ç»†æ¥è¯´ä¸‹:</span></span><br><span class="line">      <span class="comment">// pathä¸º[a]çš„æ—¶å€™ parentå°±æ˜¯this.root</span></span><br><span class="line">      <span class="comment">// pathä¸º[a, b]çš„æ—¶å€™ , parentå°±æ˜¯this.root._children.a </span></span><br><span class="line">      <span class="comment">// pathä¸º[a, b, c]çš„æ—¶å€™, parentæ˜¯this.root._children.a._children.b</span></span><br><span class="line">      <span class="keyword">let</span> parent = path.slice(<span class="number">0</span>, <span class="number">-1</span>).reduce(<span class="function">(<span class="params">root, <span class="built_in">module</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> root._children[<span class="built_in">module</span>]</span><br><span class="line">      &#125;, <span class="keyword">this</span>.root)</span><br><span class="line">      <span class="comment">// æ¥ä¸Šé¢ pathä¸ºa parentå¸ˆthis.root æ‰€ä»¥è¿™è¡Œä»£ç å°±æ˜¯this.root._children.a = newModule</span></span><br><span class="line">      <span class="comment">// pathä¸º[a, b, c] è¿™è¡Œä»£ç å°±æ˜¯this.root_children.a._children.c = newModule</span></span><br><span class="line">      parent._children[path[path.length<span class="number">-1</span>]] = newModule</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (rawModule.modules) &#123;</span><br><span class="line">      forEach(rawModule.modules, (moduleName, <span class="built_in">module</span>) =&gt; &#123;</span><br><span class="line">        register(path.concat(moduleName), <span class="built_in">module</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// this.moduleå°±æ˜¯æˆ‘ä»¬è¦çš„é‚£ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="keyword">this</span>.module = <span class="keyword">new</span> ModuleCollection(options)</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦æ ¹æ®è¿™ä¸ªå¯¹è±¡æ¥ç»™storeå®ä¾‹ä¸Šç»‘å±æ€§äº†, å…ˆæ¥æƒ³æƒ³è¯¥æ€ä¹ˆç»‘, é¦–å…ˆæƒ³æƒ³æˆ‘ä»¬å¹³æ—¶åœ¨ä½¿ç”¨modulesé‡Œçš„å±æ€§çš„æ—¶å€™æ˜¯æ€ä¹ˆæ ·çš„ğŸ‘‡</p><ul><li>é¦–å…ˆæ˜¯çŠ¶æ€state, æˆ‘ä»¬æƒ³è¦è·å–æ ¹æ¨¡å—ä¸‹çš„çŠ¶æ€, åœ¨æˆ‘ä»¬ä¸Šé¢é‚£ä¸ªä¾‹å­ä¸­ä¹Ÿå°±æ˜¯countå€¼, å°±ç›´æ¥<code>this.$store.state.count</code>å–å°±å¥½äº†, è¦æ˜¯æ ¹æ¨¡å—ä¸‹çš„aæ¨¡å—é‡Œçš„countå‘¢ï¼Ÿ <code>this.$store.state.a.count</code>, ä¾æ¬¡ç±»æ¨, å¥½äº†, å’±ä»¬ç°åœ¨å…ˆå®ç°é€šè¿‡æ¨¡å—å–çŠ¶æ€è¿™éƒ¨åˆ†åŠŸèƒ½ğŸ‘‡</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">installModule(<span class="keyword">this</span>, state, [], <span class="keyword">this</span>.module.root)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; store å°±æ˜¯é‚£ä¸ªstoreå®ä¾‹</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; rootState æ ¹ä¸Šçš„state</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; path  [a, b, c] è·¯å¾„æ•°ç»„</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; rootModule  // &#123;_raw, _children, state&#125;é‚£ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">installModule</span>(<span class="params">store, rootState, path, rootModule</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (path.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªå‡½æ•°å’Œä¸Šè¾¹é‚£ä¸ªæ˜¯ä¸€æ ·çš„</span></span><br><span class="line">    <span class="comment">// å½“pathä¸º[a]çš„æ—¶å€™ parentå°±æ˜¯ rootStateä¹Ÿå°±æ˜¯this.$store.state</span></span><br><span class="line">    <span class="comment">// å½“pathä¸º[a, b]çš„æ—¶å€™ parentå°±æ˜¯ rootState.a ä¹Ÿå°±æ˜¯this.$store.state.a</span></span><br><span class="line">    <span class="keyword">let</span> parent = path.slice(<span class="number">0</span>, <span class="number">-1</span>).reduce(<span class="function">(<span class="params">root, current</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> root[current]</span><br><span class="line">    &#125;, rootState)</span><br><span class="line">    <span class="comment">// é€šè¿‡vueæä¾›çš„setæ–¹æ³• ä½¿å¾—æ•°æ®å…·å¤‡å“åº”å¼çš„åŠŸèƒ½</span></span><br><span class="line">    _Vue.set(parent, path[path.length<span class="number">-1</span>], rootModule.state)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// parent[path[path.length-1]]</span></span><br><span class="line">  <span class="keyword">if</span> (rootModule._children) &#123;</span><br><span class="line">    forEach(rootModule._children, (moduleName, <span class="built_in">module</span>) =&gt; &#123;</span><br><span class="line">      installModule(store, rootState, path.concat(moduleName), <span class="built_in">module</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥çš„gettersæ–¹æ³• mutations actions æ–¹æ³•éƒ½å°†åœ¨installModuleè¿™ä¸ªå‡½æ•°é‡Œé‡æ„, å…ˆçœ‹getters, getterså’Œstateä¸ä¸€æ · gettersæ˜¯ä¸åˆ†æ¨¡å—çš„, ä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„æ¨¡å—ä¸‹çš„getterséƒ½æ”¾åœ¨this.$store.gettersä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤„ç†getters å¦‚æœgetterså­˜åœ¨ åˆ™ç»‘åœ¨store.gettersä¸‹</span></span><br><span class="line"><span class="keyword">if</span> (rootModule._raw.getters) &#123;</span><br><span class="line">  forEach(rootModule._raw.getters, (getterName, getterFn) =&gt; &#123;</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(store.getters, getterName, &#123;</span><br><span class="line">      get() &#123;</span><br><span class="line">        <span class="keyword">return</span> getterFn(rootModule.state)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯actionså’Œmutations, ä¹Ÿæ˜¯æœ€åä¸€éƒ¨åˆ†äº†actionså’Œmutationsä¹Ÿæ˜¯ç›´æ¥æ”¾åœ¨storeä¸‹é¢çš„, ä¸åŒçš„æ—¶å€™ å¦‚æœçˆ¶å­æ¨¡å—æœ‰é‡åçš„actionsæˆ–è€…mutations , é‡åä¸ä¼šè¦†ç›– è€Œæ˜¯å…¨éƒ¨æ‰§è¡Œ, è€Œgettersåˆ™ä¼šè¦†ç›–, çœ‹æ€ä¹ˆå†™</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (rootModule._raw.actions) &#123;</span><br><span class="line">  forEach(rootModule._raw.actions, (actionName, actionFn) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> entry = store.actions[actionName] || (store.actions[actionName] = [])</span><br><span class="line">    entry.push(<span class="function">(<span class="params">...params</span>) =&gt;</span> &#123;</span><br><span class="line">      actionFn.call(store, store, ...params)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (rootModule._raw.mutations) &#123;</span><br><span class="line">  forEach(rootModule._raw.mutations, (mutationName, mutationFn) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> entry = store.mutations[mutationName] || (store.mutations[mutationFn] = [])</span><br><span class="line">    entry.push(<span class="function">(<span class="params">...params</span>) =&gt;</span> &#123;</span><br><span class="line">      mutationFn.call(store, rootModule.state, ...params)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Vue</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModuleCollection</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123; <span class="comment">// [a, b] è¡¨æ˜aä¸­æœ‰b å¦‚æœæ˜¯ä¸ªç©ºæ•°ç»„ åˆ™è¡¨ç¤ºæ˜¯æ ¹ </span></span><br><span class="line">    <span class="comment">// æ³¨å†Œæ¨¡å— </span></span><br><span class="line">    <span class="keyword">this</span>.register([], options)</span><br><span class="line">  &#125;</span><br><span class="line">  register(path, rawModule) &#123;</span><br><span class="line">    <span class="comment">// pathæ˜¯ä¸ªç©ºæ•°ç»„ rawModuleæ˜¯ä¸ªå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">let</span> newModule = &#123;</span><br><span class="line">      _raw: rawModule, <span class="comment">// å¯¹è±¡ æœ‰state gettersé‚£ä¸ªå¯¹è±¡</span></span><br><span class="line">      _children: &#123;&#125;, <span class="comment">// ç”¨æ¥è¡¨ç¤ºè‡ªå·±çš„å­æ¨¡å—</span></span><br><span class="line">      state: rawModule.state <span class="comment">// ç”¨æ¥è¡¨ç¤ºè‡ªå·±æ¨¡å—çš„çŠ¶æ€</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯ç©ºæ•°ç»„ ä¹Ÿå°±æ˜¯æ ¹çš„è¯</span></span><br><span class="line">    <span class="keyword">if</span> (path.length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.root = newModule</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœä¸æ˜¯æ ¹çš„è¯ </span></span><br><span class="line">      <span class="comment">// å»æ‰æœ€åä¸€é¡¹</span></span><br><span class="line">      <span class="keyword">let</span> parent = path.slice(<span class="number">0</span>, <span class="number">-1</span>).reduce(<span class="function">(<span class="params">root, current</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> root._children[current]</span><br><span class="line">      &#125;, <span class="keyword">this</span>.root)</span><br><span class="line">      parent._children[path[path.length - <span class="number">1</span>]] = newModule</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rawModule.modules) &#123; <span class="comment">// æœ‰å­æ¨¡å—</span></span><br><span class="line">      <span class="comment">// debugger</span></span><br><span class="line">      forEach(rawModule.modules, (childName, <span class="built_in">module</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">this</span>.register(path.concat(childName), <span class="built_in">module</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">install</span>(<span class="params">_Vue</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// é˜²æ­¢å¤šæ¬¡use</span></span><br><span class="line">  <span class="keyword">if</span> (Vue) <span class="keyword">return</span></span><br><span class="line">  Vue = _Vue</span><br><span class="line">  Vue.mixin(&#123;</span><br><span class="line">    <span class="comment">// ç»™æ‰€æœ‰å®ä¾‹æ·»åŠ $storeé€‰é¡¹</span></span><br><span class="line">    beforeCreate() &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.$options.store) &#123;</span><br><span class="line">        <span class="comment">// æ˜¯æ ¹å®ä¾‹</span></span><br><span class="line">        <span class="keyword">this</span>.$store = <span class="keyword">this</span>.$options &amp;&amp; <span class="keyword">this</span>.$options.store</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸æ˜¯</span></span><br><span class="line">        <span class="keyword">this</span>.$store = <span class="keyword">this</span>.$parent &amp;&amp; <span class="keyword">this</span>.$parent.$options.store</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">installModule</span>(<span class="params">store, rootState, path, rootModule</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¤„ç†state æŒ‰ç…§æ¨¡å—æ·»åŠ </span></span><br><span class="line">  <span class="keyword">if</span> (path.length &gt; <span class="number">0</span>) &#123; <span class="comment">// [a, b, c]</span></span><br><span class="line">    <span class="keyword">let</span> parent = path.slice(<span class="number">0</span>, <span class="number">-1</span>).reduce(<span class="function">(<span class="params">root, current</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> root[current]</span><br><span class="line">    &#125;, rootState)</span><br><span class="line">    Vue.set(parent, path[path.length - <span class="number">1</span>], rootModule.state)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¤„ç†getters</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (rootModule._raw.getters) &#123;</span><br><span class="line">    </span><br><span class="line">    forEach(rootModule._raw.getters, (getterName, getterFn) =&gt; &#123;</span><br><span class="line">      <span class="comment">// getters æ— è®ºæ˜¯å“ªä¸ªæ¨¡å—ä¸Šçš„éƒ½ç›´æ¥æ·»åŠ åœ¨storeçš„gettersä¸Š</span></span><br><span class="line">      <span class="built_in">Object</span>.defineProperty(store.getters, getterName, &#123;</span><br><span class="line">        get() &#123;</span><br><span class="line">          <span class="keyword">return</span> getterFn(rootModule.state)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// actions å’Œ mutationsä¹Ÿä¸€æ ·ä¸åˆ†æ¨¡å—å…¨éƒ¨æ”¾åœ¨ä¸€èµ· é‡åä¸ä¼šè¦†ç›– ä¼šå…¨éƒ¨æ‰§è¡Œ</span></span><br><span class="line">  <span class="keyword">if</span> (rootModule._raw.actions) &#123;</span><br><span class="line"></span><br><span class="line">    forEach(rootModule._raw.actions, (actionName, actionFn) =&gt; &#123;</span><br><span class="line">      <span class="keyword">let</span> entry = store.actions[actionName] || (store.actions[actionName] = [])</span><br><span class="line">      entry.push(<span class="function">(<span class="params">...params</span>) =&gt;</span> &#123;</span><br><span class="line">        actionFn.call(store, store, ...params)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (rootModule._raw.mutations) &#123;</span><br><span class="line">    forEach(rootModule._raw.mutations, (mutationName, mutationFn) =&gt; &#123;</span><br><span class="line">      <span class="keyword">let</span> entry = store.mutations[mutationName] || (store.mutations[mutationName] = [])</span><br><span class="line">      entry.push(<span class="function">(<span class="params">...params</span>) =&gt;</span> &#123;</span><br><span class="line">        mutationFn.call(store, rootState, ...params)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (rootModule._children) &#123;</span><br><span class="line">    forEach(rootModule._children, (childName, <span class="built_in">module</span>) =&gt; &#123;</span><br><span class="line">      installModule(store, rootState, path.concat(childName), <span class="built_in">module</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">    <span class="keyword">let</span> state = options.state || &#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>.getters = &#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>.mutations = &#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>.actions = &#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>._vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">      data: &#123;</span><br><span class="line">        state</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// æŠŠæ¨¡å—ä¹‹é—´çš„å…³ç³»è¿›è¡Œæ•´ç†</span></span><br><span class="line">    <span class="keyword">this</span>.modules = <span class="keyword">new</span> ModuleCollection(options) <span class="comment">// &#123;_raw: &#123;&#125;, _children: &#123;a: &#123;_raw...&#125;&#125;&#125;</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.modules);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®‰è£…æ¨¡å—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    installModule(<span class="keyword">this</span>, state, [], <span class="keyword">this</span>.modules.root)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> &#123; commit, dispatch &#125; = <span class="keyword">this</span></span><br><span class="line">    <span class="comment">// è¦†ç›–å†…éƒ¨commitå’Œdispatch ä»è€Œè§£å†³thisæŒ‡å‘é—®é¢˜</span></span><br><span class="line">    <span class="keyword">this</span>.commit = <span class="function">(<span class="params">type, ...rest</span>) =&gt;</span> &#123;</span><br><span class="line">      commit.call(<span class="keyword">this</span>, type, ...rest)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.dispatch = <span class="function">(<span class="params">type, ...rest</span>) =&gt;</span> &#123;</span><br><span class="line">      dispatch.call(<span class="keyword">this</span>, type, ...rest)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  get state() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._vm.state</span><br><span class="line">  &#125;</span><br><span class="line">  commit(type, ...rest) &#123;</span><br><span class="line">    <span class="keyword">this</span>.mutations[type].forEach(<span class="function"><span class="params">m</span> =&gt;</span> m(...rest))</span><br><span class="line">  &#125;</span><br><span class="line">  dispatch(type, ...rest) &#123;</span><br><span class="line">    <span class="keyword">this</span>.actions[type].forEach(<span class="function"><span class="params">a</span> =&gt;</span> a(...rest))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">forEach</span>(<span class="params">getters, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> getters) &#123;</span><br><span class="line">    callback(key, getters[key])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  Store,</span><br><span class="line">  install</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> æºç  </category>
          
          <category> Vuex </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> æºç  </tag>
            
            <tag> Vue </tag>
            
            <tag> Vuex </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è¯´è¯´ç¼“å­˜é‚£äº›äº‹âš¡</title>
      <link href="/blog/2019/04/27/%E8%AF%B4%E8%AF%B4%E7%BC%93%E5%AD%98%E9%82%A3%E4%BA%9B%E4%BA%8B/"/>
      <url>/blog/2019/04/27/%E8%AF%B4%E8%AF%B4%E7%BC%93%E5%AD%98%E9%82%A3%E4%BA%9B%E4%BA%8B/</url>
      <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æˆ‘ä»¬éƒ½çŸ¥é“304çŠ¶æ€ç ä»£è¡¨ç€ç¼“å­˜, ä½†æ˜¯ä½ çŸ¥é“åç«¯å…·ä½“åšäº†ä»€ä¹ˆä¹ˆï¼Ÿ ä»Šå¤©æˆ‘ä»¬æ¥ç»†èŠä¸€ä¸‹</p><h1 id="ç¼“å­˜åˆ†ç±»"><a href="#ç¼“å­˜åˆ†ç±»" class="headerlink" title="ç¼“å­˜åˆ†ç±»"></a>ç¼“å­˜åˆ†ç±»</h1><p>ç¼“å­˜åˆ†ä¸º<code>å¼ºåˆ¶ç¼“å­˜</code>å’Œ<code>å¯¹æ¯”ç¼“å­˜</code>, ä½†æ˜¯å¼ºåˆ¶ç¼“å­˜å¹¶ä¸ä¼šè§¦å‘304çŠ¶æ€ç , ä½†æ˜¯åç«¯åœ¨å¤„ç†ç¼“å­˜çš„æ—¶å€™, å¼ºåˆ¶ç¼“å­˜ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ä¸€éƒ¨åˆ†; é‚£ä¹ˆå¼ºåˆ¶ç¼“å­˜å’Œå¯¹æ¯”ç¼“å­˜åˆå­˜åœ¨å“ªäº›å·®å¼‚å‘¢? å¼ºåˆ¶ç¼“å­˜è®¾ç½®ä»¥å, åœ¨ç¼“å­˜çš„æœ‰æ•ˆæ—¶é—´å†…, æµè§ˆå™¨ä¸ä¼šå†å‘æœåŠ¡å™¨å‘é€è¯·æ±‚, è€Œå¯¹æ¯”ç¼“å­˜ä¸ç®¡ç¼“å­˜æœ‰æ²¡æœ‰æ•ˆéƒ½ä¼šå»è¯·æ±‚æœåŠ¡å™¨, æœåŠ¡å™¨ç«¯å†åˆ¤æ–­è¦è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦ç»è¿‡ä¿®æ”¹, å¦‚æœæ”¹è¿‡, åˆ™é‡æ–°è¿”å›æ–°æ–‡ä»¶, å¦åˆ™çš„è¯ç›´æ¥è®¾ç½®å“åº”ç ä¸º304å¹¶ç»“æŸæœ¬æ¬¡è¯·æ±‚, æµè§ˆå™¨ä¸€çœ‹çŠ¶æ€ç æ˜¯304, å°±ä¼šè°ƒç”¨ç¼“å­˜é‡Œçš„æ–‡ä»¶, é‚£ä¹ˆå¼ºåˆ¶ç¼“å­˜å’Œå¯¹æ¯”ç¼“å­˜å…·ä½“åœ¨åç«¯æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿ ä¸æ€¥, æˆ‘ä»¬æŒ¨ä¸ªæ¥çœ‹ ğŸ‘‡</p><h1 id="å¼ºåˆ¶ç¼“å­˜"><a href="#å¼ºåˆ¶ç¼“å­˜" class="headerlink" title="å¼ºåˆ¶ç¼“å­˜"></a>å¼ºåˆ¶ç¼“å­˜</h1><p>æˆ‘ä»¬é¦–å…ˆç”¨nodeæ­ä¸€ä¸ªé™æ€æœåŠ¡å™¨ ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// promisefy ç”¨äºå°†statæ–¹æ³•promiseåŒ– </span></span><br><span class="line"><span class="keyword">let</span> stat = promisefy(fs.stat)</span><br><span class="line">http.createServer(<span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="comment">// pathnameæ˜¯å‰ç«¯è¯·æ±‚url</span></span><br><span class="line">  <span class="keyword">let</span> &#123; pathname &#125; = url.parse(req.url)</span><br><span class="line">  <span class="comment">// æ ¹æ®è¯·æ±‚urlæ‰¾åˆ°æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line">  <span class="keyword">let</span> filename = path.join(__dirname, pathname)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span>&#123; </span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">await</span> stat(filename)</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯ä¸æ˜¯æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (result.isFile()) &#123;</span><br><span class="line">      <span class="comment">// è®¾ç½®å“åº”ä½“çš„ç±»å‹, mime.getTypeæ–¹æ³•å¯ä»¥æ ¹æ®æ–‡ä»¶åè¿”å›å¯¹åº”çš„contenttype </span></span><br><span class="line">      res.setHeader(<span class="string">'Content-Type'</span>, mime.getType(filename) + <span class="string">'charset; utf8'</span>)</span><br><span class="line">      <span class="comment">// å°†è¯»å–çš„å†…å®¹pipeåˆ°resä¸­</span></span><br><span class="line">      <span class="keyword">return</span> fs.createReadStream(filename).pipe(res)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="comment">// å‡ºé”™è¡¨ç¤ºæœªæ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">return</span> res.end(<span class="string">'Not Fount'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">res.end()</span><br><span class="line">&#125;).listen(<span class="number">3001</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'server is working on the http://localhost:3001'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬æ·»åŠ å¼ºåˆ¶ç¼“å­˜, å¼ºåˆ¶ç¼“å­˜è®¾ç½®å¾ˆç®€å•, ç›´æ¥å¤šè®¾ç½®ä¸€ä¸ªè¯·æ±‚å¤´å°±å¥½äº†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®è¿‡æœŸæ—¶é—´, 10s æœ‰æ•ˆæ—¶é—´</span></span><br><span class="line">res.setHeader(<span class="string">'Cache-Control'</span>, <span class="string">'max-age=10'</span>)</span><br><span class="line"><span class="comment">// å…¼å®¹æ—§çš„æµè§ˆå™¨ ä¹Ÿæ˜¯ 10sæœ‰æ•ˆæ—¶é—´</span></span><br><span class="line">res.setHeader(<span class="string">'Expires'</span>, <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">Date</span>.now() + <span class="number">10</span>*<span class="number">1000</span>).toGMTString())</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„htmlæ–‡ä»¶</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/timg.jpg"</span> <span class="attr">alt</span>=<span class="string">"èƒŒæ™¯å›¾"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬è®¾ç½®äº†å¼ºåˆ¶ç¼“å­˜, åœ¨åœ°å€æ ä¸­è¾“å…¥ <a href="http://localhost:3001/index.html" target="_blank" rel="noopener">http://localhost:3001/index.html</a> ç¬¬ä¸€æ¬¡è¯·æ±‚æ²¡ä»€ä¹ˆå˜åŒ–, å†æ­¤è¯·æ±‚çš„æ—¶å€™å°±ä¼šå˜æˆä¸‹å›¾è¿™æ ·</p><figure class="image-box">                <img src="1.png" alt="" title="" class="">                <p></p>            </figure><p>æœ‰äººå¯èƒ½ä¼šé—®äº†, æ€ä¹ˆåªæœ‰imgæ–‡ä»¶æ˜¾ç¤ºæ˜¯æ¥è‡ªç¼“å­˜å•Šï¼Ÿ å…¶å®å¼ºåˆ¶ç¼“å­˜åªæœ‰å¯¹htmlæ–‡ä»¶é‡Œç±»ä¼¼imgè¿™æ ·çš„æ ‡ç­¾æ˜¯æœ‰ç”¨çš„, è€Œä¸”ç›¸åº”çš„çŠ¶æ€ç ä¹Ÿå¹¶ä¸ä¼šæ˜¾ç¤º304</p><h2 id="å¼ºåˆ¶ç¼“å­˜çš„é—®é¢˜"><a href="#å¼ºåˆ¶ç¼“å­˜çš„é—®é¢˜" class="headerlink" title="å¼ºåˆ¶ç¼“å­˜çš„é—®é¢˜"></a>å¼ºåˆ¶ç¼“å­˜çš„é—®é¢˜</h2><p>å¼ºåˆ¶ç¼“å­˜æœ€å¤§çš„é—®é¢˜å°±æ˜¯ä¸ç®¡è¦è¯·æ±‚çš„æ–‡ä»¶å†…å®¹å˜æ²¡å˜, åªè¦åœ¨ç¼“å­˜çš„æœ‰æ•ˆæ—¶é—´å†…å°±ä¸ä¼šé‡æ–°è¯·æ±‚æœåŠ¡å™¨, è¿™æ ·æ˜¾ç„¶ä¸å¤ªåˆé€‚, å› ä¸ºå¾ˆå¯èƒ½æ–‡ä»¶æ—©å°±è¢«ä¿®æ”¹äº†, è€Œæµè§ˆå™¨è¿˜åœ¨ä¹å‘µå‘µåœ°ä½¿ç”¨æ—§æ•°æ®</p><h1 id="å¯¹æ¯”ç¼“å­˜"><a href="#å¯¹æ¯”ç¼“å­˜" class="headerlink" title="å¯¹æ¯”ç¼“å­˜"></a>å¯¹æ¯”ç¼“å­˜</h1><p>å¯¹æ¯”ç¼“å­˜å°±æ˜¯æ¥è§£å†³å¼ºåˆ¶ç¼“å­˜çš„é—®é¢˜çš„, å¯¹æ¯”ç¼“å­˜å°±ç®—æ–‡ä»¶åœ¨ç¼“å­˜çš„æœ‰æ•ˆæœŸå†…, æµè§ˆå™¨ä¹Ÿè¿˜æ˜¯ä¼šå‘æœåŠ¡å™¨é‡æ–°è¯·æ±‚æ•°æ®, å†ç”±æœåŠ¡å™¨å†³å®šè¯¥ä¸è¯¥è®©æµè§ˆå™¨ä½¿ç”¨ç¼“å­˜, é‚£å…·ä½“æ€ä¹ˆå®ç°å‘¢ï¼Ÿ å¤§ä½“æ€è·¯å°±æ˜¯ <strong>å®¢æˆ·ç«¯åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡ç«¯çš„æ—¶å€™, æœåŠ¡ç«¯ä¼šå°†æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´(Last-Modified)å†™å…¥å“åº”å¤´, ä¸‹æ¬¡å®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶å€™æ‹¿ç€è¿™ä¸ªæœ€åä¿®æ”¹æ—¶é—´(if-modified-since)å»æ‰¾æœåŠ¡å™¨, æœåŠ¡å™¨æŸ¥ä¸€ä¸‹è¦è¯·æ±‚çš„æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´å’Œå®¢æˆ·ç«¯æ‰‹é‡Œæ‹¿çš„æ˜¯ä¸æ˜¯ä¸€æ ·, ä¸€æ ·åˆ™é€šçŸ¥æµè§ˆå™¨èµ°ç¼“å­˜, å¦åˆ™è¿”å›æ–°å†…å®¹</strong><br>é‚£ä¹ˆ, ç”¨ä»£ç æ€ä¹ˆå†™å‘¢ï¼Ÿ ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">http.createServer(<span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; pathname &#125; = url.parse(req.url)</span><br><span class="line">  <span class="built_in">console</span>.log(pathname);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> filename = path.join(__dirname, pathname)</span><br><span class="line">  <span class="comment">// å®¢æˆ·ç«¯ç¬¬äºŒæ¬¡è¯·æ±‚ä¼šæ‹¿ç€è¿™ä¸ªè¯·æ±‚å¤´</span></span><br><span class="line">  <span class="comment">// è¿™ä¸ªè¯·æ±‚å¤´çš„å€¼å°±æ˜¯ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶æœåŠ¡å™¨è®¾ç½®çš„last-modifiedçš„å€¼</span></span><br><span class="line">  <span class="keyword">let</span> ifModifeldSince = req.headers[<span class="string">'if-modified-since'</span>]</span><br><span class="line">  <span class="keyword">try</span>&#123; </span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">await</span> stat(filename)</span><br><span class="line">    <span class="comment">// æ‹¿åˆ°æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´</span></span><br><span class="line">    <span class="keyword">let</span> ctime = result.ctime.toUTCString()</span><br><span class="line">    <span class="keyword">if</span> (result.isFile()) &#123;</span><br><span class="line">      <span class="keyword">if</span> (ifModifeldSince === ctime) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœäºŒè€…ç›¸ç­‰, åˆ™è¯´æ˜æ–‡ä»¶æ²¡æœ‰æ›´æ”¹è¿‡, å‘Šè¯‰æµè§ˆå™¨å¯ä»¥èµ°ç¼“å­˜</span></span><br><span class="line">        res.statusCode = <span class="number">304</span></span><br><span class="line">        <span class="keyword">return</span> res.end()</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å€˜è‹¥ä»£ç èµ°åˆ°è¿™é‡Œ, åˆ™è¯´æ˜æ–‡ä»¶è¢«ä¿®æ”¹è¿‡, åˆ™è¿”å›æµè§ˆå™¨æœ€æ–°çš„æ–‡ä»¶</span></span><br><span class="line">      res.setHeader(<span class="string">'Content-Type'</span>, mime.getType(filename) + <span class="string">'; charset=utf-8'</span>)</span><br><span class="line">      res.setHeader(<span class="string">'Last-Modified'</span>, ctime)</span><br><span class="line">      <span class="keyword">return</span> fs.createReadStream(filename).pipe(res)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="comment">// console.log(e);</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res.end(<span class="string">'Not Fount'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">res.end()</span><br><span class="line">&#125;).listen(<span class="number">3001</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'server is working on the http://localhost:3001'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™ç§é€šè¿‡å¯¹æ¯”æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´æ¥åˆ¤æ–­æ–‡ä»¶å†…å®¹æ˜¯å¦æ›´æ”¹å­˜åœ¨ä»¥ä¸‹é—®é¢˜</p><ul><li>å¯¹æ–‡ä»¶å†…å®¹æ”¹å®Œä»¥ååˆæ”¹äº†å›æ¥, å¯¼è‡´æœ€åä¿®æ”¹æ—¶é—´å˜äº†è€Œå†…å®¹æœªå˜</li><li>æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´åªèƒ½ç²¾ç¡®åˆ°ç§’, å€˜è‹¥å¯¹æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´æ§åˆ¶åœ¨ä¸€ç§’ä»¥å†…, ä¹Ÿä¸èƒ½åˆ¤æ–­å‡ºæ–‡ä»¶å†…å®¹æ˜¯å¦æ”¹å˜</li></ul><h1 id="Etag"><a href="#Etag" class="headerlink" title="Etag"></a>Etag</h1><p>è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå®Œç¾çš„è§£å†³æ–¹æ¡ˆ, ç›´æ¥è¯»å–æ–‡ä»¶å†…å®¹, å¹¶æ ¹æ®æ–‡ä»¶å†…å®¹é€šè¿‡MD5ç”Ÿæˆä¸€ä¸ªæ‘˜è¦ä½œä¸ºEtagè¿”å›ç»™å®¢æˆ·ç«¯, ä¸‹æ¬¡å®¢æˆ·ç«¯æ‹¿ç€è¿™ä¸ªetagå€¼(if-none-matched)æ¥è¯·æ±‚æœåŠ¡ç«¯, æœåŠ¡ç«¯å¯¹æ–‡ä»¶å†…å®¹é‡æ–°è¯»å–å¹¶ç”Ÿæˆæ‘˜è¦, å¹¶å’Œå®¢æˆ·ç«¯å¸¦æ¥çš„etagå€¼æ¥åšå¯¹æ¯”, å¦‚æœç›¸åŒåˆ™æ–‡ä»¶æœªæ”¹, é€šçŸ¥æµè§ˆå™¨èµ°ç¼“å­˜, å¦åˆ™æœåŠ¡å™¨è¿”å›æ–°æ–‡ä»¶, è¯¥æ–¹æ³•å’Œä¸Šè¾¹æ–¹æ³•ä¸€æ ·ï¼Œ éƒ½å±äºå¯¹æ¯”ç¼“å­˜, éƒ½ä¼šè§¦å‘304</p><p>çœ‹ä¸‹ä»£ç é‡Œæ€ä¹ˆå®ç°ğŸ‘‡(åªå†™ä¸‹æ ¸å¿ƒéƒ¨åˆ†)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> rs = fs.createReadStream(filename)</span><br><span class="line"><span class="keyword">let</span> md5 = crypto.createHash(<span class="string">'md5'</span>)</span><br><span class="line"><span class="comment">// ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡ç«¯è‹¥åœ¨å“åº”å¤´ä¸­è®¾ç½®äº†etag, åˆ™åœ¨ä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶, å®¢æˆ·ç«¯å°±ä¼šæŠŠetagçš„å€¼æ”¾åœ¨if-none-matchä¸­å¸¦è¿‡æ¥</span></span><br><span class="line"><span class="keyword">let</span> ifNoneMatch = req.headers[<span class="string">'if-none-match'</span>]</span><br><span class="line"><span class="keyword">let</span> arr = []</span><br><span class="line">rs.on(<span class="string">'data'</span>, data =&gt; &#123;</span><br><span class="line">  md5.update(data)</span><br><span class="line">  arr.push(data)</span><br><span class="line">&#125;)</span><br><span class="line">rs.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// ç”¨md5 æ ¹æ®æ–‡ä»¶å†…å®¹ç”Ÿæˆæ‘˜è¦</span></span><br><span class="line">  <span class="keyword">let</span> etag = md5.digest(<span class="string">'base64'</span>)</span><br><span class="line">  <span class="comment">// å¦‚æœetagå’Œif-none-matchçš„å€¼ç›¸ç­‰ åˆ™èµ°ç¼“å­˜</span></span><br><span class="line">  <span class="keyword">if</span> (ifNoneMatch === etag) &#123;</span><br><span class="line">    res.statusCode = <span class="number">304</span></span><br><span class="line">    <span class="keyword">return</span> res.end()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è‹¥ç¨‹åºèµ°åˆ°è¿™ åˆ™è¯´æ˜æ²¡èµ°ç¼“å­˜</span></span><br><span class="line">  res.setHeader(<span class="string">'Content-Type'</span>, mime.getType(filename) + <span class="string">'; charset=utf8'</span>)</span><br><span class="line">  res.setHeader(<span class="string">'Etag'</span>, etag)</span><br><span class="line">  <span class="keyword">return</span> res.end(Buffer.concat(arr))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>çœ‹çš„å‡ºetagè™½ç„¶æ˜¯ä¸ªä¸é”™çš„æ–¹æ¡ˆä½†ç¡®æœ‰ç‚¹åƒæ€§èƒ½, å› ä¸ºæ¯æ¬¡è¯·æ±‚éƒ½ä¼šå°†è¯·æ±‚çš„æ–‡ä»¶éƒ½è¦è¯»ä¸€é, æ‰€ä»¥æœ‰ç‚¹æ—¶å€™æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ï¼ˆæ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´+æ–‡ä»¶çš„å¤§å°ï¼‰ä½œä¸ºetagçš„å€¼</strong></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ—¢ç„¶æœ‰è¿™ä¹ˆå¤šä¸­æ–¹æ¡ˆ, é‚£ä¹ˆåœ¨å®é™…å¼€å‘ä¸­è¯¥æ€ä¹ˆé€‰æ‹©å‘¢, ç­”æ¡ˆæ˜¯å…¨ç”¨ï¼(æŒ‰ç…§å¼ºåˆ¶ç¼“å­˜ , last-modified, etagçš„é¡ºåº) ä½ æ²¡æœ‰å¬é”™, æˆ‘ä»¬å¯ä»¥å…ˆç”¨è®¾ç½®å¼ºåˆ¶ç¼“å­˜, è®¾ä¸ªå‡ ç§’å°±å¤Ÿäº†, å½“å¼ºåˆ¶ç¼“å­˜åˆ°æœŸ, ç¨‹åºä¼šèµ°åˆ°last-modifiedå¯¹æ¯”ç¼“å­˜, å†èµ°etagå¯¹æ¯”ç¼“å­˜ï¼Œ å¦‚æœéƒ½æˆç«‹çš„è¯åˆ™è¿”å›304, å¹¶é‡æ–°è®¾ç½®å¼ºåˆ¶ç¼“å­˜,å¦‚æœå…¶ä¸­æœ‰ä¸€ä¸ªä¸æˆç«‹éƒ½è¦å‘é€æ–°çš„æ–‡ä»¶; <strong>æ‰€ä»¥ 304 = etag + last-modified</strong></p>]]></content>
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> Cache </category>
          
          <category> Node </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> Cache </tag>
            
            <tag> Node </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>cookieå’Œsessionè¯¦è§£ğŸš€</title>
      <link href="/blog/2019/04/26/cookie%E5%92%8Csession%E8%AF%A6%E8%A7%A3/"/>
      <url>/blog/2019/04/26/cookie%E5%92%8Csession%E8%AF%A6%E8%A7%A3/</url>
      <content type="html"><![CDATA[<h1 id="cookieçš„ä½œç”¨"><a href="#cookieçš„ä½œç”¨" class="headerlink" title="cookieçš„ä½œç”¨"></a>cookieçš„ä½œç”¨</h1><p>  As we all know, HTTPåè®®æ˜¯æ— çŠ¶æ€çš„, æ‰€ä»¥æœåŠ¡ç«¯å¯¹äºå®¢æˆ·ç«¯çš„è¯·æ±‚ä¸ä¼šæœ‰ä»»ä½•çš„è®°å¿†, åˆ°åº•æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚äº†å¤šæ¬¡, è¿˜æ˜¯è¯·æ±‚æ¥è‡ªä¸åŒçš„å®¢æˆ·ç«¯, è¿™äº›éƒ½ä¸å¾—è€ŒçŸ¥, ä½†æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›æœåŠ¡ç«¯èƒ½å¤Ÿâ€™çœ¼ç†Ÿâ€™å®¢æˆ·ç«¯, è¿™æ ·å®¢æˆ·ç«¯åœ¨è¯·æ±‚æœåŠ¡ç«¯çš„æ—¶å€™å°±èƒ½å°‘åšå¾ˆå¤šäº‹æƒ…, ä»æ¥æé«˜ç”¨æˆ·çš„ä½“éªŒ, å¸¸è§çš„åº”ç”¨åœºæ™¯å°±æ˜¯è‡ªåŠ¨ç™»é™†, å›æƒ³ä¸€ä¸‹, æˆ‘ä»¬åœ¨ä¸€ä¸ªç½‘ç«™ç™»é™†è¿‡ä¸€æ¬¡ä»¥åæ˜¯ä¸æ˜¯æœ‰ç›¸å½“é•¿çš„æ—¶é—´ä¹‹å†…å°±ä¸ç”¨å†æ¬¡ç™»é™†äº†, è¿™é‡Œåº”ç”¨çš„å°±æ˜¯cookie</p><h1 id="cookieçš„ä½¿ç”¨"><a href="#cookieçš„ä½¿ç”¨" class="headerlink" title="cookieçš„ä½¿ç”¨"></a>cookieçš„ä½¿ç”¨</h1><p>  æˆ‘ä»¬æ¥çœ‹çœ‹åœ¨Nodeé‡Œæˆ‘ä»¬æ˜¯æ€ä¹ˆè®¾ç½®cookieçš„ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line">http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// å½“å®¢æˆ·ç«¯è®¿é—®è·¯å¾„ä¸º/writeæ—¶, æˆ‘ä»¬å¾€å®¢æˆ·ç«¯ç§æ¤cookie</span></span><br><span class="line">  <span class="keyword">if</span> (req.url === <span class="string">'/write'</span>) &#123;</span><br><span class="line">    res.setHeader(<span class="string">'set-cookie'</span>, <span class="string">'name=hrh'</span>)</span><br><span class="line">    res.end(<span class="string">'write Ok!'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><p>  æˆ‘ä»¬è®¿é—® <code>http://localhost:3000/write</code>,ç„¶åæ‰“å¼€æ§åˆ¶å°, å‘ç°cookieè¢«æˆåŠŸè®¾ç½®</p><figure class="image-box">                <img src="3.png" alt="" title="" class="">                <p></p>            </figure><p>é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆè®¾ç½®å¤šä¸ªcookieå‘¢(ä¸ºäº†æ–¹ä¾¿, å’±ä»¬å°±åªå†™å…³é”®ä»£ç äº†)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (req.url === <span class="string">'/write'</span>) &#123;</span><br><span class="line">  res.setHeader(<span class="string">'set-cookie'</span>, [<span class="string">'name=hrh'</span>, <span class="string">'age=21'</span>])</span><br><span class="line">  res.end(<span class="string">'write Ok!'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="image-box">                <img src="4.png" alt="" title="" class="">                <p></p>            </figure><p>è¯´å®Œäº†å†™cookie, é‚£æˆ‘ä»¬æ€ä¹ˆè¯»å–å‘¢ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (req.url === <span class="string">'read'</span>) &#123;</span><br><span class="line">  <span class="comment">//å½“æˆ‘ä»¬è®¿é—® /read è¿™ä¸ªè·¯å¾„çš„æ—¶å€™, æµè§ˆå™¨å°±ä¼šæŠŠcookieçš„å€¼æ¸²æŸ“åˆ°é¡µé¢ä¸Š</span></span><br><span class="line">  res.end(res.headers(<span class="string">'cookie'</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>èªæ˜çš„å°ä¼™ä¼´å¯èƒ½å‘ç°äº†, æ§åˆ¶å°é‡Œé™¤äº†nameå’Œvalueä¸¤æ , åé¢è¿˜æœ‰å¥½å¤š, ä¸æ€¥, å’±ä»¬æŠŠå¸¸ç”¨çš„ä¸€ä¸€è§£é‡Šä¸€ä¸‹</p><h2 id="Domain"><a href="#Domain" class="headerlink" title="Domain"></a>Domain</h2><p>Domainè¿™ä¸ªå­—æ®µç”¨æ¥æ§åˆ¶cookieåœ¨å“ªä¸ªåŸŸä¸‹æœ‰æ•ˆ, åœ¨æ¼”ç¤ºä¹‹å‰, æˆ‘ä»¬å…ˆä¿®æ”¹ä¸‹æœ¬æœºçš„hostæ–‡ä»¶, è®©<code>a.hanrenhui.cn</code>å’Œ<code>n.hanrenhui.cn</code>éƒ½æ˜ å°„æˆlocalhost,åŒæ—¶åœ¨è®¾ç½®cookieçš„æ—¶å€™, æˆ‘ä»¬åšä»¥ä¸‹ä¿®æ”¹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (req.url === <span class="string">'/write'</span>) &#123;</span><br><span class="line">  res.setHeader(<span class="string">'Set-Cookie'</span>,<span class="string">'name=hrh; domain=a.hanrenhui.cn'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è®¿é—® <code>a.hanrenhui.cn/write</code></p><figure class="image-box">                <img src="5.png" alt="" title="" class="">                <p></p>            </figure><p>æˆ‘ä»¬å†ç”¨ <code>b.hanrenhui.cn/read</code> å»è¯»å–cookieçš„æ—¶å€™å°±è¯»å–ä¸åˆ°äº†, <strong>è€Œä¸”åœ¨writeçš„æ—¶å€™ä¹Ÿè®¾ç½®ä¸ä¸Š</strong>; è¿™æ ·è®¾ç½®çš„è¯, cookieå°±åªèƒ½åœ¨æŸä¸ªç‰¹å®šçš„åŸŸä¸‹è®¿é—®äº†, ä½†ä¸€èˆ¬æƒ…å†µä¸‹,<br>æˆ‘ä»¬éœ€è¦åœ¨å¤šä¸ªåŸŸåä¸‹è®¿é—®, è¿™æ€ä¹ˆåŠå‘¢, è¿™ä¸ªæ—¶å€™åªè¦è¿™æ ·è®¾ç½®å°±å¯ä»¥äº†ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (req.url === <span class="string">'/write'</span>) &#123;</span><br><span class="line">  res.setHeader(<span class="string">'Set-Cookie'</span>,<span class="string">'name=hrh; domain=.hanrenhui.cn'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·è®¾çš„ç›®çš„æ˜¯cookieåœ¨<code>hanrenhui.cn</code>çš„æ‰€æœ‰å­åŸŸåä¸‹è®¿é—®æœ‰æ•ˆ, è¿™æ ·<code>a.hanrenhui.cn</code>å’Œ<code>b.hanrenhui.cn</code>ä¸‹å°±éƒ½èƒ½è®¿é—®åˆ°äº†,ä½†æ˜¯è¯·æ³¨æ„: <strong>ä½ åœ¨domainè®¾ç½®æˆa.hanrenhui.cnä»¥åå†hanrenhui.cnä¸Šæ˜¯æ‹¿ä¸åˆ°çš„, ä¹Ÿå°±æ˜¯è¯´çˆ¶åŸŸåä¸‹çš„cookieå­åŸŸåèƒ½å¤Ÿæ‹¿åˆ°, ä½†å­åŸŸåä¸‹çš„cookie, çˆ¶åŸŸåæ˜¯æ‹¿ä¸åˆ°çš„</strong></p><h2 id="path"><a href="#path" class="headerlink" title="path"></a>path</h2><p>è¯¥å­—æ®µç”¨äºè®¾ç½®cookieåœ¨å“ªä¸ªè·¯å¾„ä¸‹æœ‰æ•ˆ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (req.url === <span class="string">'/write'</span>) &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœæƒ³è®¾ç½®å¤šä¸ªå­—æ®µç”¨åˆ†å·ç©ºæ ¼åˆ†å¼€</span></span><br><span class="line">  <span class="comment">// æˆ‘ä»¬è®¾ç½®pathä¸º/read1 </span></span><br><span class="line">  res.setHeader(<span class="string">'Set-Cookie'</span>,<span class="string">'name=hrh; domain=.hanrenhui.cn; path=/read1'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Expires-å’Œ-Max-Age"><a href="#Expires-å’Œ-Max-Age" class="headerlink" title="Expires å’Œ Max-Age"></a>Expires å’Œ Max-Age</h2><p>è¿™ä¸¤ä¸ªå­—æ®µçš„ä½œç”¨æ˜¯ä¸€æ ·çš„, éƒ½æ˜¯è®¾ç½®cookieçš„è¿‡æœŸæ—¶é—´çš„, ä¸åŒçš„æ˜¯ Expiresä½¿ç”¨çš„æ˜¯ç»å¯¹æ—¶é—´, Max-Ageä½¿ç”¨çš„ç›¸å¯¹æ—¶é—´,<br>ç®€å•æ¥è¯´å°±æ˜¯Expiresè®¾ç½®çš„æ˜¯è¿‡æœŸçš„å…·ä½“æ—¶é—´, è€ŒMax-Age è®¾ç½®çš„æ˜¯å¤šé•¿æ—¶é—´ä»¥åè¿‡æœŸ,<strong>å¦‚æœä¸è®¾ç½®è¿™ä¿©å­—æ®µ, åˆ™è¿‡æœŸæ—¶é—´é»˜è®¤ä¸ºå½“å‰ä¼šè¯, ä¹Ÿå°±æ˜¯è¯´ä½ æµè§ˆå™¨ä¸€å…³å°±æ²¡äº†</strong> è®©æˆ‘ä»¬çœ‹ä¸‹è¿™ä¿©æ€ä¹ˆè®¾ç½®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®10ç§’åè¿‡æœŸ</span></span><br><span class="line">res.segHeader(<span class="string">'Set-Cookie'</span>ï¼Œ <span class="string">'name=hrh; max-age=10'</span>)</span><br><span class="line"><span class="comment">// è®¾ç½®å…·ä½“çš„è¿‡æœŸæ—¶é—´, æˆ‘ä»¬è®¾ç½®å½“å‰æ—¶é—´åŠ ä¸Š60så(ä¹Ÿå°±æ˜¯60så)è¿‡æœŸ</span></span><br><span class="line">res.setHeader(<span class="string">'Set-Cookie'</span>, <span class="string">`name=hrh; expires=<span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">Date</span>.now() + <span class="number">60</span>*<span class="number">1000</span>).toUTCString()&#125;</span>`</span>)</span><br></pre></td></tr></table></figure><h2 id="Size"><a href="#Size" class="headerlink" title="Size"></a>Size</h2><p>  æ ‡è¯†cookieå¤§å°, æµè§ˆå™¨è‡ªåŠ¨è®¾ç½®, ä¸å½’å’±ç®¡</p><h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>è¿™ä¸ªå­—æ®µç”¨äºæ§åˆ¶æ˜¯å¦å¯ä»¥åœ¨å‰ç«¯æ‹¿åˆ°, çœ‹ä¸‹æœªè®¾ç½®è¿™ä¸ªå­—æ®µä¹‹å‰ğŸ‘‡</p><figure class="image-box">                <img src="6.png" alt="" title="" class="">                <p></p>            </figure><p>æˆ‘ä»¬æ¥è®¾ç½®ä¸‹è¿™ä¸ªå­—æ®µ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.setHeader(<span class="string">'Set-Cookie'</span>, <span class="string">'name=hrh; httpOnly=true'</span>)</span><br></pre></td></tr></table></figure><p>è®¾ç½®å®Œä»¥å, æˆ‘ä»¬åœ¨å‰ç«¯å°±æ‹¿ä¸åˆ°äº†, çœ‹å›¾</p><figure class="image-box">                <img src="7.png" alt="" title="" class="">                <p></p>            </figure><p>åœ¨æœªè®¾ç½®è¿™ä¸ªå­—æ®µä¹‹å‰ æˆ‘ä»¬ä¸ä»…å¯ä»¥åœ¨å‰ç«¯æ‹¿åˆ°cookieä¸­æ‹¿åˆ°, æ›´æ˜¯å¯ä»¥ä¿®æ”¹å®ƒ, æ˜¾ç„¶è¿™æ ·å¤ªå±é™©äº†, æ‰€ä»¥è¯¥å­—æ®µä¸€èˆ¬è®¾ä¸ºtrue</p><h2 id="å°è£…ä¸€ä¸ªsetCookieå’ŒgetCookie"><a href="#å°è£…ä¸€ä¸ªsetCookieå’ŒgetCookie" class="headerlink" title="å°è£…ä¸€ä¸ªsetCookieå’ŒgetCookie"></a>å°è£…ä¸€ä¸ªsetCookieå’ŒgetCookie</h2><p>æƒ³å¿…å¤§å®¶å‘ç°äº†, reså¯¹è±¡ä¸Šè‡ªå¸¦çš„è¿™ä¸ªè®¾ç½®cookieçš„æ–¹æ³•ç€å®æœ‰ç‚¹éº»çƒ¦, å½“å­—æ®µä¸€å¤š, å°±ä¼šå‡ºç°ä¸‹è¾¹è¿™ç§æƒ…å†µğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">res.setHeader(<span class="string">'Set-Cookie'</span>, [</span><br><span class="line">    <span class="string">'name=hrh; domain=a.hanrenhui.cn; httpOnly=true; path=/; max-age=10'</span>,</span><br><span class="line">    <span class="string">'age=18; domain=a.hanrenhui.cn; httpOnly=true; path=/; max-age=10'</span>,</span><br><span class="line">])</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯å¤ªæ¶å¿ƒäº†, è¿™ä¸ç¬¦åˆæˆ‘ä»¬å¹³æ—¶codingçš„ä¹ æƒ¯, æˆ‘ä»¬ä¹ æƒ¯çš„æ˜¯ä¸‹è¾¹è¿™ç§å†™æ³•ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">res.setCookie(<span class="string">'name'</span>, <span class="string">'hrh'</span>, &#123;</span><br><span class="line">    domain: <span class="string">'a.hanrenhui.cn'</span>,</span><br><span class="line">    httpOnly: <span class="literal">true</span>,</span><br><span class="line">    MaxAge: <span class="number">10</span>,</span><br><span class="line">    path: <span class="string">'/'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">res.setCookie(<span class="string">'age'</span>, <span class="string">'21'</span>, &#123;</span><br><span class="line">    domain: <span class="string">'a.hanrenhui.cn'</span>,</span><br><span class="line">    httpOnly: <span class="literal">true</span>,</span><br><span class="line">    MaxAge: <span class="number">10</span>,</span><br><span class="line">    path: <span class="string">'/'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¥½å§, é‚£æˆ‘ä»¬æ¥å°è£…ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = []</span><br><span class="line">res.setCookie = <span class="function"><span class="keyword">function</span> (<span class="params">key, value, options = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> optionArr = []</span><br><span class="line">  <span class="comment">// å…ˆæŠŠoptionsé‡Œçš„æ‰€æœ‰é”®å€¼å¯¹ è½¬ä¸ºkey=valueçš„å½¢å¼å¹¶å­˜å…¥optionArrä¸­</span></span><br><span class="line">  <span class="keyword">if</span> (options.domain) &#123;</span><br><span class="line">    optionArr.push(<span class="string">`domain=<span class="subst">$&#123;options.domain&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (options.httpOnly) &#123;</span><br><span class="line">    optionArr.push(<span class="string">`httpOnly=<span class="subst">$&#123;options.httpOnly&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (options.MaxAge) &#123;</span><br><span class="line">    optionArr.push(<span class="string">`max-age=<span class="subst">$&#123;options.MaxAge&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (options.expires) &#123;</span><br><span class="line">    optionArr.push(<span class="string">`expires=<span class="subst">$&#123;optins.expires&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (options.path) &#123;</span><br><span class="line">    optionArr.push(<span class="string">`httpOnly=<span class="subst">$&#123;options.path&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// arrçš„å½¢å¼ï¼š</span></span><br><span class="line">  <span class="comment">//[</span></span><br><span class="line">  <span class="comment">// 'name=hrh; domain=a.hanrenhui.cn; httpOnly=true; path=/; max-age=10'ï¼Œ</span></span><br><span class="line">  <span class="comment">// 'age=21; domain=a.hanrenhui.cn; httpOnly=true; path=/; max-age=10'ï¼Œ</span></span><br><span class="line">  <span class="comment">//]</span></span><br><span class="line">  </span><br><span class="line">  arr.push(<span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;value&#125;</span>; <span class="subst">$&#123;optionArr.join(<span class="string">'; '</span>)&#125;</span>`</span>)</span><br><span class="line">  res.setHeader(<span class="string">'Set-Cookie'</span>, arr)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¯¥åº“ç”¨äºå°†å­—ç¬¦ä¸²è½¬ä¸ºå¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> queryString = <span class="built_in">require</span>(<span class="string">'querystring'</span>)</span><br><span class="line">res.getCookie = <span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = queryString.parse(req.headers.cookie, <span class="string">'; '</span>) || &#123;&#125;</span><br><span class="line">    <span class="keyword">return</span> result[key]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="cookieé˜²ç¯¡æ”¹"><a href="#cookieé˜²ç¯¡æ”¹" class="headerlink" title="cookieé˜²ç¯¡æ”¹"></a>cookieé˜²ç¯¡æ”¹</h1><h2 id="ä»€ä¹ˆæ˜¯cookieçš„ç¯¡æ”¹ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯cookieçš„ç¯¡æ”¹ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯cookieçš„ç¯¡æ”¹ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯cookieçš„ç¯¡æ”¹ï¼Ÿ</h2><p>æœ‰äººå¯èƒ½ä¼šè§‰å¾—, æˆ‘ä»¬ä¸æ˜¯æŠŠhttpOnlyè®¾ç½®æˆtrueä»¥åå‰ç«¯å°±ä¸èƒ½æ”¹äº†ä¹ˆ? é‚£æ˜¯ä¸€æ–¹é¢, é™¤äº†é‚£æ ·å¯ä»¥ä¿®æ”¹ä»¥å¤–, ä½ è¿˜å¯ä»¥ç›´æ¥è¿™æ ·æ”¹ğŸ‘‡</p><figure class="image-box">                <img src="8.png" alt="" title="" class="">                <p></p>            </figure><p>ä¸ºäº†é˜²æ­¢å‡ºç°è¿™ç§é—®é¢˜, å°±éœ€è¦åœ¨åç«¯åšé˜²ç¯¡æ”¹å¤„ç†äº†, æˆ‘æŠŠå®ç°æ€æƒ³å†™åœ¨ä»£ç é‡Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¹å€¼ä½¿ç”¨åŠ ç›ç®—æ³•</span></span><br><span class="line"><span class="keyword">const</span> sign = <span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">'crypto'</span>).createHmac(<span class="string">'sha256'</span>, secret).update(value).digest(<span class="string">'base64'</span>).replace(<span class="regexp">/[+/]/g</span>, <span class="string">''</span>)</span><br><span class="line">&#125;</span><br><span class="line">res.setCookie = <span class="function"><span class="keyword">function</span> (<span class="params">key, value, options = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> optionArr = []</span><br><span class="line">  <span class="keyword">if</span> (options.domain) &#123;</span><br><span class="line">      optionArr.push(<span class="string">`domain=<span class="subst">$&#123;options.domain&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (options.httpOnly) &#123;</span><br><span class="line">      optionArr.push(<span class="string">`httpOnly=<span class="subst">$&#123;options.httpOnly&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (options.MaxAge) &#123;</span><br><span class="line">      optionArr.push(<span class="string">`max-age=<span class="subst">$&#123;options.MaxAge&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (options.expires) &#123;</span><br><span class="line">      optionArr.push(<span class="string">`expires=<span class="subst">$&#123;optins.expires&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (options.path) &#123;</span><br><span class="line">      optionArr.push(<span class="string">`httpOnly=<span class="subst">$&#123;options.path&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœéœ€è¦åšé˜²ç¯¡æ”¹å¤„ç† å°±åœ¨optionsé‡Œä¼ å…¥signedå­—æ®µ</span></span><br><span class="line">  <span class="comment">// ä¿®æ”¹valueå€¼ ä¸º value + '.åˆ©ç”¨åŠ ç›ç®—æ³•ç”Ÿæˆçš„æ–°å€¼' å…¶ä»–ä¸å˜</span></span><br><span class="line">  <span class="keyword">if</span> (options.signed) &#123;</span><br><span class="line">      value = value += <span class="string">`.<span class="subst">$&#123;sign(value)&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">  arr.push(<span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;value&#125;</span>; <span class="subst">$&#123;optionArr.join(<span class="string">'; '</span>)&#125;</span>`</span>)</span><br><span class="line">  res.setHeader(<span class="string">'Set-Cookie'</span>, arr)</span><br><span class="line">&#125;</span><br><span class="line">res.getSignCookie = <span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = queryString.parse(req.headers.cookie, <span class="string">'; '</span>) || &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (result[key]) &#123;</span><br><span class="line">      <span class="keyword">const</span> [ value, signValue ] = result[key].split(<span class="string">'.'</span>)</span><br><span class="line">      <span class="comment">// å¯¹valueé‡æ–°ä½¿ç”¨åŠ ç›ç®—æ³• å¦‚æœå’Œä¹‹å‰ç®—å‡ºæ¥çš„ç»“æœä¸€æ ·(ä¹‹å‰çš„å€¼å°±æ˜¯signValue), åˆ™è¯æ˜æœªè¢«ç¯¡æ”¹, å¦åˆ™å°±è¢«ç¯¡æ”¹äº†</span></span><br><span class="line">      <span class="keyword">if</span> (sign(value) === signValue) &#123;</span><br><span class="line">          <span class="keyword">return</span> value</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="string">'ç­¾åè¢«ä¿®æ”¹'</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'æ— è¯¥cookie'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="cookieä½¿ç”¨æ³¨æ„äº‹é¡¹"><a href="#cookieä½¿ç”¨æ³¨æ„äº‹é¡¹" class="headerlink" title="cookieä½¿ç”¨æ³¨æ„äº‹é¡¹"></a>cookieä½¿ç”¨æ³¨æ„äº‹é¡¹</h1><ul><li>å¯èƒ½ä¼šè¢«å®¢æˆ·ç«¯ç¯¡æ”¹, ä½¿ç”¨å‰è¦éªŒè¯åˆæ³•æ€§</li><li>ä¸èƒ½å­˜æ”¾æ•æ„Ÿä¿¡æ¯, å› ä¸ºæ•°æ®æš´éœ²åœ¨å‰ç«¯</li><li>å°½é‡è®¾ç½®httpOnlyä¸ºtrue</li><li>å°½é‡å‡å°‘cookieçš„ä½“ç§¯</li><li>è®¾ç½®æ­£ç¡®çš„pathå’Œdomain, å‡å°‘æ•°æ®ä¼ è¾“</li></ul><h1 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h1><p>ç»è¿‡ä¸Šé¢å¯¹cookieçš„å……åˆ†äº†è§£ä»¥å, æˆ‘ä»¬å‘ç°, cookieçš„ä¿¡æ¯æ˜¯éå¸¸ä¸å®‰å…¨çš„, å› ä¸ºcookieçš„æ•°æ®å¾ˆæ˜æ˜¾çš„æš´éœ²åœ¨æ§åˆ¶å°å½“ä¸­ï¼Œå¦‚æœå­˜åœ¨æ•æ„Ÿä¿¡æ¯çš„è¯, åæœæ˜¯ä¸è‚¯è®¾æƒ³çš„, äºæ˜¯ä¾¿æœ‰äº†sessionçš„å­˜åœ¨</p><h2 id="ä»€ä¹ˆæ˜¯session"><a href="#ä»€ä¹ˆæ˜¯session" class="headerlink" title="ä»€ä¹ˆæ˜¯session"></a>ä»€ä¹ˆæ˜¯session</h2><p>ç®€å•æ¥è¯´, sessionå°±æ˜¯ä¸€ä¸ªå¯¹è±¡è€Œå·², è¿™ä¸ªå¯¹è±¡ä¸­å­˜æ”¾ç€ç”¨æˆ·çš„idå’Œç”¨æˆ·æ‰€æœ‰ä¿¡æ¯çš„æ˜ å°„å…³ç³», å®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶å€™, æœåŠ¡ç«¯æ ¹æ®ç”¨æˆ·çš„idæ‹¿åˆ°å¯¹åº”ç”¨æˆ·çš„ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯; é‚£æœåŠ¡ç«¯æ€ä¹ˆçŸ¥é“å“ªä¸ªå®¢æˆ·ç«¯å¯¹åº”å“ªä¸ªid? è¿™å°±éœ€è¦cookieçš„å¸®å¿™äº†;<br>ä¸¾ä¸ªæ —å­å§: æˆ‘ä»¬å»ç†å‘åº—ç†å‘çš„æ—¶å€™, ç¬¬ä¸€æ¬¡å»å¾€å¾€ä¼šåŠå¼ ä¼šå‘˜å¡, ä»¥åå†å»ä»˜é’±çš„æ—¶å€™åªéœ€è¦æŠŠä½ çš„å¡å·å‘Šè¯‰è€æ¿å°±å¥½äº†, åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ æˆ‘å°±æ˜¯å®¢æˆ·ç«¯, ç†å‘åº—å°±æ˜¯æœåŠ¡ç«¯, ç†å‘åº—å°†å¡å·æˆ‘çš„ä¸ªäººä¿¡æ¯ç»‘å®šåœ¨ä¸€èµ·è®°å½•ä¸‹æ¥, ç„¶åæŠŠä¼šå‘˜å¡ç»™æˆ‘, ä¼šå‘˜å¡å°±æ˜¯cookie, æˆ‘ä¸‹æ¬¡å»ç†å‘çš„æ—¶å€™, ç†å‘åº—æ ¹æ®ä¼šå‘˜å¡å°±èƒ½æ‰¾åˆ°æˆ‘çš„ç›¸å…³ä¿¡æ¯, å¹¶ä»æˆ‘çš„ä½™é¢ä¸Šæ‰£å»æ­¤æ¬¡è´¹ç”¨; æˆ‘ä»¬æ‹¿è¿™ä¸ªæ —å­æŠŠsessionå®ç°å†™ä¸€ä¸‹ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">let</span> quersyString = <span class="built_in">require</span>(<span class="string">'querystring'</span>)</span><br><span class="line"><span class="keyword">let</span> uuid = <span class="built_in">require</span>(<span class="string">'uuid'</span>)</span><br><span class="line"><span class="comment">// å¯ä»¥æŠŠseessionid æƒ³è±¡æˆç†å‘åº—çš„åå­—</span></span><br><span class="line"><span class="keyword">let</span> sessionId = <span class="string">'xijianchui'</span></span><br><span class="line"><span class="comment">// session</span></span><br><span class="line"><span class="keyword">let</span> session = &#123;&#125;</span><br><span class="line">http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.setHeader(<span class="string">'content-type'</span>, <span class="string">'text/plain;charset=utf8'</span>)</span><br><span class="line">  <span class="keyword">if</span> (req.url === <span class="string">'/cut'</span>) &#123;</span><br><span class="line">    <span class="comment">// å°†æ‰€æœ‰cookieè½¬ä¸ºå¯¹è±¡å½¢å¼</span></span><br><span class="line">    <span class="keyword">let</span> cookies = quersyString.parse(req.headers[<span class="string">'cookie'</span>], <span class="string">'; '</span>) || &#123;&#125;</span><br><span class="line">    <span class="comment">// æ ¹æ®åº—åä»cookieä¸­æ‹¿åˆ°ç”¨æˆ·id</span></span><br><span class="line">    <span class="keyword">let</span> userId = cookies[sessionId]</span><br><span class="line">    <span class="comment">// çœ‹çœ‹ç”¨æˆ·idå­˜ä¸å­˜åœ¨, å¦‚æœå­˜åœ¨åˆ™ä¸æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®, ä¸éœ€è¦åŠå¡</span></span><br><span class="line">    <span class="comment">// å¦åˆ™å°±æ˜¯é¦–æ¬¡è®¿é—®, éœ€è¦åŠå¡</span></span><br><span class="line">    <span class="keyword">if</span> (userId &amp;&amp; session[userId]) &#123;</span><br><span class="line">      session[userId].money -= <span class="number">10</span></span><br><span class="line">      res.end(<span class="string">`ä½™é¢ä¸º<span class="subst">$&#123;session[userId].money&#125;</span>`</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// é¦–æ¬¡è®¿é—®</span></span><br><span class="line">      <span class="comment">// uuidæ˜¯ä¸ªåº“, ç”¨äºç”Ÿæˆä¸ä¼šé‡å¤çš„å­—ç¬¦ä¸², æˆ‘ä»¬ç”¨è¿™ä¸ªå­—ç¬¦ä¸²æ¥ä½œä¸ºç”¨æˆ·çš„id</span></span><br><span class="line">      <span class="keyword">let</span> userId = uuid.v4()</span><br><span class="line">      <span class="comment">// å¾€å‰ç«¯ç§æ¤cookie é”®æ˜¯ç†å‘åº—çš„åº—å, å€¼æ˜¯ä½ çš„id</span></span><br><span class="line">      <span class="comment">// ä¸‹æ¬¡è®¿é—®æœåŠ¡ç«¯ æœåŠ¡ç«¯å°±èƒ½æ‹¿åˆ°ä½ çš„idä»æ¥è·å–ä½ çš„ä¸ªäººä¿¡æ¯</span></span><br><span class="line">      res.setHeader(<span class="string">'Set-Cookie'</span>, <span class="string">`<span class="subst">$&#123;sessionId&#125;</span>=<span class="subst">$&#123;userId&#125;</span>`</span>)</span><br><span class="line">      <span class="comment">// é¦–æ¬¡è®¿é—®éœ€è¦åœ¨æœåŠ¡ç«¯åˆå§‹åŒ–ä½ çš„ä¸ªäººä¿¡æ¯</span></span><br><span class="line">      session[userId] = &#123;</span><br><span class="line">        money: <span class="number">100</span></span><br><span class="line">      &#125;</span><br><span class="line">      res.end(<span class="string">'é¦–æ¬¡å…‰ä¸´, é€æ‚¨ä¸€å¼ ä¼šå‘˜å¡, ä½™é¢ä¸º100'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><h1 id="Cookieå’ŒSessionçš„åŒºåˆ«"><a href="#Cookieå’ŒSessionçš„åŒºåˆ«" class="headerlink" title="Cookieå’ŒSessionçš„åŒºåˆ«"></a>Cookieå’ŒSessionçš„åŒºåˆ«</h1><ul><li>cookieæ•°æ®å­˜æ”¾åœ¨å®¢æˆ·çš„æµè§ˆå™¨ä¸Š,sessionæ•°æ®æ”¾åœ¨æœåŠ¡å™¨ä¸Š;</li><li>cookieä¸æ˜¯å¾ˆå®‰å…¨ï¼Œåˆ«äººå¯ä»¥åˆ†æå­˜æ”¾åœ¨æœ¬åœ°çš„COOKIE,å¹¶è¿›è¡ŒCOOKIEæ¬ºéª—,è€ƒè™‘åˆ°å®‰å…¨åº”å½“ä½¿ç”¨sessionã€‚</li><li><p>sessionä¼šåœ¨ä¸€å®šæ—¶é—´å†…ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šã€‚å½“è®¿é—®å¢å¤šï¼Œä¼šæ¯”è¾ƒå ç”¨ä½ æœåŠ¡å™¨çš„æ€§èƒ½è€ƒè™‘åˆ°å‡è½»æœåŠ¡å™¨æ€§èƒ½æ–¹é¢ï¼Œåº”å½“ä½¿ç”¨COOKIEã€‚</p></li><li><p>å•ä¸ªcookieä¿å­˜çš„æ•°æ®ä¸èƒ½è¶…è¿‡4Kï¼Œå¾ˆå¤šæµè§ˆå™¨éƒ½é™åˆ¶ä¸€ä¸ªç«™ç‚¹æœ€å¤šä¿å­˜20ä¸ªcookieã€‚</p></li></ul>]]></content>
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> cookie </category>
          
          <category> session </category>
          
          <category> Node </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> Node </tag>
            
            <tag> cookie </tag>
            
            <tag> session </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å®ç°Promise/A+è§„èŒƒâš¡</title>
      <link href="/blog/2019/03/22/%E6%89%8B%E6%92%B8Promise-%E5%B9%B6%E9%80%9A%E8%BF%87%E6%B5%8B%E8%AF%95/"/>
      <url>/blog/2019/03/22/%E6%89%8B%E6%92%B8Promise-%E5%B9%B6%E9%80%9A%E8%BF%87%E6%B5%8B%E8%AF%95/</url>
      <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä»Šæ™šæ‰‹å†™ä¸€ä¸ªPromise, å¹¶é€šè¿‡promises-aplus-testsæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹çš„è¹‚èº(âŠ™ï¹âŠ™), å®Œæ•´ä»£ç æ”¾<a href="https://github.com/HanRenHui/Promise" target="_blank" rel="noopener">GitHub</a>, åŒæ—¶ç¨å¾®æ¶‰åŠä¸‹<code>Promise</code>ç”Ÿæ€é‡Œçš„<code>Q</code>å’Œ<code>bluebird</code>ä¿©ä¸ªåº“ </p><h1 id="Promiseå®ç°"><a href="#Promiseå®ç°" class="headerlink" title="Promiseå®ç°"></a>Promiseå®ç°</h1><p>æˆ‘ä»¬å…ˆä»Promiseçš„åŸºæœ¬ä½¿ç”¨å¼€å§‹, ä¸€æ­¥æ­¥åˆ°å¤æ‚, æœ€ç»ˆå®ç°ä¸€ä¸ªç¬¦åˆPromise/A+è§„èŒƒçš„Promise, å…ˆçœ‹åŸºç¡€ä½¿ç”¨ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> data = <span class="number">100</span></span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="number">100</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;, err =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä»åŸºæœ¬ä½¿ç”¨å¯ä»¥å¾—å‡ºPromiseæ˜¯ä¸ªæ„é€ å‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°, è€Œä¸”è¿™ä¸ªå‡½æ•°ä¼šç«‹å³æ‰§è¡Œ, promiseå®ä¾‹ä¸­åˆæœ‰ä¸€ä¸ªthenæ–¹æ³•, è¯¥æ–¹æ³•åˆæ¥å—ä¸€ä¸ªå›è°ƒ, è€Œä¸”è¯¥å›è°ƒåœ¨resolveè°ƒç”¨ä¹‹å‰ä¸ä¼šæ‰§è¡Œ, resolveæ‰§è¡Œæ¥å—åˆ°çš„æ•°æ®ä¼šä¼ ç»™then, thenæ‰§è¡Œ, æˆ‘ä»¬å…ˆæ¥å®ç°è¿™ä¸€éƒ¨åˆ†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Promiseæ˜¯ä¸ªæ„é€ å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ç¼“å­˜thisï¼Œ æˆ–è€…ç›´æ¥ä½¿ç”¨es6çš„ç®­å¤´å‡½æ•°</span></span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">this</span>.FulFiledCallBacks = []</span><br><span class="line">  <span class="keyword">this</span>.RejectedCallBacks = []</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å°†å¼‚æ­¥ç»“æœä¿å­˜æˆå®ä¾‹å±æ€§</span></span><br><span class="line">    self.value = value</span><br><span class="line">    <span class="comment">// æ‰§è¡Œthenä¼ å…¥çš„æˆåŠŸå›è°ƒ</span></span><br><span class="line">    self.FulFiledCallBacks.forEach(<span class="function"><span class="params">c</span> =&gt;</span> c(self.value))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å°†å¼‚æ­¥é”™è¯¯åŸå› ä¿å­˜æˆå®ä¾‹å±æ€§</span></span><br><span class="line">    self.reason = reason</span><br><span class="line">    <span class="comment">// æ‰§è¡Œthenä¼ å…¥çš„å¤±è´¥å›è°ƒ</span></span><br><span class="line">    self.RejectedCallBacks.forEach(<span class="function"><span class="params">c</span> =&gt;</span> c(self.reason))</span><br><span class="line">  &#125;</span><br><span class="line">  fn(resolve, reject)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span>(<span class="params">OnFulFiled, OnRejected</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å°†thené‡Œä¼ å…¥çš„ç¬¬ä¸€ä¸ªå›è°ƒç¼“å­˜èµ·æ¥, è°ƒç”¨resolveçš„æ—¶å€™å†æ‰§è¡Œ</span></span><br><span class="line">  <span class="keyword">this</span>.FulFiledCallBacks.push(OnFulFiled)</span><br><span class="line">  <span class="comment">// å°†thené‡Œä¼ å…¥çš„ç¬¬äºŒä¸ªå›è°ƒç¼“å­˜èµ·æ¥, è°ƒç”¨rejectçš„æ—¶å€™å†æ‰§è¡Œ</span></span><br><span class="line">  <span class="keyword">this</span>.RejectedCallBacks.push(OnRejected)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Promiseå†…éƒ¨çš„çŠ¶æ€"><a href="#Promiseå†…éƒ¨çš„çŠ¶æ€" class="headerlink" title="Promiseå†…éƒ¨çš„çŠ¶æ€"></a>Promiseå†…éƒ¨çš„çŠ¶æ€</h2><p>è¿™éƒ¨åˆ†å®ç°ä»¥åæˆ‘ä»¬å›æƒ³ä¸€ä¸‹æˆ‘ä»¬åˆšå­¦promiseçš„åŸºæœ¬ä½¿ç”¨çš„æ—¶å€™, æœ€å¸¸å¬åˆ°çš„ä¸€å¥è¯æ˜¯ä¸æ˜¯å°±æ˜¯ Promiseå†…éƒ¨ç»´æŠ¤ä¸‰ä¸ªçŠ¶æ€: pending, fulfiled, rejected, è€Œä¸”åˆå§‹æ€ä¸ºpending, å½“è°ƒç”¨resolveçš„æ—¶å€™çŠ¶æ€ç”±pending å˜ä¸º fulfiled, è°ƒç”¨rejectedçš„æ—¶å€™ ç”±pending å˜ä¸º rejected, è€Œä¸”çŠ¶æ€åªèƒ½ç”±pendingè½¬ä¸ºfulfiledæˆ–è€…å˜ä¸ºrejectedï¼Œ è€Œä¸”è½¬å˜ä¸ºä¸èƒ½å†æ›´æ”¹æˆ‘ä»¬å†æ¥æ”¹è¿›ä¸‹ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PENDING = <span class="string">'pending'</span></span><br><span class="line"><span class="keyword">const</span> FULFILED = <span class="string">'fulfiled'</span></span><br><span class="line"><span class="keyword">const</span> REJECTED = <span class="string">'rejected'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">this</span>.FulFiledCallBacks = []</span><br><span class="line">  <span class="keyword">this</span>.RejectedCallBacks = []</span><br><span class="line">  <span class="comment">// å¢åŠ çŠ¶æ€å­—æ®µ</span></span><br><span class="line">  <span class="keyword">this</span>.status = PENDING</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­çŠ¶æ€, å¦‚æœçŠ¶æ€æ›¾ç»æ›´æ”¹è¿‡åˆ™ä¸èƒ½å†æ›´æ”¹</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === PENDING) &#123;</span><br><span class="line">      <span class="comment">// æ›´æ”¹çŠ¶æ€ä¸ºfulfield</span></span><br><span class="line">      self.status = FULFILED</span><br><span class="line">      self.value = value</span><br><span class="line">      self.FulFiledCallBacks.forEach(<span class="function"><span class="params">c</span> =&gt;</span> c(self.value))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(self.status === PENDING) &#123;</span><br><span class="line">      <span class="comment">// æ›´æ”¹çŠ¶æ€ä¸ºrejected</span></span><br><span class="line">      self.status = REJECTED</span><br><span class="line">      self.reason = reason</span><br><span class="line">      self.RejectedCallBacks.forEach(<span class="function"><span class="params">c</span> =&gt;</span> c(self.reason))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  fn(resolve, reject)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŒæ­¥æ‰§è¡Œresolve"><a href="#åŒæ­¥æ‰§è¡Œresolve" class="headerlink" title="åŒæ­¥æ‰§è¡Œresolve"></a>åŒæ­¥æ‰§è¡Œresolve</h2><p>å†æ¥æƒ³ä¸‹, Promiseæ„é€ å‡½æ•°ä¸­çš„resolveåªèƒ½å¼‚æ­¥æ‰§è¡Œä¹ˆï¼Ÿ å½“ç„¶ä¸æ˜¯, æ‹¿es6çš„promiseè¯•ä¸€ä¸‹å°±çŸ¥é“äº†, é‚£æˆ‘ä»¬æ‹¿æˆ‘ä»¬ç›®å‰çš„ä»£ç æµ‹è¯•ä¸‹çœ‹çœ‹ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> data = <span class="number">100</span></span><br><span class="line">  <span class="comment">// æŠŠå¼‚æ­¥æ‰§è¡Œè½¬ä¸ºåŒæ­¥æ‰§è¡Œ</span></span><br><span class="line">  <span class="comment">// setTimeout(() =&gt; &#123;</span></span><br><span class="line">    resolve(<span class="number">100</span>)</span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">promise.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å°†resolveæ”¹ä¸ºå¼‚æ­¥æ‰§è¡Œä»¥åæˆ‘ä»¬å‘ç°thené‡Œçš„å›è°ƒæ ¹æœ¬ä¸ä¼šæ‰§è¡Œ, æˆ‘ä»¬æ¥åˆ†æä¸‹åŸå› ï¼š å›å½’resolveå¼‚æ­¥æ‰§è¡Œçš„çŠ¶æ€, é¦–å…ˆæˆ‘ä»¬å®ä¾‹åŒ–Promise, ä¼ å…¥Promiseçš„å›è°ƒä¼šç«‹å³æ‰§è¡ŒåŒæ­¥ä»£ç , å¹¶ç«‹å³æ‰§è¡Œthenæ–¹æ³•, thenæ–¹æ³•æ‰§è¡Œå®Œä»¥å, æˆ‘ä»¬ä¼ ç»™thené‡Œçš„å›è°ƒä¼šè¢«ç¼“å­˜åˆ°Promiseå†…éƒ¨çš„FulFiledCallBacksæ•°ç»„é‡Œ, å¾…å»¶æ—¶è°ƒç”¨æ—¶é—´åˆ°äº†ä»¥åæ‰§è¡Œresolveï¼Œ resolveå†…éƒ¨FulFiledCallBacksæ•°ç»„é‡Œçš„æ‰€æœ‰æ–¹æ³•ï¼› è¿™æ˜¯å¼‚æ­¥çš„æƒ…å†µä¸‹, é‚£æˆ‘ä»¬åŒæ­¥æ‰§è¡Œresolveæ€ä¹ˆå°±ä¸è¡Œäº†å‘¢? åŸå› åœ¨äºå¼‚æ­¥çš„æ—¶å€™thenå…ˆäºresolveæ‰§è¡Œ, FulFiledCallBacksæ•°ç»„é‡Œå·²ç»æœ‰ä¸œè¥¿äº†, è€Œå½“åŒæ­¥æ‰§è¡Œçš„æ—¶å€™, æ•°ç»„é‡Œæ˜¯ç©ºçš„å‘€, å½“ç„¶ä»€ä¹ˆä¹Ÿä¸æ‰§è¡Œ, çŸ¥é“äº†åŸå› æ¥ä¿®æ”¹ä¸‹thenæ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span>(<span class="params">OnFulFiled, OnRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.status === PENDING) &#123;</span><br><span class="line">    <span class="keyword">this</span>.FulFiledCallBacks.push(OnFulFiled)</span><br><span class="line">    <span class="keyword">this</span>.RejectedCallBacks.push(OnRejected)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.status === FULFILED) &#123;</span><br><span class="line">    OnFulFiled(<span class="keyword">this</span>.value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.status === REJECTED) &#123;</span><br><span class="line">    OnRejected(<span class="keyword">this</span>.reason)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¿®æ”¹ä¸€ä¸‹, å°±å¯ä»¥åœ¨thené‡Œæ­£å¸¸æ‹¿åˆ°ç»“æœäº†, é‚£åˆæ˜¯ä¸ºä»€ä¹ˆå‘¢?  å…¶å®å°±æ˜¯åœ¨thené‡Œå¤šäº†ä¸€å±‚åˆ¤æ–­, å¦‚æœPromiseé‡Œä¼ å…¥çš„å›è°ƒæ˜¯åŒæ­¥çš„è¯, resolveä¸€å®šä¼šå…ˆäºthenæ‰§è¡Œ, resolveä¸€æ—¦æ‰§è¡Œ, Promiseé‡Œç»´æŠ¤çš„çŠ¶æ€å°±ä¼šå˜ä¸ºfulfiled, æˆ‘ä»¬åªè¦åˆ¤æ–­statusçš„å€¼æ˜¯å“ªä¸€ä¸ªå°±èƒ½çŸ¥é“resolveåˆ°åº•æ˜¯ä¸æ˜¯å¼‚æ­¥è°ƒç”¨, 1. å¦‚æœæ˜¯pendingé‚£å°±æ˜¯å¼‚æ­¥è°ƒç”¨, åˆ™æŠŠthené‡Œçš„å›è°ƒç¼“å­˜èµ·æ¥, ç­‰åˆ°resolveæ‰§è¡Œä»¥åå†æ‰§è¡Œ; 2. å¦‚æœfulfiled æˆ–è€…è¯´æ˜¯ rejected, åˆ™resolveæ˜¯åŒæ­¥æ‰§è¡Œ, å¦‚æœæ˜¯åŒæ­¥æ‰§è¡Œçš„è¯, æˆ‘ä»¬å°±ä¸å¾€ç¼“å­˜é‡Œæ”¾äº†, ç›´æ¥è°ƒç”¨! æ•°æ®åœ¨promiseçš„å®ä¾‹ä¸Šæœ‰ç›´æ¥ä¼ ï¼3. å¦‚æœæ˜¯rejectä¹Ÿä¸€æ ·, åªä¸è¿‡ä¼ å…¥çš„å€¼å°±æ˜¯reasonäº†</p><h2 id="thençš„é“¾å¼è°ƒç”¨"><a href="#thençš„é“¾å¼è°ƒç”¨" class="headerlink" title="thençš„é“¾å¼è°ƒç”¨"></a>thençš„é“¾å¼è°ƒç”¨</h2><p>Promiseçš„å‡ºç°æå¤§çš„è§£å†³äº†å¼‚æ­¥å›è°ƒä¸­å›è°ƒåœ°ç‹±çš„ç—›ç‚¹, é‚£ä¹ˆå®ƒæ˜¯æ€ä¹ˆè§£å†³çš„å‘¢ï¼Ÿ æ²¡é”™, é€šè¿‡thenæ–¹æ³•çš„é“¾å¼è°ƒç”¨, æˆ‘ä»¬å…ˆç”¨åŸç”Ÿçš„æ¥çœ‹ä¸‹ç”¨æ³•<br>ç”¨æ³•1</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> data = <span class="number">100</span></span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="number">100</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> promsie2 = promise.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);  <span class="comment">// 100</span></span><br><span class="line">  <span class="keyword">return</span> data + <span class="number">100</span></span><br><span class="line">&#125;)</span><br><span class="line">promise2.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123; </span><br><span class="line">  <span class="built_in">console</span>.log(data); <span class="comment">// 200</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>é€šè¿‡ç®€å•ä½¿ç”¨æˆ‘ä»¬å¯ä»¥å¾—å‡º, thenæœ€ç»ˆä¼šè¿”å›ä¸€ä¸ªpromiseå¯¹è±¡, ä¼ å…¥thené‡Œçš„å›è°ƒçš„è¿”å›å€¼ä¼šä½œä¸ºæ–°promiseå¯¹è±¡çš„thençš„å‚æ•°, æˆ‘ä»¬å†æ¥å®Œå–„ä¸‹æˆ‘ä»¬çš„thenæ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span>(<span class="params">OnFulFiled, OnRejected</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æ–°å»ºä¸€ä¸ªpromiseå®ä¾‹</span></span><br><span class="line">  <span class="keyword">let</span> promise2</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.status === PENDING) &#123;</span><br><span class="line">    promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ä¸å†æ˜¯ç›´æ¥å¾€æ•°ç»„é‡Œpush OnFulFiled, è€Œæ˜¯push</span></span><br><span class="line">      <span class="comment">// ä¸€ä¸ªæ–°æ–¹æ³•, è¯¥æ–¹æ³•å†…éƒ¨è°ƒç”¨OnFulFiled</span></span><br><span class="line">      <span class="keyword">this</span>.FulFiledCallBacks.push(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// æ¥æ”¶thené‡Œå›è°ƒçš„è¿”å›å€¼</span></span><br><span class="line">        <span class="keyword">let</span> x = OnFulFiled(value)</span><br><span class="line">        <span class="comment">// æ‹¿åˆ°è¿”å›å€¼ä»¥åå°±å¯ä»¥è°ƒç”¨æ–°çš„promiseçš„resolveæ–¹æ³•äº†</span></span><br><span class="line">        resolve(x)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">this</span>.RejectedCallBacks.push(<span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> x = OnRejected(reason)</span><br><span class="line">        reject(x)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.status === FULFILED) &#123;</span><br><span class="line">    promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> x = OnFulFiled(<span class="keyword">this</span>.value)</span><br><span class="line">      resolve(x)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.status === REJECTED) &#123;</span><br><span class="line">    promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> x = OnRejected(<span class="keyword">this</span>.reason)</span><br><span class="line">      resolve(x)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è¿”å›promiseå®ä¾‹</span></span><br><span class="line">  <span class="keyword">return</span> promise2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•è¯´ä¸‹å®Œå–„åçš„ä»£ç , å…¶å®å°±æ˜¯åœ¨thenæ–¹æ³•å†…éƒ¨è¿”å›ä¸€ä¸ªæ–°promise, è¿™ä¸ªæ–°promiseçš„resolveåœ¨æ‹¿åˆ°thenæ–¹æ³•çš„è¿”å›å€¼åä¼šç«‹å³æ‰§è¡Œ, ä¹Ÿå°±æ˜¯è¯´, åœ¨ç¬¬ä¸€ä¸ªthenæ–¹æ³•æ‰§è¡Œå®Œä»¥å(return ä»¥å)ç«‹å³æ‰§è¡Œæ–°promiseçš„thenæ–¹æ³•; ç›®å‰çš„thenæ–¹æ³•å·²ç»åŸºæœ¬å®ç°é“¾å¼è°ƒç”¨, ä½†ä¸æ˜¯å®Œç¾çš„, ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´,å› ä¸ºåŸç”Ÿpromise thenæ–¹æ³•é‡Œä¼ å…¥çš„å›è°ƒçš„è¿”å›å€¼å¯ä¸æ­¢åªæ˜¯è¿”å›ä¸€ä¸ªç®€å•çš„data, å†æ¥çœ‹çœ‹åŸç”Ÿçš„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">promise.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);  </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      resolve(data + <span class="number">100</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123; </span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æˆ–è€…æ›´æ¶å¿ƒğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">promise.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);  </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      resolve(<span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// æ­¤å¤„å¯ç»§ç»­ä¼ promiseå¯¹è±¡</span></span><br><span class="line">          resolve(data + <span class="number">100</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123; </span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¯è¿˜åˆºæ¿€ï¼Ÿ å®¢å®˜å¯è¿˜æ»¡æ„ï¼Ÿ å’³å’³.. æˆ‘ä»¬æ‰¾æ‰¾è§„å¾‹, å‘ç°è¿”å›promiseå¯¹è±¡çš„æƒ…å†µä¸‹, å†…éƒ¨çš„resolveæ— è®ºä¼ å…¥å¤šå°‘promiseå¯¹è±¡, thenè¿”å›çš„æ–°promiseçš„thenæ–¹æ³•åªä¼šæ‹¿åˆ°æœ€å†…å±‚é‚£ä¸ªæ™®é€šå¯¹è±¡æˆ–è€…æ•°æ®, åœ¨è¿™ä¸ªä¾‹å­ä¸­å°±æ˜¯<code>data+100</code>åºŸè¯å°‘è¯´, ç»§ç»­ä¼˜åŒ–ä»£ç ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸå…ˆçš„resolveå·²ç»æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚, è¿›åŒ–resolve</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolvePromise</span>(<span class="params">promise2, x, resolve, reject</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> called = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">let</span> then</span><br><span class="line">  <span class="keyword">if</span>(x === promise2) &#123;</span><br><span class="line">    <span class="keyword">return</span> reject(<span class="string">'promise2 will never be called'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// xå°±æ˜¯thenæ–¹æ³•é‡Œå›è°ƒçš„è¿”å›å€¼, åˆ¤æ–­xæ˜¯ä¸æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–è€…å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">if</span>((x !==<span class="literal">null</span>) &amp;&amp; ((<span class="keyword">typeof</span> x === <span class="string">'function'</span>) || (<span class="keyword">typeof</span> x === <span class="string">'object'</span>))) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      then = x.then      </span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123;</span><br><span class="line">        then.call(x, y =&gt; &#123;</span><br><span class="line">          <span class="comment">// æˆåŠŸçš„å›è°ƒ</span></span><br><span class="line">          <span class="comment">// calledæ˜¯ä¸€ä¸ªæ ‡å¿—ä½, ä¹Ÿå°±æ˜¯è¯´thenæ–¹æ³•çš„ç¬¬ä¸€ä¸ªæ–¹æ³•å’Œç¬¬äºŒä¸ªæ–¹æ³•åªèƒ½è°ƒç”¨å…¶ä¸­ä¸€ä¸ª</span></span><br><span class="line">          <span class="keyword">if</span>(called) <span class="keyword">return</span> </span><br><span class="line">          called = <span class="literal">true</span></span><br><span class="line">          <span class="comment">// é€’å½’è°ƒç”¨ å°†resolveé‡Œçš„å€¼ä¸€å±‚å±‚å‰¥ç¦», ç›´åˆ°æœ€åæ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡æˆ–è€…æ•°æ®</span></span><br><span class="line">          <span class="comment">// æˆ‘å°±ä¸ä¿¡ä½ èƒ½ä¸€ç›´å¾€é‡Œä¼ promiseå¯¹è±¡</span></span><br><span class="line">          <span class="keyword">return</span> resolvePromise(promise2, y, resolve, reject)</span><br><span class="line">        &#125;, () =&gt; &#123;</span><br><span class="line">          <span class="comment">// å¤±è´¥çš„å›è°ƒ</span></span><br><span class="line">          <span class="keyword">if</span>(called) <span class="keyword">return</span> </span><br><span class="line">          called = <span class="literal">true</span> </span><br><span class="line">          <span class="keyword">return</span> reject()</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// xåªæ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡, åªæ˜¯æœ‰thenæ–¹æ³•è€Œå·², ç›´æ¥resolve</span></span><br><span class="line">        resolve(x)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;<span class="keyword">catch</span>(err) &#123;</span><br><span class="line">      <span class="keyword">if</span>(called) <span class="keyword">return</span> </span><br><span class="line">      called = <span class="literal">true</span> </span><br><span class="line">      <span class="keyword">return</span> reject(err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// xæ˜¯ä¸ªæ™®é€šå€¼ï¼Œ ç›´æ¥resolveå°±å¯ä»¥äº†</span></span><br><span class="line">    resolve(x)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span>(<span class="params">OnFulFiled, OnRejected</span>) </span>&#123;</span><br><span class="line">  OnFulFiled = <span class="keyword">typeof</span> OnFulFiled === <span class="string">'function'</span> ? OnFulFiled : <span class="function"><span class="params">v</span> =&gt;</span> v </span><br><span class="line">  OnRejected = <span class="keyword">typeof</span> OnRejected === <span class="string">'function'</span> ? OnRejected : <span class="function"><span class="params">err</span> =&gt;</span> &#123; <span class="built_in">console</span>.log(err) &#125;</span><br><span class="line">  <span class="keyword">let</span> promise2</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.status === PENDING) &#123;</span><br><span class="line">    promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.FulFiledCallBacks.push(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> x = OnFulFiled(value)</span><br><span class="line">        resolvePromise(promise2, x, resolve, reject)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">this</span>.RejectedCallBacks.push(<span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> x = OnRejected(reason)</span><br><span class="line">        resolvePromise(promise2, x, resolve, reject)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.status === FULFILED) &#123;</span><br><span class="line">    promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> x = OnFulFiled(<span class="keyword">this</span>.value)</span><br><span class="line">      resolvePromise(promise2, x, resolve, reject)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.status === REJECTED) &#123;</span><br><span class="line">    promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> x = OnRejected(<span class="keyword">this</span>.reason)</span><br><span class="line">      resolvePromise(promise2, x, resolve, reject)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> promise2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›®å‰çœ‹æ¥Promiseçš„åŸºæœ¬åŠŸèƒ½å·²ç»åŸºæœ¬å®ç°, åªæ˜¯ä¸ºäº†é€šè¿‡æ‰€æœ‰<code>promises-aplus-tests</code>çš„æµ‹è¯•ç”¨ä¾‹, æˆ‘ä»¬è¿˜éœ€è¦æ ¹æ®promise/A+è§„èŒƒåšä¸€ç‚¹ç‚¹ä¿®æ”¹</p><figure class="image-box">                <img src="1.png" alt="" title="" class="">                <p></p>            </figure><p>å“å‘€, èˆ’æœäº†<br>ç¢äºç¯‡å¹…, æœ€ç»ˆå®Œæ•´ä»£ç å°±æ”¾<a href="https://github.com/HanRenHui/Promise" target="_blank" rel="noopener">GitHubä»“åº“äº†</a></p><p>ä¸€ä¸å°å¿ƒåäºŒç‚¹åŠäº†, å°å‘½è¦ç´§, å…ˆå»ä¼‘æ¯äº†, æ˜æ—©å†æ›´å‰©ä¸‹çš„ä¸€ nai nai ~~, åŒ…æ‹¬Promiseç±»ä¸Šçš„ä¸€äº›æ–¹æ³•, å’Œæ¶‰åŠä¸€ä¸‹Qå’Œbluebirdä¸¤ä¸ªåº“</p><hr><h1 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all"></a>Promise.all</h1><p>æ¥ä¸‹æ¥å†™Promiseç±»ä¸Šçš„allæ–¹æ³•, allæ–¹æ³•é‡Œæ¥æ”¶ä¸€ä¸ªç”±promiseå¯¹è±¡ç»„æˆçš„æ•°ç»„å¹¶è¿”å›ä¸€ä¸ªæ–°promise, æ•°ç»„ä¸­æ‰€æœ‰çš„promiseéƒ½æˆåŠŸä»¥åæ–°promiseä¹ŸæˆåŠŸ, æ•°ç»„ä¸­æœ‰ä¸€ä¸ªpromiseå¤±è´¥ä»¥å, æ–°promiseä¹Ÿå¤±è´¥ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.all = <span class="function"><span class="keyword">function</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> dataArr = &#123;&#125;</span><br><span class="line">  arr.forEach(<span class="function"><span class="params">p</span> =&gt;</span> &#123;</span><br><span class="line">    p.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// dataArré‡Œå­˜æ”¾æ‰€æœ‰promiseæˆåŠŸåçš„ç»“æœ, è€Œä¸”</span></span><br><span class="line">      <span class="comment">// è¦æŒ‰ç…§åœ¨æ•°ç»„é‡Œçš„é¡ºåº</span></span><br><span class="line">      dataArr[index] = data </span><br><span class="line">    <span class="comment">// æ•°ç»„é‡Œæ‰€æœ‰promiseéƒ½æœ‰ç»“æœä»¥å, è°ƒç”¨resolve</span></span><br><span class="line">      <span class="keyword">if</span>(++index &gt;= arr.length) resolve(dataArr)</span><br><span class="line">      <span class="comment">// ä¸€æ—¦æœ‰ä¸€ä¸ªå‡ºé”™å°±è°ƒç”¨reject</span></span><br><span class="line">    &#125;, reject)</span><br><span class="line">  &#125;)</span><br><span class="line"> &#125;) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Promise-race"><a href="#Promise-race" class="headerlink" title="Promise.race"></a>Promise.race</h1><p>è¯¥æ–¹æ³•å’Œallç±»ä¼¼, allä¹Ÿä¼šè¿”å›ä¸€ä¸ªpromise, åªä¸è¿‡è¯¥promiseçš„çŠ¶æ€ç”±æ•°ç»„é‡Œæœ€å…ˆæœ‰ç»“æœçš„promsieæ¥å†³å®š, ä¹Ÿå°±æ˜¯è¯´æœ€å…ˆæœ‰ç»“æœçš„é‚£ä¸ªpromiseæ˜¯æˆåŠŸæ€, é‚£ä¹ˆæ–°çš„promiseå°±æ˜¯æˆåŠŸæ€, å¦åˆ™promiseå°±æ˜¯å¤±è´¥æ€</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.race = <span class="function"><span class="keyword">function</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    arr.forEach(<span class="function"><span class="params">p</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// è°å…ˆæœ‰ç»“æœ, å°±ç”±è°å†³å®šæ–°promiseçš„çŠ¶æ€</span></span><br><span class="line">      p.then(resolve, reject)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Q"><a href="#Q" class="headerlink" title="Q"></a>Q</h1><p>Qä¹Ÿæ˜¯promiseè§„èŒƒçš„ä¸€ç§å®ç°, ç°åœ¨è§çš„æ¯”è¾ƒå°‘, çœ‹ä¸‹åŸºæœ¬ä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFile</span>(<span class="params">pathname</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> defer = Q.defer()</span><br><span class="line">  fs.readFile(path.join(<span class="string">'./'</span>, pathname), <span class="string">'utf-8'</span>, (err, data) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(err) &#123;</span><br><span class="line">      defer.reject(err)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      defer.resolve(data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> defer.promise</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">readFile(<span class="string">'a.txt'</span>).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">  </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="Qçš„åŸºæœ¬å®ç°"><a href="#Qçš„åŸºæœ¬å®ç°" class="headerlink" title="Qçš„åŸºæœ¬å®ç°"></a>Qçš„åŸºæœ¬å®ç°</h2><p>æˆ‘ä»¬ç¨å¾®å®ç°ä¸‹Qçš„ä¸Šè¾¹å‡ ä¸ªæ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Q = &#123;</span><br><span class="line">  defer: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ç¼“å­˜thené‡Œçš„æˆåŠŸçš„å›è°ƒ</span></span><br><span class="line">    <span class="keyword">let</span> success </span><br><span class="line">    <span class="comment">// ç¼“å­˜thené‡Œçš„å¤±è´¥å›è°ƒ</span></span><br><span class="line">    <span class="keyword">let</span> error</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      reject: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨å¤±è´¥å›è°ƒ</span></span><br><span class="line">        error()</span><br><span class="line">      &#125;,</span><br><span class="line">      resolve: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨æˆåŠŸå›è°ƒ</span></span><br><span class="line">        success()</span><br><span class="line">      &#125;,</span><br><span class="line">      promise: &#123;</span><br><span class="line">        then: <span class="function"><span class="keyword">function</span>(<span class="params">onFulfiled, onRejected</span>) </span>&#123;</span><br><span class="line">          success = onFulfiled</span><br><span class="line">          error = onRejected</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="blueBird"><a href="#blueBird" class="headerlink" title="blueBird"></a>blueBird</h1><p>å…³äºblueBird, å·ç§°æœ€å¿«çš„promiseåº“, æœ€å¸¸ç”¨çš„å°±æ˜¯å®ƒé‡Œé¢çš„promisefyæ–¹æ³•äº† æˆ‘ä»¬ç®€å•å®ç°ä¸‹å§å°±</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">promisefy</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...params</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      fn(...params, (err, data) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span>(err) reject(err)</span><br><span class="line">        resolve(data)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†™çš„æœ‰ç‚¹æƒ³å</p><p>ä»¥ä¸Š</p>]]></content>
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> JavaScript </category>
          
          <category> å¼‚æ­¥ </category>
          
          <category> Promise </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> JavaScript </tag>
            
            <tag> å¼‚æ­¥ </tag>
            
            <tag> Promise </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å¼‚æ­¥è§£å†³æ–¹æ¡ˆğŸš€</title>
      <link href="/blog/2019/03/20/%E5%BC%82%E6%AD%A5%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
      <url>/blog/2019/03/20/%E5%BC%82%E6%AD%A5%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
      <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¿™æ˜¯ä¸€ç¯‡æ—¶é—´è·¨åº¦åå¹´çš„ä¸€ç¯‡ç¬”è®°, è®°å½•ä¸‹å¼‚æ­¥å¦‚ä½•ä¸€æ­¥æ­¥å‘å±•åˆ°ç¥ä¼¼åŒæ­¥ç¼–ç¨‹çš„ğŸ‘‡,  æ ¹æ®æ–¹æ¡ˆå‡ºç°å…ˆååˆ†ä¸ºä¸‹é¢å‡ ç§</p><ul><li>å›è°ƒå‡½æ•°</li><li>å‘å¸ƒ/è®¢é˜…</li><li>Promise/A+</li><li>Generator</li><li>Async/Await</li></ul><h1 id="å›è°ƒå‡½æ•°"><a href="#å›è°ƒå‡½æ•°" class="headerlink" title="å›è°ƒå‡½æ•°"></a>å›è°ƒå‡½æ•°</h1><p>è¿™åº”è¯¥æ˜¯æ—¥å¸¸codingä¸­æœ€å¸¸è§çš„ä¸€ç§äº†å§, æ¥å›å¿†ä¸‹æˆ‘ä»¬æ˜¯æ€ä¹ˆç”¨çš„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">'fs'</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">'path'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  fs.readFile(path.join(<span class="string">'./'</span>, <span class="string">'a.txt'</span>), <span class="string">'a.txt'</span>, (err, data) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">read()</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡å›è°ƒå‡½æ•°æ‹¿åˆ°äº†å¼‚æ­¥å‡½æ•°çš„æ•°æ®, çœ‹ç€ä¹ŸæŒºèˆ’æœçš„, ä½†æ˜¯å›è°ƒå‡½æ•°å´å­˜åœ¨å‡ ä¸ªé—®é¢˜</p><ul><li>æ— æ³•é€šè¿‡try/catchæ¥æ•è·å¼‚å¸¸</li><li>å›è°ƒåœ°ç‹±</li></ul><p>å…ˆæ¥çœ‹ç¬¬ä¸€æ¡, æ— æ³•æ•è·å¼‚å¸¸, æ¯”å¦‚æˆ‘ä»¬åœ¨<code>read</code>å‡½æ•°æ‰§è¡Œçš„æ—¶å€™æƒ³è¦æ•è·å¼‚å¸¸, åƒè¿™æ ·</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  fs.readFile(path.join(<span class="string">'./'</span>, <span class="string">'a.txt'</span>), <span class="string">'a.txt'</span>, (err, data) =&gt; &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">'å‡ºé”™'</span>)</span><br><span class="line">    <span class="keyword">if</span>(err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(data)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">  read()  </span><br><span class="line">&#125;<span class="keyword">catch</span>(err) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨å›è°ƒå‡½æ•°ä¸­æ•…æ„å‡ºä¸€ä¸ªå¼‚å¸¸, å¹¶è¯•å›¾åœ¨readæ‰§è¡Œçš„æ—¶å€™æ•è·ï¼Œä½†å´å‘ç°å¹¶æœªæ•è·åˆ°ï¼ŒåŸå› æ˜¯å½“tryåœ¨ç›‘å¬readçš„æ—¶å€™å›è°ƒå¹¶æœªæ‰§è¡Œ, è€Œå½“å¼‚æ­¥æœ‰äº†ç»“æœå›è°ƒæ‰§è¡Œçš„æ—¶å€™ï¼Œreadå‡½æ•°å·²ç»è„±ç¦»äº†tryçš„ç›‘ç®¡ï¼Œæ‰€ä»¥æ•è·ä¸åˆ°äº†</p><p>å†æ¥çœ‹ç¬¬äºŒæ¡, é‚£å°±æ˜¯è‡­åæ˜­è‘—çš„å›è°ƒåœ°ç‹±äº†, å›è°ƒåœ°ç‹±æ˜¯æ€ä¹ˆå½¢æˆçš„å‘¢ï¼Ÿ å…¶å®æ˜¯ä¸€ä¸ªå¼‚æ­¥ç»“æœä¾èµ–äºå¦ä¸€ä¸ªå¼‚æ­¥ç»“æœï¼Œä¸€å±‚å¥—ä¸€å±‚, æœ€åå½¢æˆä»£ç è‡ƒè‚¿, æéš¾ç»´æŠ¤çš„å›è°ƒåœ°ç‹±ï¼Œ å°±åƒä¸‹é¢è¿™æ ·ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(path.join(<span class="string">'./'</span>, <span class="string">'a.txt'</span>), <span class="string">'a.txt'</span>, (err, data1) =&gt; &#123;</span><br><span class="line">  fs.readFile(path.join(<span class="string">'./'</span>, <span class="string">'b.txt'</span>), <span class="string">'a.txt'</span>, (err, data2) =&gt; &#123;</span><br><span class="line">    fs.readFile(path.join(<span class="string">'./'</span>, <span class="string">'c.txt'</span>), <span class="string">'a.txt'</span>, (err, data3) =&gt; &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¥½æ¶å¿ƒğŸ¤¢, çœ‹æ€ä¹ˆä¸€æ­¥æ­¥çš„è§£å†³è¿™äº›é—®é¢˜</p><h1 id="å‘å¸ƒ-è®¢é˜…"><a href="#å‘å¸ƒ-è®¢é˜…" class="headerlink" title="å‘å¸ƒ/è®¢é˜…"></a>å‘å¸ƒ/è®¢é˜…</h1><p>åœ¨ä¸Šè¾¹æåˆ°çš„å›è°ƒåœ°ç‹±ä¸­ï¼Œå…¶å®æ•ˆç‡æ˜¯ç‰¹åˆ«ä½çš„, å› ä¸ºä¸Šè¾¹è¿™ç§æ–¹æ³•æ˜¯ä¸²è¡Œçš„, ä¸€ä¸ªå¼‚æ­¥å‡½æ•°éœ€è¦ç­‰åˆ°ä¸Šä¸€ä¸ªå¼‚æ­¥ç»“æœæ¥äº†ä»¥åæ‰èƒ½å¤Ÿæ‰§è¡Œ, å‡å¦‚è¯´ä¸€ä¸ªå¼‚æ­¥æ‰§è¡Œå®Œéœ€è¦1s, é‚£ä¹ˆåµŒå¥—å¤šå°‘å±‚å°±æ˜¯å¤šå°‘ç§’, å…¶å®æˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ”¹æˆå¹¶è¡Œ, æ²¡å¿…è¦éè¦ç­‰ä¸Šä¸€ä¸ªå¼‚æ­¥çš„ç»“æœï¼Œè€Œæ˜¯æ‰€æœ‰çš„å¼‚æ­¥åŒæ—¶æ‰§è¡Œ, å†å°†æœ€ç»ˆçš„ç»“æœæ±‡æ€», è¿™æ—¶æˆ‘ä»¬éœ€è¦ä¾èµ–<code>node</code>ä¸­çš„ä¸€ä¸ªå«åšâ€™eventsâ€™çš„åº“, çœ‹æ€ä¹ˆç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">'path'</span></span><br><span class="line"><span class="keyword">import</span> eventEmits <span class="keyword">from</span> <span class="string">'events'</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">'fs'</span></span><br><span class="line"><span class="keyword">let</span> ele = <span class="keyword">new</span> eventEmits() </span><br><span class="line"><span class="keyword">let</span> temp = &#123;&#125;</span><br><span class="line">ele.on(<span class="string">'ready'</span>, (key, value) =&gt; &#123;</span><br><span class="line">    temp[key] = value </span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Object</span>.keys(temp).length === <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(temp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fs.readFile(path.join(<span class="string">'./'</span>, <span class="string">'a.txt'</span>), <span class="string">'utf-8'</span>, (err,data) =&gt; &#123;</span><br><span class="line">  ele.emit(<span class="string">'ready'</span>,<span class="string">'a'</span>, data)</span><br><span class="line">&#125;)</span><br><span class="line">fs.readFile(path.join(<span class="string">'./'</span>, <span class="string">'a.txt'</span>), <span class="string">'utf-8'</span>, (err,data) =&gt; &#123;</span><br><span class="line">  ele.emit(<span class="string">'ready'</span>,<span class="string">'b'</span>, data)</span><br><span class="line">&#125;)</span><br><span class="line">fs.readFile(path.join(<span class="string">'./'</span>, <span class="string">'c.txt'</span>), <span class="string">'utf-8'</span>, (err,data) =&gt; &#123;</span><br><span class="line">  ele.emit(<span class="string">'ready'</span>,<span class="string">'c'</span>, data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡å®ä¾‹åŒ–ä¸€ä¸ªeventEmitså¯¹è±¡, è¿™ä¸ªå¯¹è±¡ç»™æˆ‘ä»¬æä¾›äº†<code>emit</code>æ–¹æ³•ï¼Œå’Œ<code>on</code>æ–¹æ³•, æ¯å½“å¼‚æ­¥æœ‰ç»“æœçš„æ—¶å€™éƒ½ä¼šè°ƒç”¨emitæ–¹æ³•, emitè°ƒç”¨ä»¥å, onå°±èƒ½ç›‘å¬åˆ°, ä¼ ç»™emitçš„åä¸¤ä¸ªå‚æ•°å°±ä¼šä¼ ç»™onçš„å›è°ƒ, åœ¨onçš„å›è°ƒé‡Œï¼Œæœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œ è¯¥å¯¹è±¡é€šè¿‡å¯¹åº”çš„é”®åæ”¾ç½®å¯¹åº”çš„ç»“æœæ•°æ®çš„æ–¹å¼æ¥æš‚æ—¶å­˜æ”¾å¼‚æ­¥ç»“æœï¼Œç­‰åˆ°æ‰€æœ‰çš„ç»“æœéƒ½æ¥ä»¥åå†åšå¤„ç†(é€šè¿‡tempé”®çš„ä¸ªæ•°æ¥åˆ¤æ–­æ˜¯å¦æ‰€æœ‰çš„ç»“æœéƒ½å·²ç»æ¥äº†), è¿™æ ·å°±å°†ä¸²è¡Œè½¬ä¸ºäº†å¹¶è¡ŒğŸ˜€</p><h1 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h1><p><code>promise</code>çš„å‡ºç°ä¹Ÿæ˜¯ä¸ºäº†è§£å†³å›è°ƒåœ°ç‹±åœ°ç‹±é—®é¢˜çš„ï¼Œçœ‹æ€ä¹ˆç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  fs.readFile(path.join(<span class="string">'./'</span>, <span class="string">'a.txt'</span>), <span class="string">'utf-8'</span>, (err,data) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(err) reject(err)</span><br><span class="line">    resolve(data)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.readFile(path.join(<span class="string">'./'</span>, <span class="string">'b.txt'</span>), <span class="string">'utf-8'</span>, (err,data) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span>(err) reject(err)</span><br><span class="line">      resolve(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;, err =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>é¦–å…ˆç»™Promiseçš„æ„é€ å‡½æ•°ä¸­ä¼ å…¥ä¸€ä¸ªå›è°ƒ, åœ¨Promiseå®ä¾‹åŒ–çš„æ—¶å€™è¿™ä¸ªå›è°ƒä¼šç«‹é©¬è°ƒç”¨, å½“å›è°ƒé‡Œçš„å¼‚æ­¥æœ‰äº†ç»“æœä»¥åå°±ä¼šç«‹é©¬è°ƒç”¨<code>resolve</code>å¹¶æŠŠå¼‚æ­¥ç»“æœä¼ è¿›å», resolveè°ƒç”¨ä»¥åå°±ä¼šç«‹é©¬è°ƒç”¨thené‡Œçš„å›è°ƒï¼Œå¼‚æ­¥ç»“æœæœ€ç»ˆå°±æ˜¯ä¼ åˆ°è¿™é‡Œæ¥äº†, thenæ–¹æ³•ä¹Ÿä¼šè¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œæ‰€ä»¥ä½ å¯ä»¥é“¾å¼è°ƒç”¨thenæ–¹æ³•ï¼Œä»æ¥å°†å›è°ƒåœ°ç‹±ç“¦è§£(ps: å…³äºpromiseè¿™é‡Œå°±ä¸ç»†è¯´äº†ï¼Œä¸‹ç¯‡ç¬”è®° æˆ‘ä»¬ç»†è¯´promiseçš„å…·ä½“å®ç°ï¼Œå¹¶é€šè¿‡promises-aplus-testæµ‹è¯•)</p><h1 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h1><p>ç›´æ¥çœ‹ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="keyword">yield</span> <span class="number">1</span> </span><br><span class="line">  <span class="built_in">console</span>.log(a)</span><br><span class="line">  <span class="keyword">let</span> b = <span class="keyword">yield</span> <span class="number">2</span> </span><br><span class="line">  <span class="built_in">console</span>.log(b)</span><br><span class="line">  <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> it = read() </span><br><span class="line">it.next() <span class="comment">// &#123; value: 1, done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123; value: 2, done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123; value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­çš„readæ˜¯ä¸€ä¸ª<code>ç”Ÿæˆå™¨</code>å‡½æ•°ï¼Œè°ƒç”¨å®ƒä¼šè¿”å›ä¸€ä¸ª<code>è¿­ä»£å™¨</code>, åœ¨Generatorå‡½æ•°ä¸­, å‡½æ•°æ‰§è¡Œåˆ°<code>yield</code>æ ‡è¯†ç¬¦æ—¶å°±ä¼šåœæ­¢æ‰§è¡Œ, éœ€è°ƒç”¨nextæ‰‹åŠ¨è§¦å‘, å°±åƒBOSSæ‹¿ç€é­å­èµ¶ä½ å¹²æ´»ä¸€æ ·, é€šè¿‡è°ƒç”¨<code>next</code>æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæœ‰<code>value</code>å’Œ<code>done</code>å±æ€§çš„å¯¹è±¡, valueçš„å€¼å°±æ˜¯yieldåé¢çš„å€¼, doneæ˜¯ä¸ªæ ‡å¿—ä½, æ ‡å¿—ç€æ˜¯å¦è¿˜æœ‰æœªæ‰§è¡Œçš„yieldè¯­å¥æˆ–è€…è¯´Generatorå‡½æ•°æ˜¯å¦å·²ç»æ‰§è¡Œå®Œ, è¯´äº†é‚£ä¹ˆå¤šæ˜¯ä¸æ˜¯è§‰å¾—è¿™ä¸ªå‡½æ•°ç‰¹åˆ«æ²¡ç”¨ï¼Ÿ ä¸€ä¸ªç ´å‡½æ•°, æ‰§è¡Œè¿˜å¾—æˆ‘ä¸€æ­¥æ­¥æ¨ç€ä½ , åºŸç‰©ï¼ æ²¡é”™å°±æ˜¯ä¸ªåºŸç‰©, è‡³å°‘ç›®å‰æ¥è¯´, ä½†æ˜¯<code>Generator</code>ä¸€æ—¦æ­é…èµ·<code>Promise</code>, ç›¸ä¿¡æˆ‘, ä½ ä¼šå¤§åƒä¸€æƒŠ, Amazingï¼ show you the codeğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†å¼‚æ­¥æ–¹æ³•promiseåŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">promisefy</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...params</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      fn(...params,(err, data) =&gt; &#123;</span><br><span class="line">        resolve(data)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// promiseåŒ–fs.readFile</span></span><br><span class="line"><span class="keyword">let</span> readFile = promisefy(fs.readFile)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="keyword">yield</span> readFile(path.join(<span class="string">'./'</span>, <span class="string">'a.txt'</span>), <span class="string">'utf-8'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(a);</span><br><span class="line">  <span class="keyword">let</span> b = <span class="keyword">yield</span> readFile(path.join(<span class="string">'./'</span>, <span class="string">'b.txt'</span>), <span class="string">'utf-8'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(b);</span><br><span class="line">  <span class="keyword">let</span> c = <span class="keyword">yield</span> readFile(path.join(<span class="string">'./'</span>, <span class="string">'c.txt'</span>), <span class="string">'utf-8'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(c);</span><br><span class="line">  <span class="keyword">return</span> c</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> it = read() </span><br><span class="line"><span class="comment">// it.next().value å°±æ˜¯promiseå¯¹è±¡, é€šè¿‡thenæ‹¿åˆ°dataå¹¶èµ‹ç»™ç­‰å·å‰è¾¹é‚£ä¸ªå˜é‡</span></span><br><span class="line">it.next().value.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  it.next(data).value.then(<span class="function"><span class="params">data</span>  =&gt;</span> &#123;</span><br><span class="line">    it.next(data).value.then(<span class="function"><span class="params">data</span>  =&gt;</span> &#123;</span><br><span class="line">      it.next(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è§£é‡Šä¸‹è¿™æ®µä»£ç , <code>promisefy</code>å‡½æ•°å°†fsçš„<code>readFile</code>è¿™ä¸ªæ–¹æ³•<code>promise</code>åŒ–, ä¹Ÿå°±æ˜¯å°†å¼‚æ­¥æœ€ç»ˆçš„ç»“æœäº¤ç»™äº†<code>resolve</code>, ä¹Ÿå°±æ˜¯è¯´é€šè¿‡è°ƒç”¨itè¿”å›çš„é‚£ä¸ªå¯¹è±¡çš„<code>value</code>å€¼æ˜¯ä¸ª<code>promise</code>å¯¹è±¡, æˆ‘ä»¬é€šè¿‡è°ƒç”¨<code>then</code>æ–¹æ³•å°±å¯ä»¥æ‹¿åˆ°å¼‚æ­¥çš„ç»“æœ, æˆ‘ä»¬éš¾é“å¼‚æ­¥ç»“æœä»¥åå†æ¬¡è°ƒç”¨<code>next</code>æ–¹æ³•å¹¶å°†<code>data</code>ä¼ å…¥ä¸å°±å°†å¼‚æ­¥ç»“æœèµ‹ç»™å®ƒç­‰å·å·¦è¾¹çš„å˜é‡äº†ä¹ˆ? ä½†æ˜¯è¿™æ ·å†™è¿˜æ˜¯éº»çƒ¦, åœ¨readå‡½æ•°é‡Œæˆ‘ä»¬åªæœ‰ä¸‰ä¸ªå¼‚æ­¥æ–¹æ³•æ‰€ä»¥æœ€åè¿™ä¸ªåµŒå¥—æ‰§è¡Œè¿˜ç®—å¥½ç‚¹, ä½†æ˜¯å¼‚æ­¥ä¸€å¤šå‘¢ï¼Ÿ æ— é™å†™ä¸‹å»å—ï¼Ÿ åªæœ‰è¦éº»çƒ¦åœ¨ï¼Œå°±æœ‰è§£å†³æ–¹æ¡ˆ, ç›¸æ¯”å¤§å®¶å¯èƒ½å¬è¿‡<strong>co</strong>åº“, æ²¡é”™, ä»–å°±æ˜¯ç”¨æ¥è‡ªåŠ¨æ‰§è¡Œreadæ–¹æ³•çš„, çœ‹æ€ä¹ˆä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> co = <span class="built_in">require</span>(<span class="string">'co'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">promisefy</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...params</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      fn(...params,(err, data) =&gt; &#123;</span><br><span class="line">        resolve(data)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// promiseåŒ–fs.readFile</span></span><br><span class="line"><span class="keyword">let</span> readFile = promisefy(fs.readFile)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="keyword">yield</span> readFile(path.join(<span class="string">'./'</span>, <span class="string">'a.txt'</span>), <span class="string">'utf-8'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(a); <span class="comment">// aaaaaa</span></span><br><span class="line">  <span class="keyword">let</span> b = <span class="keyword">yield</span> readFile(path.join(<span class="string">'./'</span>, <span class="string">'b.txt'</span>), <span class="string">'utf-8'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(b); <span class="comment">// bbbbbb</span></span><br><span class="line">  <span class="keyword">let</span> c = <span class="keyword">yield</span> readFile(path.join(<span class="string">'./'</span>, <span class="string">'c.txt'</span>), <span class="string">'utf-8'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(c); <span class="comment">// cccccc</span></span><br><span class="line">  <span class="keyword">return</span> c       </span><br><span class="line">&#125; </span><br><span class="line">co(read).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)   <span class="comment">// ccccccc</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯ç‰¹åˆ«ç®€å•? åªè¦å°†readä½œä¸ºå‚æ•°ä¼ ç»™coå°±å¯ä»¥äº†, æ˜¯ä¸æ˜¯èˆ’æœå¤šäº†, èˆ’æœå¤Ÿäº†æˆ‘ä»¬è‡ªå·±å†™ä¸€ä¸ªç®€å•çš„coæ–¹æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">co</span>(<span class="params">gen</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> it = gen() </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    !<span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">let</span> &#123; value, done &#125; = it.next(data)</span><br><span class="line">      <span class="keyword">if</span>(done) <span class="keyword">return</span> resolve(data)</span><br><span class="line">      value.then(next)</span><br><span class="line">    &#125;()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <code>co</code>å†…éƒ¨å…¶å®å°±æ˜¯å¯¹<code>next</code>æ–¹æ³•çš„ä¸€ä¸ªé€’å½’è°ƒç”¨, å…¶å®å°±æ˜¯ç®€åŒ–äº†æˆ‘ä»¬ä¸Šè¾¹å†™çš„ä¸‹è¾¹è¿™ç§å®ç°è€Œå·²,åœ¨doneä¸ºtrueä¹‹å‰é€’å½’è°ƒç”¨nextæ–¹æ³•, ä¸ºtrueä»¥åè°ƒç”¨resolveæ–¹æ³•, å¹¶returnç»“æŸé€’å½’è°ƒç”¨, è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆcoé€šè¿‡thenæ–¹æ³•å¯ä»¥æ‹¿åˆ°Generatorå‡½æ•°å†…éƒ¨æœ€ç»ˆå€¼çš„åŸå› </p> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">it.next().value.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  it.next(data).value.then(<span class="function"><span class="params">data</span>  =&gt;</span> &#123;</span><br><span class="line">    it.next(data).value.then(<span class="function"><span class="params">data</span>  =&gt;</span> &#123;</span><br><span class="line">      it.next(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p> ç›®å‰çš„Generatorè§£å†³æ–¹æ¡ˆå·²ç»æ˜¯å°†å¼‚æ­¥ä»£ç åŒæ­¥åŒ–ä¹¦å†™äº†, ä¸å¤ªå‹å¥½çš„åœ°æ–¹å°±æ˜¯éœ€è¦å€ŸåŠ©coåº“, ä¸è¿‡ä¹Ÿå°±æ˜¯å‡ è¡Œä»£ç äº†, ä¸‹é¢è¿™ç§æ–¹æ³•å¯å·ç§°å¼‚æ­¥é—®é¢˜ç»ˆæè§£å†³æ–¹æ¡ˆäº†, å»çœ‹çœ‹</p><h1 id="Async-Await"><a href="#Async-Await" class="headerlink" title="Async/Await"></a>Async/Await</h1><p>çœ‹æ€ä¹ˆç”¨ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="keyword">await</span> readFile(path.join(<span class="string">'./'</span>, <span class="string">'a.txt'</span>), <span class="string">'utf-8'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(a);</span><br><span class="line">  <span class="keyword">let</span> b = <span class="keyword">await</span> readFile(path.join(<span class="string">'./'</span>, <span class="string">'b.txt'</span>), <span class="string">'utf-8'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(b);</span><br><span class="line">  <span class="keyword">let</span> c = <span class="keyword">await</span> readFile(path.join(<span class="string">'./'</span>, <span class="string">'c.txt'</span>), <span class="string">'utf-8'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">read()</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯ç‰¹åˆ«ç®€å•äº†, è€Œä¸”å®Œå…¨çœ‹ä¸å‡ºæ˜¯å¼‚æ­¥æ“ä½œ, é‚£ä¹ˆé—®é¢˜æ¥äº†, ä»–æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰å‘ç°, è¿™ä¸ªæœ‰ç‚¹å†™æ³•æœ‰ç‚¹çœ¼ç†Ÿï¼Ÿ æ²¡é”™, async/awaitå°±æ˜¯Genaratorå‡½æ•°çš„è¯­æ³•ç³–, ä¸è¿‡æ˜¯å†…ç½®äº†è‡ªåŠ¨æ‰§è¡Œå™¨çš„Genaratorç½¢äº†, æˆ‘ä»¬æ¥è‡ªå·±æ¨¡æ‹Ÿä¸‹å§</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å…¶å®å°±æ˜¯å†…ç½®äº†è‡ªåŠ¨æ‰§è¡Œå™¨, å¹¶å°†aysncå‡½æ•°ä½“æ‰”äº†è¿›æ¥è®©ä»–è‡ªåŠ¨æ‰§è¡Œæ€•äº†</span></span><br><span class="line">  <span class="keyword">return</span> co(<span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="keyword">yield</span> readFile(path.join(<span class="string">'./'</span>, <span class="string">'a.txt'</span>), <span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">    <span class="keyword">let</span> b = <span class="keyword">yield</span> readFile(path.join(<span class="string">'./'</span>, <span class="string">'b.txt'</span>), <span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">    <span class="keyword">let</span> c = <span class="keyword">yield</span> readFile(path.join(<span class="string">'./'</span>, <span class="string">'c.txt'</span>), <span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(c);</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// è‡ªåŠ¨æ‰§è¡Œå™¨</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">co</span>(<span class="params">gen</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> it = gen() </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      !<span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> &#123; value, done &#125; = it.next(data)</span><br><span class="line">        <span class="keyword">if</span>(done)  <span class="keyword">return</span> resolve(data)</span><br><span class="line">        value.then(next)</span><br><span class="line">      &#125;()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">read()</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯ç‰¹åˆ«ç®€å•, ç”¨çš„æ—¶å€™æ„Ÿè§‰æŒºç¥ç§˜çš„, å…¶å®ä¹Ÿå°±é‚£ä¹ˆå›äº‹ğŸ˜€</p>]]></content>
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> JavaScript </category>
          
          <category> å¼‚æ­¥ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> JavaScript </tag>
            
            <tag> å¼‚æ­¥ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Reactå­¦ä¹ ä¹‹å®ç°Reduxä¸­é—´ä»¶âš¡</title>
      <link href="/blog/2019/03/02/%E5%90%84%E7%A7%8DRedex%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%9E%E7%8E%B0/"/>
      <url>/blog/2019/03/02/%E5%90%84%E7%A7%8DRedex%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%9E%E7%8E%B0/</url>
      <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ€è¿‘å¤„äºReactç—´è¿·çŠ¶æ€ï¼Œä»Šå¤©è®°å½•å„ç§Reduxä¸­é—´ä»¶çš„å®ç°</p><h1 id="æ—¥å¿—-logger-ä¸­é—´ä»¶"><a href="#æ—¥å¿—-logger-ä¸­é—´ä»¶" class="headerlink" title="æ—¥å¿—(logger)ä¸­é—´ä»¶"></a>æ—¥å¿—(logger)ä¸­é—´ä»¶</h1><h2 id="loggerä½¿ç”¨"><a href="#loggerä½¿ç”¨" class="headerlink" title="loggerä½¿ç”¨"></a>loggerä½¿ç”¨</h2><p>æ—¥å¿—ä¸­é—´ä»¶å¯ä»¥è®°å½•stateåœ¨æ›´æ–°å‰åçš„å€¼, åˆ©ç”¨çš„æ˜¯storeä¸­çš„<code>applyMiddleware</code>, <code>applyMiddleware</code>ä¸»è¦æ€æƒ³å°±æ˜¯æŠŠReduxå·¥ä½œæµä¸­çš„dispatchç¯èŠ‚å°è£…ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„storeï¼Œè¯¥storeä¸­å…¶ä»–éƒ¨åˆ†æ²¡æœ‰å˜åŒ–ï¼Œåªæ˜¯dispatchè¢«æ–°çš„dispatchè¦†ç›–, æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ˜¯æ€ä¹ˆç”¨çš„ğŸ‘‡<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> logger = <span class="function"><span class="params">store</span> =&gt;</span> next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'æ›´æ–°å‰: '</span>,store.getState());</span><br><span class="line">  next(action)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'æ›´æ–°å: '</span>,store.getState());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> store = applyMiddleware(logger)(createStore)(reducer)</span><br><span class="line"></span><br><span class="line">store.dispatch(&#123;<span class="attr">type</span>: <span class="string">'INCREASE'</span>, <span class="attr">count</span>: <span class="number">2</span>&#125;)</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œçš„<code>applyMiddleware</code>å†…éƒ¨ä¸»è¦æ˜¯å¯¹dispacthåšäº†ä¸€å±‚å°è£…ï¼Œå¹¶å°ç›–æ‰storeä¸­æ—§çš„dispatchï¼Œå¹¶è¿”å›è¿™ä¸ªæ–°çš„store, é‚£å®ƒæ˜¯æ€ä¹ˆå®ç°èƒ½å¤Ÿè·å¾—æ—§çŠ¶æ€å’Œæ–°çŠ¶æ€çš„å‘¢ï¼Ÿ å…¶å®æ˜¯åœ¨loggerå‡½æ•°ä¸­è°ƒç”¨next()ä¹‹å‰æ˜¯æ²¡æœ‰è°ƒç”¨storeä¸­çš„dispatchçš„, æ ¹æ®æ˜¨å¤©<a href="http://www.hanrenhui.cn/blog/2019/02/08/React%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AARedux/" target="_blank" rel="noopener">reduxå®ç°çš„ç¬”è®°</a>ä¸­, åªæœ‰è°ƒç”¨dispatchï¼Œdiapatchå†…éƒ¨æ‰ä¼šè°ƒç”¨reduceræ‰ä¼šæ›´æ–°çŠ¶æ€(state),è€Œloggerå‡½æ•°å†…éƒ¨çš„nextå°±æ˜¯dispatchå‡½æ•°å•¦ï¼Œçœ‹å®ƒæ¥å—äº†ä¸€ä¸ªactionå°±çŸ¥é“å•¦, åé¢æ‰€æœ‰çš„ä¸­é—´ä»¶éƒ½ä¼šä½¿ç”¨åˆ°applyMiddlewareï¼Œæˆ‘ä»¬å…ˆæ¥å®ç°ä¸‹å®ƒå§ğŸ‘‡</p><h2 id="applyMiddlewareå®ç°"><a href="#applyMiddlewareå®ç°" class="headerlink" title="applyMiddlewareå®ç°"></a>applyMiddlewareå®ç°</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> applyMiddleware = <span class="function"><span class="params">middleware</span> =&gt;</span> createStore =&gt; <span class="function"><span class="params">reducer</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æ—§store</span></span><br><span class="line">  <span class="keyword">let</span> store = createStore(reducer)</span><br><span class="line">  middleware = middleware(store)</span><br><span class="line">  <span class="comment">// æ–°dispacth</span></span><br><span class="line">  <span class="keyword">let</span> dispatch = middleware(store.dispatch)</span><br><span class="line">  <span class="comment">// æ–°store</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...store,</span><br><span class="line">    dispatch</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¤§ä½“ç»“åˆloggeræ¥è§£é‡Šä¸‹ï¼Œé¦–å…ˆapplyMiddlewareå†…éƒ¨é€šè¿‡è°ƒç”¨ä¼ å…¥çš„createStoreè¿”å›ä¸€ä¸ªstoreï¼Œå¹¶æŠŠstore.dispatchä¼ å…¥äº†middlewareä¹Ÿå°±æ˜¯loggerä¸­ï¼Œè¿™æ—¶è¿”å›ä¸€ä¸ªå‡½æ•°dispatchï¼Œ å®ƒçš„å‡½æ•°ä½“å°±æ˜¯ä¸‹è¾¹è¿™ä¸ªæ ·å­ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">action =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'æ›´æ–°å‰: '</span>,store.getState());</span><br><span class="line">  next(action)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'æ›´æ–°å: '</span>,store.getState());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹ä¸€æ­¥<strong>return</strong>ä»¥åï¼Œ<code>store</code>é‡Œçš„dispatchå°±è¢«è¿™ä¸ªè¦†ç›–æ‰äº†ï¼Œå½“æˆ‘ä»¬è°ƒç”¨storeçš„dispatchæ–¹æ³•æ—¶ä¹Ÿæ˜¯è°ƒç”¨çš„è¿™ä¸ª, reduxå®ç°ç¬”è®°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ—§çš„disaptchçš„å‡½æ•°ä½“æ˜¯è¿™æ ·å­çš„ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dispatch = <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  state = reducer(action)</span><br><span class="line">  emit()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œæ—§çš„dispatchä¸€è°ƒç”¨ï¼Œæˆ‘ä»¬çš„stateå°±æ›´æ–°äº†ï¼Œè€Œæ–°çš„dispatchå‡½æ•°ä½“(æˆ‘ä»¬åè¾¹ç®€å†™ä¸ºnewDis)é‡Œæ˜¯æ²¡æœ‰æ›´æ–°stateè¯­å¥çš„ï¼Œæ‰€ä»¥åœ¨newDiså†…éƒ¨æ˜¯å¯ä»¥æ‹¿åˆ°æ—§çš„stateçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆè®©stateæ›´æ–°å‘¢ï¼Ÿ é€šè¿‡è°ƒç”¨nextæ–¹æ³•å¹¶æŠŠactionä¼ å…¥, è¿™é‡Œçš„nextæ–¹æ³•å°±æ˜¯store.dispatch, æ˜¯applyMiddlewareå†…éƒ¨ç»™ä»–ä¼ å…¥çš„ï¼Œå°±æ˜¯è¿™ä¸€å¥<code>middleware(store.dispatch)</code>, è°ƒç”¨next(action)æ–¹æ³•å…¶å®å°±æ˜¯è°ƒç”¨äº†åŸæ¥çš„dispatchï¼Œè¿™æ—¶çŠ¶æ€(state)å°±å¯ä»¥æ›´æ–°äº†ğŸ˜„</p><h1 id="redux-thunk"><a href="#redux-thunk" class="headerlink" title="redux-thunk"></a>redux-thunk</h1><p>thunkä¸­é—´ä»¶æ˜¯ä¸ºäº†è§£å†³dispatchä¸­çš„å¼‚æ­¥é—®é¢˜ï¼Œåœ¨ä½¿ç”¨thunkä¹‹å‰ï¼Œæˆ‘ä»¬dispatchçš„å‚æ•°åªèƒ½æ˜¯ä¸€ä¸ªactionå¯¹è±¡ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åˆ©ç”¨dispatchå‘èµ·å¼‚æ­¥è¯·æ±‚çš„è¯ï¼Œå°±éœ€è¦thunkçš„å¸®åŠ©äº†ï¼Œçœ‹ä¸‹thunkå°è£…åçš„dispatchæ˜¯æ€ä¹ˆä½¿ç”¨çš„ï¼Œæˆ‘ä»¬æ ¹æ®ä½¿ç”¨æ¥å†™thunkä¸­é—´ä»¶ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> store = applyMiddleware(thunk)(createStore)(reducer)</span><br><span class="line">store.dispatch(<span class="function"><span class="params">dispatch</span> =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      dispatch(&#123;<span class="attr">type</span>: <span class="string">'INCREASE'</span>, <span class="attr">count</span>: <span class="number">2</span>&#125;)</span><br><span class="line">      <span class="comment">// console.log(store.getState());</span></span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>çœ‹æ¥å°è£…åçš„dispatchä¸æ˜¯æ¥æ”¶ä¸€ä¸ªactionäº†ï¼Œè€Œæ˜¯ä¸€ä¸ªå›è°ƒï¼Œé‚£æˆ‘ä»¬æ¥å†™ä¸‹å§</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> thunk = <span class="function"><span class="params">store</span> =&gt;</span> next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> action === <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> action(next)</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> next(action)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨ä¸Šè¾¹loggerä¸­è¯´åˆ°,thunkå°¾éƒ¨çš„<code>action =&gt; { ... }</code>è¿™ä¸ªå‡½æ•°å°±æ˜¯æˆ‘ä»¬<strong>å°è£…ä»¥åçš„dispatch</strong>, æ–°çš„dispatchæ¥å—ä¸€ä¸ªå›è°ƒï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ£€æµ‹actionçš„ç±»å‹ï¼Œæ˜¯å‡½æ•°åˆ™ç›´æ¥è°ƒç”¨ä¼ å…¥çš„å›è°ƒï¼Œå¹¶æŠŠåŸæ¥çš„dispatch ä¹Ÿå°±æ˜¯nextä¼ å…¥, ä¸æ˜¯å‡½æ•°åˆ™æ˜¯åŒæ­¥è°ƒç”¨ï¼Œç›´æ¥è°ƒç”¨åŸæ¥çš„dispatch</p><h1 id="redux-promise"><a href="#redux-promise" class="headerlink" title="redux-promise"></a>redux-promise</h1><p><code>promise</code> å’Œ <code>thunk</code>çš„ä½œç”¨ä¸€è‡´ï¼Œ éƒ½æ˜¯è§£å†³å¼‚æ­¥é—®é¢˜çš„ï¼Œåªä¸è¿‡<code>promise</code>å†™èµ·æ¥æ›´<del>è£…çŠŠå­</del>ä¼˜é›…ä¸€ç‚¹ğŸ˜„ï¼Œ çœ‹å†™æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isPromise = <span class="function"><span class="params">obj</span> =&gt;</span> obj.then</span><br><span class="line"><span class="keyword">const</span> promise = <span class="function"><span class="params">store</span> =&gt;</span> next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(isPromise(action)) &#123;</span><br><span class="line">    <span class="keyword">let</span> promise = action </span><br><span class="line">    <span class="keyword">return</span> promise.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">      next(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> next(action)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">store.dispatch(<span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">    resolve(&#123;<span class="attr">type</span>: <span class="string">'INCREASE'</span>, <span class="attr">count</span>: <span class="number">3</span>&#125;)</span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><h1 id="ä¸­é—´ä»¶çš„é“¾å¼è°ƒç”¨"><a href="#ä¸­é—´ä»¶çš„é“¾å¼è°ƒç”¨" class="headerlink" title="ä¸­é—´ä»¶çš„é“¾å¼è°ƒç”¨"></a>ä¸­é—´ä»¶çš„é“¾å¼è°ƒç”¨</h1><p>ä¸çŸ¥é“å„ä½æœ‰æ²¡æœ‰å¯¹ä¸­é—´ä»¶çš„ç¬¬äºŒä¸ªå‚æ•°<code>next</code>æœ‰æ‰€ç–‘é—®ï¼Œ<code>next</code>æ˜æ˜æ˜¯ä¼ å…¥çš„<code>dispatch</code>ï¼Œä¸ºä»€ä¹ˆå«<code>next</code>ï¼Œåœ¨è‡ªå·±ç»ƒä¹ çš„è¿‡ç¨‹ä¸­ä¹Ÿä¼°è®¡æŠŠ<code>next</code>å†™æˆ<code>dispatch</code>ï¼Œè¿™æ ·å¥½ç†è§£ä¸€ç‚¹ï¼Œç»ˆäºå­¦åˆ°ä¸­é—´ä»¶æœ€åï¼Œè°œåº•æ­æ™“äº†, å…¶å®nextæ˜¯ä¸ºä¸­é—´ä»¶çš„é“¾å¼è°ƒç”¨å‡†å¤‡çš„, ä»€ä¹ˆæ˜¯é“¾å¼è°ƒç”¨å‘¢ï¼Œæˆ‘ä»¬å†æ‹¿å¼€å¤´çš„é‚£ä¸ªloggerä¸­é—´ä»¶ä¸¾ä¸ªä¾‹å­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> logger1 = <span class="function"><span class="params">store</span> =&gt;</span> next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'logger1æ›´æ–°å‰: '</span>,store.getState());</span><br><span class="line">  next(action)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'logger1æ›´æ–°å: '</span>,store.getState());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> logger2 = <span class="function"><span class="params">store</span> =&gt;</span> next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'logger2æ›´æ–°å‰: '</span>,store.getState());</span><br><span class="line">  next(action)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'logger2æ›´æ–°å: '</span>,store.getState());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> store = applyMiddleware(logger1, logger2)(createStore)(reducer)</span><br><span class="line">store.dispatch(&#123;<span class="attr">type</span>: <span class="string">'INCREASE'</span>, <span class="attr">count</span>: <span class="number">3</span>&#125;)</span><br></pre></td></tr></table></figure><p>çœ‹å®Œä¾‹å­æˆ‘ä»¬å†å°å°æ€»ç»“ä¸€ä¸‹, å…¶å®å°±æ˜¯å¤šä¸ªä¸­é—´ä»¶ä¸€ä¸ªä¸ªè°ƒç”¨ï¼Œå½¢æˆä¸€ä¸ªè°ƒç”¨é“¾, æˆ‘ä»¬ç¬”è®°ä¸€å¼€å¤´å†™çš„<code>applyMiddleware</code> ä¸ºäº†å®ç°é“¾å¼è°ƒç”¨å°±éœ€è¦å‡çº§ä¸€ä¸¢ä¸¢äº†ğŸ‘‡</p><h1 id="å‡çº§applyMiddleware"><a href="#å‡çº§applyMiddleware" class="headerlink" title="å‡çº§applyMiddleware"></a>å‡çº§applyMiddleware</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">...fns</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> last = fns.pop()</span><br><span class="line">    <span class="keyword">return</span> fns.reduce(<span class="function">(<span class="params">pre, next</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> next(pre)</span><br><span class="line">    &#125;, last(...args))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> applyMiddleware = <span class="function">(<span class="params">...middlewares</span>) =&gt;</span> createStore =&gt; <span class="function"><span class="params">reducer</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> store = createStore(reducer)</span><br><span class="line">  middlewares = middlewares.map(<span class="function"><span class="params">middleware</span> =&gt;</span> middleware(store))</span><br><span class="line">  <span class="keyword">let</span> dispatch = compose(...middlewares)(store.dispatch)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...store,</span><br><span class="line">    dispatch</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥ç®€å•è§£é‡Šä¸‹è¿™ä¸ªå‡çº§ç‰ˆçš„<code>applyMiddleware</code>,éš¾ç†è§£çš„åº”è¯¥å°±æ˜¯ä¸­é—´composeè¿™ä¸ªæ–¹æ³•äº†, æˆ‘ä»¬åœ¨è°ƒç”¨äº†composeä»¥åï¼Œcomposeé‡Œçš„fnså…¶å®å°±æ˜¯å­˜ç€ä¸‹é¢ä¸¤ä¸ªå‡½æ•°çš„æ•°ç»„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'logger1æ›´æ–°å‰: '</span>,store.getState());</span><br><span class="line">  next(action)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'logger1æ›´æ–°å: '</span>,store.getState());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'logger2æ›´æ–°å‰: '</span>,store.getState());</span><br><span class="line">  next(action)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'logger2æ›´æ–°å: '</span>,store.getState());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†æ¥çœ‹composeæœ€é‡Œå±‚çš„å‡½æ•°ä½“, æˆ‘ä»¬æŠŠå®ƒå•ç‹¬æ‹¿å‡ºæ¥ï¼Œå¥½çœ‹ä¸€ç‚¹ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> last = fns.pop()</span><br><span class="line">  <span class="keyword">return</span> fns.reduce(<span class="function">(<span class="params">pre, next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> next(pre)</span><br><span class="line">  &#125;, last(...args))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜è®°å¾—reduceçš„ä½¿ç”¨å—ï¼Ÿ åœ¨ä¸ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼Œåœ¨ç¬¬ä¸€è½®å¾ªç¯ä¸­preä¼šç­‰äºæ•°ç»„ç¬¬ä¸€é¡¹ï¼Œnextç­‰äºç¬¬äºŒé¡¹ï¼Œåœ¨ä»¥åçš„å¾ªç¯ä¸­preä¼šç­‰äºä¸Šä¸€æ¬¡returnè¿”å›çš„å€¼ï¼Œnextåˆ™æ˜¯å·²éå†é¡¹çš„ä¸‹ä¸€é¡¹, ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°çš„è¯, ç¬¬ä¸€è½®å¾ªç¯ä¸­ preå°±æ˜¯ç¬¬äºŒä¸ªå‚æ•°ï¼Œ nextå°±æ˜¯æ•°ç»„ç¬¬ä¸€é¡¹ï¼Œåè½®å¾ªç¯å°±å’Œä¸Šè¾¹ä¸€æ ·äº†ã€‚å›å¿†å®Œreduceä»¥åæˆ‘ä»¬æ¥è§£é‡Šä¸‹è¿™ä¸ªå‡½æ•°ï¼Œä¸€å¼€å§‹å…ˆå®šä¹‰äº†ä¸ªlast, last æ˜¯ä¼ å…¥çš„fnsçš„æœ€åä¸€é¡¹, å°±æ˜¯å®ƒå•¦ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'logger2æ›´æ–°å‰: '</span>,store.getState());</span><br><span class="line">  next(action)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'logger2æ›´æ–°å: '</span>,store.getState());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç»™å®ƒä¼ å…¥äº†<code>store.dispatch</code>, å°±æ˜¯åŸæ¥çš„storeé‡Œçš„dispatch, ç„¶åå®ƒå˜æˆäº†è¿™æ ·ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">action =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'logger2æ›´æ–°å‰: '</span>,store.getState());</span><br><span class="line">  next(action)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'logger2æ›´æ–°å: '</span>,store.getState());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å˜æˆè¿™æ ·ä»¥åä½œä¸ºpreä¼ ç»™äº†nextï¼Œ nextåˆæ˜¯è°ï¼Ÿ å°±æ˜¯å®ƒğŸ‘‡ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œçš„nextå°±æ˜¯logger2çš„actionå‡½æ•°äº†ä¹Ÿå°±æ˜¯pre</span></span><br><span class="line">next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'logger1æ›´æ–°å‰: '</span>,store.getState());</span><br><span class="line">  next(action)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'logger1æ›´æ–°å: '</span>,store.getState());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œä»¥åè¿”å›ï¼Œå¹¶èµ‹ç»™dispatchï¼Œ dispatchå°±æ˜¯è¿™æ ·</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">action =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'logger1æ›´æ–°å‰: '</span>,store.getState());</span><br><span class="line">  next(action)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'logger1æ›´æ–°å: '</span>,store.getState());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="image-box">                <img src="1.png" alt="" title="" class="">                <p></p>            </figure><p>é‚£æˆ‘ä»¬è°ƒç”¨dispatchçš„é¡ºåºåˆæ˜¯å•¥å‘¢ï¼Ÿ æˆ‘ä»¬çœ‹è¿™å¼ å›¾åˆ†æä¸‹<br>å½“æˆ‘ä»¬è°ƒç”¨dispatchçš„æ—¶å€™ï¼Œä¼šå…ˆæ‰“å°<code>logger1æ›´æ–°å‰</code>, ç„¶åè°ƒç”¨nextï¼Œnextå°±æ˜¯logger2æœ€å†…å±‚çš„action, ç„¶åè¿™æ—¶å€™ä¼šè°ƒç”¨<code>logger2æ›´æ–°å‰</code>, åˆé‡åˆ°äº†logger2ä¸­çš„nextï¼Œ logger2ä¸­çš„nextæˆ‘ä»¬ä¸Šè¾¹è¯´äº†ï¼Œä¼ å…¥äº†åŸå§‹çš„dispatch, è°ƒç”¨ä»¥åå°±ä¼šæ›´æ–°çŠ¶æ€ï¼Œæ¥ç€<code>logger2æ›´æ–°å</code>, æ¥ç€æ‰“å°<code>logger1æ›´æ–°å</code></p><p>ç°åœ¨æ˜ç™½ä¸ºä»€ä¹ˆå«nextä¸å«dispatchäº†å§ï¼Ÿ åœ¨é“¾å¼è°ƒç”¨ä¸­ï¼ŒnextæŒ‡çš„å°±æ˜¯å°±æ˜¯ä¸‹ä¸€ä¸ªä¸­é—´ä»¶çš„dispatch</p>]]></content>
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> Redux </category>
          
          <category> Reduxä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> Redux </tag>
            
            <tag> Reduxä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Reactå­¦ä¹ ä¹‹å®ç°ReduxğŸš€</title>
      <link href="/blog/2019/03/02/React%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AARedux/"/>
      <url>/blog/2019/03/02/React%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AARedux/</url>
      <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ˜¨å¤©åªæœ‰ä¸¤èŠ‚è¯¾ï¼Œè¿™ä¹ˆå……è¶³çš„è¯¾ä½™æ—¶é—´å½“ç„¶æ˜¯æ‹¿æ¥å­¦ä¹ å•¦ğŸ“•ï¼Œ èŠ±äº†ä¸€ä¸‹åˆçš„æ—¶é—´å­¦ä¹ äº†Reduxçš„ä½¿ç”¨ï¼ŒReduxçš„å®ç°åŸç†ä¹Ÿå¾ˆç®€å•ï¼Œç‰¹æ„ä»Šå¤©é€ƒäº†ä¸€å°èŠ‚è¯¾æ¥å†™ç¯‡ç¬”è®°(æ²¡åŠæ³•ï¼Œä»Šå¤©æ»¡è¯¾ğŸ˜­)</p><h1 id="ä¸ºä»€ä¹ˆéœ€è¦Redux"><a href="#ä¸ºä»€ä¹ˆéœ€è¦Redux" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦Redux"></a>ä¸ºä»€ä¹ˆéœ€è¦Redux</h1><p>æˆ‘ä»¬éƒ½çŸ¥é“åœ¨<code>React</code>æˆ–è€…<code>Vue</code>ä¸­åŒçº§ç»„ä»¶ä¹‹é—´æ˜¯æ— æ³•è¿›è¡Œæ•°æ®å…±äº«æˆ–è€…ä¼ é€’çš„ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬åœ¨è¿™ä¸¤ä¸ªåŒçº§ç»„ä»¶æƒ³ä½¿ç”¨åŒä¸€ä¸ª<code>State</code>çš„è¯è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ å¯¹çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ<code>State</code>å®šä¹‰åœ¨çˆ¶çº§ç»„ä»¶ä¸­ï¼Œç„¶åé€šè¿‡<code>Prop</code>ä»çˆ¶çº§ç»„ä»¶ä¼ é€’ç»™å­çº§ï¼Œ ä½†æ˜¯æƒ³è±¡ä¸€ä¸‹ï¼Œåªæœ‰çˆ¶çº§å’Œå­çº§çš„è¯å€’è¿˜å¥½ï¼Œè¦æ˜¯æœ‰ä¸€æ—è°±å‘¢? I mean, è¿™é‡Œçš„ç»„ä»¶æœ‰åå…«å±‚ï¼Œä»é¡¶å±‚ä¸€å±‚å±‚ä¼ åˆ°åº•å±‚çš„è¯ï¼Œ ä¸ç´¯æ­»ä¹Ÿéº»çƒ¦æ­»äº†ï¼Œæ‰€ä»¥<code>React</code>å’Œ<code>Vue</code>éƒ½ç»™å‡ºäº†è‡ªå·±çš„è§£å†³æ–¹æ¡ˆï¼Œ åˆ†åˆ«æ˜¯<code>Redux</code>å’Œ<code>Vuex</code>æ¥ç»Ÿä¸€ç®¡ç†çŠ¶æ€ï¼Œè¿™æ ·çš„è¯å“ªä¸ªç»„ä»¶æƒ³ç”¨å°±ç›´æ¥æ‹¿å°±å¥½äº†, ä½†æ˜¯<code>Vuex</code>çš„å®ç°ä¸æ˜¯æœ¬ç¯‡çš„é‡ç‚¹ï¼Œå…³äº<code>Vuex</code>çš„å®ç°å’±ä»¬åé¢æ–‡ç« ä¸­è§</p><h1 id="Redux-å·¥ä½œæµ"><a href="#Redux-å·¥ä½œæµ" class="headerlink" title="Redux å·¥ä½œæµ"></a>Redux å·¥ä½œæµ</h1><p>æˆ‘ä»¬å…ˆæ¥çœ‹å¼ <del>æ¶å¿ƒçš„</del>å›¾, </p><p><img src="1.png" alt="reduxæµç¨‹å›¾"></p><p>æˆ‘ä»¬çœ‹ç€è¿™å¼ å›¾ç»†èŠä¸€ä¸‹reduxçš„æµç¨‹åŠåŸºæœ¬ä½¿ç”¨ğŸ‘‡</p><p>å¾ˆæ˜¾ç„¶åœ¨è¿™å¼ å›¾é‡Œæ ¸å¿ƒå°±æ˜¯<strong>Store</strong>äº†,å…¶ä»–ä¸‰ä¸ªå…ƒç´ éƒ½ä¸å®ƒæœ‰å…³ç³»ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹<code>Component</code>(Reacté‡Œçš„ç»„ä»¶)ä¸å®ƒçš„å…³ç³»ï¼Œ<code>Component</code>å¯ä»¥é€šè¿‡<strong>getStore()</strong>ä»Storeä¸­å–å¾—çŠ¶æ€ï¼ŒçŠ¶æ€åœ¨<strong>Store</strong>ä¸­ç»Ÿä¸€ç®¡ç†ï¼Œè¿™æ ·å°±é¿å…äº†çŠ¶æ€éœ€è¦ä¸€å±‚å±‚å¾€ä¸‹ä¼ çš„å™©æ¢¦ğŸ¤¢, é‚£ä¹ˆç»„ä»¶æ€ä¹ˆä¿®æ”¹çŠ¶æ€å‘¢ï¼Ÿ æ˜¾ç„¶ç»„ä»¶å¦‚æœå¯¹çŠ¶æ€åªæ˜¯getä¸èƒ½setçš„è¯å°±æœ‰ç‚¹è¯´ä¸è¿‡å»äº†ï¼Œ<strong>åœ¨reduxä¸­ï¼ŒçŠ¶æ€çš„ä¿®æ”¹éœ€è¦ç»„ä»¶é€šçŸ¥Store, Storeå†é€šçŸ¥reducerï¼Œç„¶åæŠŠä½ æƒ³è¦åšçš„äº‹æƒ…ä¼ ç»™reducerï¼Œç„¶åç”±reducerä»£ç†ä¿®æ”¹state</strong>ï¼Œç„¶åå°†æ–°çŠ¶æ€(<code>newState</code>)è¿”å›ç»™<code>Store</code>, <code>Store</code>ä¸­çš„stateæ›´æ–°ä»¥åï¼Œæ‰€æœ‰è®¢é˜…äº†è¯¥stateçš„ç»„ä»¶å°±ä¼šæ›´æ–°è§†å›¾,Storeå¦‚ä½•é€šçŸ¥ç»„ä»¶ï¼Ÿé€šè¿‡<code>dispatch</code>æ–¹æ³•,é‚£ä¹ˆç»„ä»¶å¦‚ä½•å°†<code>æƒ³åšçš„äº‹æƒ…</code>ä¼ ç»™reducerå‘¢ï¼Ÿ é€šè¿‡<code>actionCreators</code>, actionæ˜¯ä¸€ä¸ªç”±typeå±æ€§å’Œå…¶å®ƒå±æ€§ç»„æˆçš„å¯¹è±¡ï¼Œç±»ä¼¼è¿™æ · <code>{ type: &#39;add_one&#39;, index: 1}</code>, typeæ˜¯ä¸€å®šè¦å¸¦çš„ï¼Œ <strong>typeå†³å®šäº†reduceråœ¨æ”¶åˆ°ä»£ç†è¯·æ±‚åå¯¹stateåšä½•ç§å¤„ç†</strong>ï¼Œæ˜¯å®°æ˜¯æ€ï¼Œ æ˜¯ç‚’æ˜¯ç‚–ï¼Œ å®Œå…¨ç”±ä½ è¯´äº†ç®—ï¼Œ è€Œé™¤äº†typeçš„å…¶ä»–å±æ€§åˆ™æ˜¯ ä½ åœ¨å¤„å†³stateæ—¶å¯èƒ½éœ€è¦æŸäº›å‚æ•°ï¼Œ æ¯”å¦‚ï¼šstateé‡Œå­˜ç€æŸä¸ªæ•°ç»„ï¼Œä½ æƒ³å»æ‰æŸä¸€é¡¹ï¼Œè°ƒç”¨æ•°ç»„çš„spliceæ–¹æ³•å¾—æŠŠindexç»™å®ƒå§ï¼Ÿ è¿™ç§å¤„ç½®stateæ‰€éœ€çš„å‚æ•°å°±æ˜¯æ”¾åœ¨actionä¸­ï¼Œæ‰€ä»¥ç»„ä»¶æƒ³è¦ä¿®æ”¹stateå°±æ˜¯è°ƒç”¨dispatchæ–¹æ³•ï¼Œç„¶åå°†actionä¼ è¿›å»</p><p><strong>æ€»ç»“ä¸€ä¸‹</strong>ğŸ‘‡<br>æ— è®ºæ˜¯ç»„ä»¶æƒ³è¦è·å–çŠ¶æ€è¿˜æ˜¯ä¿®æ”¹çŠ¶æ€å§‹ç»ˆéƒ½ç¦»ä¸å¼€storeæ ¸å¿ƒçš„å‚ä¸ï¼Œ è·å–çŠ¶æ€åªéœ€è¦è°ƒç”¨store.getState() å°±å¯ä»¥äº†ï¼Œè€Œä¿®æ”¹çŠ¶æ€åˆ™éœ€è¦é€šè¿‡store.dispatch(store)æ¥å‘Šè¯‰storeä½ æƒ³è¦ä¿®æ”¹çŠ¶æ€, storeåˆ™é€šè¿‡è°ƒç”¨reduceræ¥ä¿®æ”¹çŠ¶æ€ï¼Œreducerä¿®æ”¹å®Œä»¥åä¼šè¿”å›æ–°çŠ¶æ€ç»™storeï¼Œstoreæ‹¿åˆ°æ–°çŠ¶æ€ä»¥åæ‰€æœ‰è®¢é˜…storeé‡Œè¯¥stateçš„ç»„ä»¶å°±ä¼šé‡æ–°åˆ·æ–°è§†å›¾</p><h1 id="Reduxçš„ä½¿ç”¨"><a href="#Reduxçš„ä½¿ç”¨" class="headerlink" title="Reduxçš„ä½¿ç”¨"></a>Reduxçš„ä½¿ç”¨</h1><p>æˆ‘ä»¬ç»“åˆreduxçš„ä½¿ç”¨æ¥å®ç°ä¸€ä¸ªæœ€åŸºæœ¬çš„Redux</p><p>æˆ‘ä»¬å…ˆä¼šå›å¿†ä¸‹reduxçš„ä½¿ç”¨, æ¯”å¦‚è¯´æˆ‘ä»¬å®ç°ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæœ‰åŠ æŒ‰é’®å’Œå‡æŒ‰é’®ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹Code</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// reducer</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state = &#123; number: <span class="number">0</span> &#125;, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!action) <span class="keyword">return</span> state </span><br><span class="line">    <span class="keyword">let</span> newState</span><br><span class="line">    <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'INCREASE'</span>:</span><br><span class="line">        <span class="comment">// æ·±æ‹·è´è€çš„state</span></span><br><span class="line">        newState = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(state))</span><br><span class="line">        newState.number += action.count</span><br><span class="line">        <span class="keyword">return</span> newState</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'DECREASE'</span>: </span><br><span class="line">        newState = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(state))</span><br><span class="line">        newState.number -= action.count </span><br><span class="line">        <span class="keyword">return</span> newState</span><br><span class="line">      <span class="keyword">default</span> :</span><br><span class="line">        <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// store</span></span><br><span class="line">  <span class="keyword">import</span> &#123; CreateStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line">  <span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./reducer'</span></span><br><span class="line">  <span class="keyword">const</span> store = CreateStore(reducer)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å”¯ä¸€çš„Appç»„ä»¶</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">    <span class="keyword">this</span>.state = store.getState()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillMount() &#123;</span><br><span class="line">    <span class="comment">// è®¢é˜… çŠ¶æ€ä¸€æ—¦æ”¹å˜åˆ™é‡æ–°åˆ·æ–°è§†å›¾</span></span><br><span class="line">    <span class="keyword">this</span>.unsubscribe = store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; </span><br><span class="line">        number: store.getState().number</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; </span><br><span class="line">  componentWillUnmount() &#123;</span><br><span class="line">    <span class="comment">// ç»„ä»¶å¸è½½ï¼Œå–æ¶ˆè®¢é˜…ï¼Œ ç»“åˆè·¯ç”±çš„æ—¶å€™ä¼šéå¸¸æœ‰ç”¨</span></span><br><span class="line">    <span class="keyword">this</span>.unsubscribe()</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"app"</span>&gt;</span><br><span class="line">        &lt;p&gt;&#123;<span class="keyword">this</span>.state.number&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;() =&gt; store.dispatch(&#123;type: 'INCREASE', count: 1&#125;)&#125;&gt;+&lt;/</span>button&gt;</span><br><span class="line">        &lt;button onClick=&#123;() =&gt; store.dispatch(&#123;<span class="attr">type</span>: <span class="string">'DECREASE'</span>, <span class="attr">count</span>: <span class="number">1</span>&#125;)&#125;&gt;-&lt;/button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥æ€»ç»“ä¸‹Reduxæ€ä¹ˆç”¨çš„ğŸ‘‡<br>reduxæ¨¡å—å†…éƒ¨è¿”å›äº†ä¸€ä¸ªå¯¹è±¡ï¼Œ CreateStoreæ˜¯å…¶ä¸­ä¸€ä¸ªå±æ€§ï¼Œå¯¹åº”çš„å€¼æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå°†reducerä¼ è¿›è¯¥æ–¹æ³•è¿”å›store, åç»­æ‰€æœ‰æ“ä½œéƒ½æ˜¯store. çš„æ–¹å¼ï¼Œæ‰€ä»¥storeä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨äº†getState(), subscribe(), dispatch()è¿™ä¸‰ä¸ªæ–¹æ³•, æ‰€ä»¥storeå¯¹è±¡é‡Œçš„å±æ€§ä¹Ÿå°±ç¡®å®šäº†ã€‚<br>å†æ¥çœ‹ï¼Œæˆ‘ä»¬é€šè¿‡dispacthæ¥ä¿®æ”¹state, è€Œreduxçš„å·¥ä½œæµæ˜¯storeé€šçŸ¥reduceræ¥æ›´æ”¹æ•°æ®ï¼Œå¹¶å°†æ–°æ•°æ®è¿”å›ç»™storeï¼Œ æ‰€ä»¥dispatchå†…éƒ¨åº”è¯¥æ˜¯è°ƒç”¨reducerï¼Œå¹¶ä¸”æŠŠactionä¼ äº†è¿›å»ï¼Œreducerè¿”å›æ–°æ•°æ®å¹¶ä¿®æ”¹storeçš„æ—§æ•°æ®ã€‚ç°åœ¨è·å–æ•°æ®å’Œä¿®æ”¹æ•°æ®éƒ½æœ‰äº†ï¼Œè¿˜å·®é¡µé¢åˆ·æ–°ï¼Œé¡µé¢åˆ·æ–°æ˜¯åˆ©ç”¨äº†å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œ å°†è¦æƒ³ä¿®æ”¹çš„stateé€šè¿‡subscribeæ¥è®¢é˜…æ¶ˆæ¯ï¼Œstateä¸€æ—¦æ›´æ–°ï¼Œreduxå†…éƒ¨åˆ™å‘å¸ƒæ¶ˆæ¯ï¼Œç»„ä»¶æ”¶åˆ°æ¶ˆæ¯ä¾¿è°ƒç”¨setStateåˆ·æ–°é¡µé¢</p><h1 id="redux"><a href="#redux" class="headerlink" title="redux"></a>redux</h1><p>ç°åœ¨çŸ¥é“æ€ä¹ˆç”¨äº†ï¼Œæˆ‘ä»¬æ¥è‡ªå·±æ‰‹æ’¸ä¸€ä¸ªreduxğŸ‘‡<br>ä¸Šé¢è¯´åˆ°, reduxå†…éƒ¨è¿”å›äº†ä¸€ä¸ªå¸¦æœ‰createStoreæ–¹æ³•çš„å±æ€§,è€Œä¸”è°ƒç”¨createStateè¿”å›äº†ä¸€ä¸ªå¸¦æœ‰ä¸‰ä¸ªæ–¹æ³•çš„å¯¹è±¡ï¼Œæ‰€æœ‰reduxçš„å¤§ä½“æ¡†æ¶æ˜¯è¿™æ ·å­çš„ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createState</span>(<span class="params">reducer</span>) </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    dispatch,</span><br><span class="line">    subscribe,</span><br><span class="line">    getState</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123; createState &#125;</span><br></pre></td></tr></table></figure><ul><li>æˆ‘ä»¬æ¥ä¸€ç‚¹ç‚¹æŠŠè¿™ä¸ªéª¨æ¶æ’‘èµ·æ¥ï¼Œ é¦–å…ˆæ˜¯getState, é€šè¿‡å®ƒå¯ä»¥è·å–åˆ°storeå†…éƒ¨çš„stateï¼Œ æ‰€æœ‰createStoreå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªstateå±æ€§ï¼Œå¹¶ä¸”getStateæŠŠå®ƒæš´éœ²ç»™å¤–ç•Œ</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getState</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> state</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ¥ä¸‹æ¥æ˜¯subscribeï¼Œè¿™ä¸ªæ–¹æ³•ç”¨æ¥å°†è¦è®¢é˜…çš„å¯¹è±¡å­˜å…¥åˆ°ä¸€ä¸ªè®¢é˜…æ•°ç»„(watchers)ä¸­, åŒæ—¶å®ƒè¿”å›ä¸€ä¸ªå‡½æ•°unsubscribeï¼Œå–æ¶ˆè®¢é˜…ï¼Œä¹Ÿå°±æ˜¯å°†è¯¥è®¢é˜…å¯¹è±¡ä»è®¢é˜…æ•°ç»„ä¸­å»é™¤</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> subscribe = <span class="function"><span class="params">watcher</span> =&gt;</span> &#123;</span><br><span class="line">  watchers.push(watcher)</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> newWatchers = watchers.filter( <span class="function"><span class="params">w</span> =&gt;</span> w!== watcher)</span><br><span class="line">    <span class="keyword">return</span> newWatchers</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æœ‰è®¢é˜…ï¼Œè‡ªç„¶æœ‰å‘å¸ƒ</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> emit = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  watchers.forEach( <span class="function"><span class="params">w</span> =&gt;</span> w())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æœ€åæ˜¯dispatch,dispatchæ¥å—ä¸€ä¸ªactionï¼Œè€Œä¸”å†…éƒ¨ä¼šè°ƒç”¨reducerå¹¶å°†actionä¼ ç»™å®ƒï¼Œæœ€åreducerè¿”å›ä¸€ä¸ªæ–°çš„stateï¼Œæ•°æ®æ›´æ”¹å®Œè‚¯å®šè¦é€šçŸ¥æ‰€æœ‰è®¢é˜…ç»„ä»¶åˆ·æ–°è§†å›¾, </li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dispatch = <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  state = reducer(state, action)</span><br><span class="line">  emit()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸‹å®Œæ•´ä»£ç ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> state</span><br><span class="line">  <span class="keyword">let</span> watchers = []</span><br><span class="line">  <span class="keyword">const</span> subscribe = <span class="function"><span class="params">watcher</span> =&gt;</span> &#123;</span><br><span class="line">    watchers.push(watcher)</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> newWatchers = watchers.filter( <span class="function"><span class="params">w</span> =&gt;</span> w!== watcher)</span><br><span class="line">      <span class="keyword">return</span> newWatchers</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> emit = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    watchers.forEach( <span class="function"><span class="params">w</span> =&gt;</span> w())</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> getState = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    state = reducer(state, action)</span><br><span class="line">    emit()</span><br><span class="line">  &#125;</span><br><span class="line">  dispatch()</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    dispatch,</span><br><span class="line">    subscribe,</span><br><span class="line">    getState</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123; createStore &#125;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯ç‰¹åˆ«ç®€å•ğŸ‘ï¼Ÿï¼Œ ä¸‰åè¡Œæå®š(å½“ç„¶æˆ‘ä»¬åªæ˜¯å®ç°äº†åŸºæœ¬çš„åŠŸèƒ½è€Œå·²ğŸ˜€)</p><h1 id="combineReducer"><a href="#combineReducer" class="headerlink" title="combineReducer"></a>combineReducer</h1><p>ç°åœ¨æˆ‘ä»¬å·²ç»å°†çŠ¶æ€ä¿å­˜åœ¨ä»“åº“å½“ä¸­äº†, ä½†æ˜¯è¿˜æœ‰ä¸ªé—®é¢˜, æˆ‘ä»¬åªæœ‰ä¸€ä¸ªä»“åº“, ä½†æ˜¯æˆ‘ä»¬ä¸€ä¸ªé¡¹ç›®é‡Œæœ‰å¤šä¸ªæ¨¡å—æ€ä¹ˆåŠ, åœ¨Vueä¸­æ˜¯é€šè¿‡åœ¨storeä¸­æŒ‚è½½modulesè§£å†³çš„, è€Œåœ¨reactå½“ä¸­å‘¢, æˆ‘ä»¬é€šè¿‡combineReduceræ¥è®²å¤šä¸ªreduceråˆå¹¶æˆä¸€ä¸ªreducer, ç›´æ¥ä¸Šä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‡è®¾æˆ‘ä»¬çš„é¡µé¢ä¸­æœ‰ä¸¤ä¸ªæ¨¡å— ä¸€ä¸ªè®¡æ•°å™¨æ¨¡å— å®ƒå¯¹åº”çš„reducerå«counter</span></span><br><span class="line"><span class="comment">// å¦ä¸€ä¸ªæ˜¯todosæ¨¡å— ä»–å¯¹åº”çš„reducerå«todos</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å±äºcounterçš„reducer</span></span><br><span class="line"><span class="keyword">import</span> counter <span class="keyword">from</span> <span class="string">'./../reducers/counter'</span></span><br><span class="line"><span class="comment">// å±äºtodosçš„reducer</span></span><br><span class="line"><span class="keyword">import</span> todos <span class="keyword">from</span> <span class="string">'./../reducers/todo'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// reduceré‡Œé»˜è®¤çš„stateæƒ³åœ¨å˜æˆäº†è¿™æ ·</span></span><br><span class="line"><span class="keyword">let</span> defaultState = &#123;</span><br><span class="line">  <span class="comment">// å±äºcounterçš„state</span></span><br><span class="line">  counter: &#123;</span><br><span class="line">    count: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// å±äºtodosçš„state</span></span><br><span class="line">  todos: &#123;</span><br><span class="line">    todos: [],</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// combieReduceræœ€ç»ˆè¿˜æ˜¯è¿”å›ä¸€ä¸ªreducerå‡½æ•° è¿˜æ˜¯éœ€è¦stateå’Œactionä¸¤ä¸ªå‚æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">combineReducer</span>(<span class="params">reducers</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">state = defaultState, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡ä¼ å…¥actionå°±æŠŠæ—§çš„stateç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> (!action) <span class="keyword">return</span> state</span><br><span class="line">    <span class="comment">// æ·±æ‹·è´æ—§state ä¿è¯æ–°è€stateä¸æ˜¯åŒä¸€ä¸ª</span></span><br><span class="line">    <span class="keyword">let</span> newState = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(state))</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> reducers) &#123;</span><br><span class="line">      <span class="comment">// å¾ªç¯defaultstate å°†å¯¹åº”æ¨¡å—çš„æ•°æ®ä¼ å…¥å¯¹åº”æ¨¡å—çš„reducer reducerè°ƒç”¨å®Œä¼šè¿”å›ä¸€ä¸ªå±äºè¯¥æ¨¡å—çš„state ä»æ¥æ›´æ–°æ‰defaultStateé‡Œå¯¹åº”æ¨¡å—çš„æ•°æ®</span></span><br><span class="line">      newState[key] = reducers[key](newState[key], action)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†æ–°çš„newStateè¿”å› ä¿®æ”¹storeå†…éƒ¨çš„state</span></span><br><span class="line">    <span class="keyword">return</span> newState</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer = combineReducer(&#123;</span><br><span class="line">  counter,</span><br><span class="line">  todos</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> reducer</span><br><span class="line"></span><br><span class="line"><span class="comment">//  /store/index</span></span><br><span class="line"><span class="comment">// ä¸å†æ˜¯ç›´æ¥å¼•å…¥reducer è€Œæ˜¯å¼•ç”¨combineReducer</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'./../store/redux/combineReducer'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'./redux'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createStore(reducer)</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> React </category>
          
          <category> Redux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> React </tag>
            
            <tag> Redux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Reactå­¦ä¹ ä¹‹å®ç°react-redux ğŸ‘€</title>
      <link href="/blog/2019/03/01/React%E5%AD%A6%E4%B9%A0%E4%B9%8Breact-redux%E5%9F%BA%E6%9C%AC%E5%AE%9E%E7%8E%B0/"/>
      <url>/blog/2019/03/01/React%E5%AD%A6%E4%B9%A0%E4%B9%8Breact-redux%E5%9F%BA%E6%9C%AC%E5%AE%9E%E7%8E%B0/</url>
      <content type="html"><![CDATA[<h1 id="react-reduxä¸­çš„ç»„ä»¶"><a href="#react-reduxä¸­çš„ç»„ä»¶" class="headerlink" title="react-reduxä¸­çš„ç»„ä»¶"></a>react-reduxä¸­çš„ç»„ä»¶</h1><p>react-redux å°†æ‰€æœ‰ç»„ä»¶åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œ<strong>UIç»„ä»¶</strong>å’Œ<strong>å®¹å™¨ç»„ä»¶</strong>ï¼ŒUIç»„ä»¶æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š </p><ul><li>åªè´Ÿè´£UIå±•ç¤ºï¼Œä¸å¸¦æœ‰ä»»ä½•ä¸šåŠ¡é€»è¾‘</li><li>æ— çŠ¶æ€(state)</li><li>æ‰€æœ‰æ•°æ®ç”šè‡³ä¸šåŠ¡é€»è¾‘éƒ½ç”±çˆ¶çº§ç»„ä»¶ä¼ å…¥</li><li>ä¸ä½¿ç”¨ä»»ä½•reduxçš„API</li></ul><p>è€Œå®¹å™¨ç»„ä»¶åˆ™æ°æ°ç›¸å è´Ÿè´£ç®¡ç†<code>state</code>ï¼Œå¤„ç†å„ç§ä¸šåŠ¡é€»è¾‘ï¼Œä½†æ˜¯ä¸è´Ÿè´£UIå±•ç¤º, å¦‚æœä¸€ä¸ªç»„ä»¶æ—¢æœ‰UIåˆæœ‰ä¸šåŠ¡çš„è¯æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç»™è¿™ä¸ªç»„ä»¶å¤–å±‚åŒ…ä¸€ä¸ªç»„ä»¶ï¼Œå¤–å±‚ç»„ä»¶æˆ‘ä»¬å°†å®ƒå®šä¹‰æˆå®¹å™¨ç»„ä»¶ï¼Œå†…éƒ¨ç»„ä»¶çš„æ‰€æœ‰çŠ¶æ€é€»è¾‘ç­‰éƒ½å®šä¹‰åˆ°  å¤–å±‚å®¹å™¨ç»„ä»¶ä¸Šï¼Œå†ç”±å®¹å™¨ç»„ä»¶å°†æ•°æ®å’Œé€»è¾‘ä¼ å…¥å†…å±‚UIç»„ä»¶; åœ¨<code>react-redex</code>ä¸­ï¼ŒUIç»„ä»¶ç”±æˆ‘ä»¬æä¾›ï¼Œç„¶åå°†æ•°æ®å’Œé€»è¾‘å°è£…åœ¨å¯¹è±¡ä¸­ï¼Œä¼ å…¥<code>react-redex</code>æä¾›çš„<code>connect</code>æ–¹æ³•ä¸­ï¼Œè¯¥æ–¹æ³•ä¼šè‡ªåŠ¨ç»™æˆ‘ä»¬åœ¨uiç»„ä»¶å¤–å±‚å¥—ä¸€ä¸ªå®¹å™¨ç»„ä»¶ï¼Œä¼ å…¥çš„æ•°æ®(<strong>mapStateToProps</strong>)å’Œé€»è¾‘å¯¹è±¡(<strong>mapDispatchToProps</strong>)åˆ™ä¼šè¢«ä¼ å…¥åˆ°å†…å±‚UIç»„ä»¶ä¸­</p><h1 id="connectå®ç°"><a href="#connectå®ç°" class="headerlink" title="connectå®ç°"></a>connectå®ç°</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> connect = <span class="function">(<span class="params">mapStateToProps, mapDispatchToProps</span>) =&gt;</span> (_ccmponent) =&gt; &#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">      <span class="keyword">super</span>() </span><br><span class="line">      <span class="keyword">this</span>.state = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillMount() &#123;</span><br><span class="line">      <span class="comment">// è®¢é˜… çŠ¶æ€ä¸€æ—¦æ”¹å˜åˆ™é‡æ–°åˆ·æ–°è§†å›¾</span></span><br><span class="line">      <span class="keyword">this</span>.unsubscribe = store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(mapStateToProps(store.getState()))</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; </span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line">      <span class="keyword">this</span>.unsubscribe()</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">_component</span> </span></span></span><br><span class="line"><span class="xml">              &#123;...this.state&#125;</span></span><br><span class="line"><span class="xml">              &#123;...mapDispatchToProps(store.dispatch)&#125;</span></span><br><span class="line"><span class="xml">            /&gt;</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">  Proxy.contextTypes = &#123;</span></span><br><span class="line"><span class="xml">    store: PropTypes.object,</span></span><br><span class="line"><span class="xml">    name: PropTypes.string</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">  return Proxy</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">const mapStateToProps = (state) =&gt; (</span></span><br><span class="line"><span class="xml">  &#123;</span></span><br><span class="line"><span class="xml">    number: store.getState().number</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">) </span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">const mapDispatchToProps = (dispatch) =&gt; (</span></span><br><span class="line"><span class="xml">  &#123;</span></span><br><span class="line"><span class="xml">    increase: () =&gt; dispatch(&#123;type: 'INCREASE', count: 1&#125;),</span></span><br><span class="line"><span class="xml">    decrease: () =&gt; dispatch(&#123;type: 'DECREASE', count: 1&#125;)</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">)</span></span><br><span class="line"><span class="xml">// Appæ˜¯ä¸€ä¸ªUIç»„ä»¶</span></span><br><span class="line"><span class="xml">export default connect(mapStateToProps, mapDispatchToProps)(App)</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸Šè¾¹çš„<code>connect</code>å®ç°è¿˜ä¸å¤ªä¼˜é›…ï¼Œå› ä¸ºé‡Œé¢ä¾èµ–æ­»äº†<code>store</code>ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€ä¸‹ä¼˜åŒ–, æˆ‘ä»¬å¯ä»¥å°†storeå®šä¹‰åœ¨srcæ–‡ä»¶ä¸‹çš„index.jsä¸­ï¼Œå†é€šè¿‡<code>context</code>è®©<code>connet</code>æ¨¡å—ç›´æ¥æ‹¿åˆ°<code>store</code>, è¿™æ—¶æˆ‘ä»¬å°±éœ€è¦åœ¨é¡¶å±‚å®šä¹‰ä¸€ä¸ª<code>provider</code>ç»„ä»¶ï¼Œè¯¥ç»„ä»¶æ²¡æœ‰å…¶ä»–ä½œç”¨ï¼Œå°±æ˜¯é€šè¿‡<code>context</code>ç»™<code>connect</code>åˆ†å‘<code>store</code>çš„</p><h1 id="Provider-å®ç°"><a href="#Provider-å®ç°" class="headerlink" title="Provider å®ç°"></a>Provider å®ç°</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Provider</span> <span class="keyword">extends</span>  <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  getChildContext() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">store</span>: <span class="keyword">this</span>.props.store&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.props.children</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">Provider.childContextTypes = &#123;</span><br><span class="line">  store: PropTypes.object</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Provider</span><br></pre></td></tr></table></figure><p>çœ‹ä¸‹App.jsé‡Œéœ€è¦å†™ä»€ä¹ˆğŸ‘‡<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store/index'</span></span><br><span class="line"><span class="keyword">import</span> Provider <span class="keyword">from</span> <span class="string">'./provider'</span></span><br><span class="line"></span><br><span class="line">ReactDOM.render( <span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span><span class="tag">&lt;<span class="name">App</span>/&gt;</span><span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span> , <span class="built_in">document</span>.querySelector(<span class="string">'#root'</span>))</span><br></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> React </category>
          
          <category> Redux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> React </tag>
            
            <tag> Redux </tag>
            
            <tag> React-Redux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è·¨åŸŸè§£å†³æ–¹æ¡ˆ ğŸ“•</title>
      <link href="/blog/2019/02/08/%E8%B7%A8%E5%9F%9F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
      <url>/blog/2019/02/08/%E8%B7%A8%E5%9F%9F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
      <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¹‹å‰åœ¨é¡¹ç›®ä¸­é‡åˆ°äº†è·¨åŸŸçš„é—®é¢˜ï¼Œæ˜¨å¤©åˆšå¥½æœ‰ç©ºå°±ç³»ç»Ÿå­¦ä¹ äº†ä¸€ä¸‹ï¼Œé¡ºä¾¿åœ¨è¿™è¾¹è®°å½•ä¸€ä¸‹ã€‚</p><h1 id="åŒæºç­–ç•¥"><a href="#åŒæºç­–ç•¥" class="headerlink" title="åŒæºç­–ç•¥"></a>åŒæºç­–ç•¥</h1><p>æ‰€è°“åŒæºï¼ŒæŒ‡çš„æ˜¯ä¸‰ä¸ªç›¸åŒğŸ‘‡ï¼Œ åªè¦ä¸‹æ–¹çš„ä¸‰è€…æœ‰ä¸€è€…ä¸ä¸€æ ·ï¼Œå³ä¸ºè·¨åŸŸ</p><ul><li>åè®®ç›¸åŒ</li><li>åŸŸåç›¸åŒ</li><li>ç«¯å£ç›¸åŒ</li></ul><p>æ‹¿<code>http://www.hanrenhuo.cn</code>æ¥ä¸¾å‡ ä¸ªæ —å­<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//www.hanrenhui.cn/dir/a.html åŒæº</span></span><br><span class="line">http:<span class="comment">//www.hanrenhui.cn:50/dir2/a.html ç«¯å£ä¸åŒï¼Œä¸åŒæº</span></span><br><span class="line">https:<span class="comment">//www.hanrenhuo.cn/dir/a.html åè®®ä¸åŒ ä¸åŒæº</span></span><br><span class="line">http:<span class="comment">//hanrenhui.cn  åŸŸåä¸åŒï¼Œä¸åŒæº</span></span><br></pre></td></tr></table></figure></p><h1 id="è·¨åŸŸé™åˆ¶"><a href="#è·¨åŸŸé™åˆ¶" class="headerlink" title="è·¨åŸŸé™åˆ¶"></a>è·¨åŸŸé™åˆ¶</h1><p>åŒæºç­–ç•¥çš„ç›®çš„æ˜¯å‡ºäºå¯¹<strong>ç”¨æˆ·ä¿¡æ¯å®‰å…¨</strong>çš„è€ƒè™‘ï¼Œå¦‚æœä¸åŒæºåˆ™æœ‰ä»¥ä¸‹å‡ ç§é™åˆ¶ğŸ‘‡</p><blockquote><p>Cookieã€LocalStorage å’Œ IndexDB æ— æ³•è¯»å–ã€‚<br>DOM æ— æ³•è·å¾—ã€‚<br>AJAX è¯·æ±‚ä¸èƒ½å‘é€ã€‚</p></blockquote><p>ä½†æ˜¯åœ¨æ—¥å¸¸codingå½“ä¸­ï¼Œå…ä¸äº†è¦è·¨åŸŸè¯·æ±‚ä¸€äº›æ•°æ®ï¼Œ é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹éƒ½æœ‰å“ªäº›è·¨åŸŸè§£å†³æ–¹æ¡ˆ</p><h1 id="document-domain"><a href="#document-domain" class="headerlink" title="document.domain"></a>document.domain</h1><p>å‰é¢æåˆ°ï¼Œä¸åŒæºæ—¶<code>DOMæ— æ³•è·å¾—</code>, æ¯”å¦‚çˆ¶çª—å£è¿è¡ŒğŸ‘‡ä»£ç ï¼Œæƒ³è¦è·å¾—iframeçª—å£çš„documentå¯¹è±¡ï¼Œå¦‚æœäºŒè€…ä¸åŒæºåˆ™ä¼šæŠ¥é”™<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"myIFrame"</span>).contentWindow.document</span><br></pre></td></tr></table></figure></p><p>åŒæ ·çš„å­çª—å£æƒ³è¦è·å–çˆ¶çª—å£çš„ä¿¡æ¯ä¹Ÿä¼šæŠ¥é”™<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.parent.document.body</span><br></pre></td></tr></table></figure></p><p>å¦‚æœè¿™ä¸¤ä¸ªçª—å£ä¸€çº§åŸŸåç›¸åŒï¼ŒäºŒçº§åŸŸåä¸åŒçš„è¯,ç±»ä¼¼ <code>http://www.hanrenhui.cn</code>å’Œ<code>http://a.hanrenhui.cn</code>ï¼ŒäºŒè€…æ‹¥æœ‰å…¬å…±çš„ä¸€çº§åŸŸåä¹Ÿå°±æ˜¯<code>hanrenhui.cn</code>ï¼Œé‚£ä¹ˆåœ¨åè®®å’Œç«¯å£éƒ½ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªçª—å£è®¾ç½®ç›¸åŒçš„<strong>document.domain</strong>å°±å¯è·å–å¯¹æ–¹çš„domå’Œæ•°æ®</p><h1 id="ç‰‡æ®µæ ‡è¯†ç¬¦"><a href="#ç‰‡æ®µæ ‡è¯†ç¬¦" class="headerlink" title="ç‰‡æ®µæ ‡è¯†ç¬¦"></a>ç‰‡æ®µæ ‡è¯†ç¬¦</h1><p>å…ˆäº†è§£ä¸‹ç‰‡æ®µæ ‡è¯†ç¬¦ï¼Œç‰‡æ®µæ ‡è¯†ç¬¦æŒ‡çš„æ˜¯urlä¸­<strong>#</strong>åè¾¹çš„å†…å®¹, å®ƒä»£è¡¨é¡µé¢ä¸­çš„æŸä¸ªä½ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•åˆ©ç”¨å®ƒæ¥å®Œæˆè·¨åŸŸé€šä¿¡å‘¢ï¼Œ<br>å‡è®¾æˆ‘ä»¬æœ‰ä¸‰ä¸ªé¡µé¢ï¼Œ<code>a.html</code>, <code>b.html</code>, <code>c.html</code>, a, båŒæºï¼Œ ä¸cä¸åŒæºï¼Œaé¡µé¢å¯ä»¥æŠŠä¿¡æ¯æ”¾åˆ°å­é¡µé¢bçš„ç‰‡æ®µæ ‡è¯†ç¬¦ä¸­ï¼Œå­é¡µé¢bå°±å¯ä»¥æ”¶åˆ°açš„ä¿¡æ¯ï¼Œ é‚£ä¹ˆbå¦‚ä½•å‘aå‘é€æ¶ˆæ¯å‘¢, æœ‰äººå¯èƒ½ä¼šæƒ³åˆ°æ”¹å˜<code>window.parent.location.hash</code>çš„å€¼ï¼Œä¸å¥½æ„æ€a, cä¸¤ä¸ªé¡µé¢æ˜¯ä¸åŒæºçš„é€šè¿‡<code>window.parent</code>æ˜¯æ‹¿ä¸åˆ°çˆ¶é¡µé¢çš„ï¼Œé‚£å’‹åŠï¼Ÿa, cä¸åŒæºï¼Œ ä½†æ˜¯a, båŒæºå•Šï¼Œaå°†æ¶ˆæ¯ä¼ ç»™cä»¥åï¼Œ cå°†è¦å‘ç»™açš„æ¶ˆæ¯å…ˆé€šè¿‡hashå€¼ä¼ ç»™bï¼Œ bå†é€šè¿‡<code>window.parent.parent</code>çš„æ–¹å¼æ‹¿åˆ°aé¡µé¢ï¼Œæ”¹å˜å…¶<code>hash</code>å€¼, aé¡µé¢å†ç›‘å¬hashå€¼å¾—å˜åŒ–å°±å¯ä»¥äº†ï¼Œ show you codeğŸ‘‡<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// aé¡µé¢</span></span><br><span class="line"><span class="comment">// html</span></span><br><span class="line">&lt;iframe src=<span class="string">"http://localhost:3000/public/c.html#hello"</span> id=<span class="string">"frame"</span> frameborder=<span class="string">"0"</span> onload=<span class="string">''</span>&gt;&lt;/iframe&gt;</span><br><span class="line"><span class="comment">// js</span></span><br><span class="line"><span class="built_in">window</span>.onhashchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(location.hash)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// cé¡µé¢åªéœ€è¦ä¿®æ”¹js</span></span><br><span class="line"><span class="keyword">let</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>)</span><br><span class="line"><span class="keyword">let</span> str = <span class="string">'gun'</span></span><br><span class="line">iframe.src = <span class="string">`http://localhost:1688/public/b.html#<span class="subst">$&#123;str&#125;</span>`</span></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(iframe)</span><br><span class="line"><span class="comment">//bé¡µé¢</span></span><br><span class="line"><span class="built_in">window</span>.parent.parent.location.hash = location.hash</span><br></pre></td></tr></table></figure></p><p>ä¸å¾—ä¸è¯´è¿™ä¸ªæ–¹æ¡ˆçœŸè®©äººæ¶å¿ƒğŸ¤¢ï¼Œæˆ‘æƒ³å’Œå¯¹è±¡èŠèŠå¤©è¿˜è¦ä¸€ä¸ªç¬¬ä¸‰è€…æ¥ä¼ è¾¾æ¶ˆæ¯ï¼Ÿ Shitï¼ŒI still singleğŸ¶! æ¶å¿ƒä¸è¦ç´§ï¼Œä¸‹é¢è¿™ä¸ªæ–¹æ³•ç›¸æ¯”ä¹‹ä¸‹å¯è®©äººå¥½å—å¤šäº†ï¼Œï¼Œæœ‰ä¸ªä¸‹è¾¹è¿™ç§æ–¹æ¡ˆï¼Œè·¨çª—å£é€šä¿¡ä¼°è®¡è¿™ç§æ–¹æ³•è¦æˆä¸ºå†å²äº†å§ï¼ï¼ I still single ğŸ˜­</p><h1 id="postMessage"><a href="#postMessage" class="headerlink" title="postMessage"></a>postMessage</h1><p>HTML5ä¸ºäº†è§£å†³è·¨çª—å£é€šä¿¡çš„é—®é¢˜ï¼Œå¼•å…¥äº†ä¸€ä¸ªå…¨æ–°çš„APIï¼šè·¨æ–‡æ¡£é€šä¿¡ APIï¼ˆCross-document messaging) è¿™ä¸ªAPIå…è®¸è·¨çª—å£é€šä¿¡ï¼Œæ— è®ºæ˜¯å¦åŒæº,ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªapiæ€ä¹ˆç”¨<br>çˆ¶çª—å£å‘é€æ¶ˆæ¯ï¼Œå­çª—å£æ¥æ”¶æ¶ˆæ¯<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">çˆ¶çª—å£</span><br><span class="line">  <span class="keyword">let</span> child = <span class="built_in">window</span>.open(<span class="string">'http://127.0.0.1:5500/prop/child.html'</span>);</span><br><span class="line">  setInterval(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    child.postMessage(<span class="string">'hello my son'</span>, <span class="string">'http://127.0.0.1:5500/prop/child.html'</span>);</span><br><span class="line">  &#125;,<span class="number">1000</span>);</span><br><span class="line">å­çª—å£</span><br><span class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e.source); <span class="comment">// å‘é€æ¶ˆæ¯çš„çª—å£</span></span><br><span class="line">    <span class="built_in">console</span>.log(e.origin);  <span class="comment">// æ¶ˆæ¯å‘é€çš„åœ°å€</span></span><br><span class="line">    <span class="built_in">console</span>.log(e.data); <span class="comment">// å‘é€è¿‡æ¥çš„æ¶ˆæ¯</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure></p><p>æˆ–è€…æ˜¯å­çª—å£å‘é€æ¶ˆæ¯ï¼Œçˆ¶çª—å£æ¥æ”¶æ¶ˆæ¯<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">çˆ¶çª—å£</span><br><span class="line">  <span class="keyword">let</span> child = <span class="built_in">window</span>.open(<span class="string">'http://127.0.0.1:5500/prop/child.html'</span>);</span><br><span class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>, e=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e.data);</span><br><span class="line">  &#125;);</span><br><span class="line">å­çª—å£</span><br><span class="line">   setInterval(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">window</span>.opener.postMessage(<span class="string">'hello, my father'</span>, <span class="string">'http://127.0.0.1:5500/Prop/parent.html'</span>);</span><br><span class="line">  &#125;,<span class="number">1000</span>);</span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆç»“åˆiframeæ€ä¹ˆç”¨å‘¢?<br>index1.htmlæ˜¯è¿™æ ·çš„ğŸ‘‡<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=<span class="string">"http://localhost:3000/public/index2.html"</span> id=<span class="string">"frame"</span> frameborder=<span class="string">"0"</span> onload=<span class="string">'load()'</span>&gt;&lt;/iframe&gt;</span><br><span class="line">frame.contentWindow.postMessage(<span class="string">'How are you'</span>, <span class="string">'http://localhost:3000'</span>)</span><br><span class="line"><span class="built_in">window</span>.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e.data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>index2.htmlæ˜¯è¿™æ ·çš„ğŸ‘‡<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e.data);</span><br><span class="line">  e.source.postMessage(<span class="string">'so far so good'</span>, e.origin)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="window-name-iframe"><a href="#window-name-iframe" class="headerlink" title="window.name + iframe"></a>window.name + iframe</h1><blockquote><p>æµè§ˆå™¨çª—å£æœ‰window.nameå±æ€§ã€‚è¿™ä¸ªå±æ€§çš„æœ€å¤§ç‰¹ç‚¹æ˜¯ï¼Œæ— è®ºæ˜¯å¦åŒæºï¼Œåªè¦åœ¨åŒä¸€ä¸ªçª—å£é‡Œï¼Œå‰ä¸€ä¸ªç½‘é¡µè®¾ç½®äº†è¿™ä¸ªå±æ€§ï¼Œåä¸€ä¸ªç½‘é¡µå¯ä»¥è¯»å–å®ƒã€‚</p></blockquote><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸‰ä¸ªé¡µé¢ <code>a.html</code>, <code>b.html</code>, <code>c.html</code> å…¶ä¸­ aï¼Œbä¸¤ä¸ªé¡µé¢åŒæºå¹¶å’Œcä¸åŒæºï¼Œ é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨açš„ iframeä¸­å¼•ç”¨cé¡µé¢ï¼Œcé¡µé¢å°†æ•°æ®å­˜åœ¨<code>window.name</code>ä¸­ï¼Œ aé¡µé¢iframeåŠ è½½å®Œæˆåå°†iframeçš„srcæŒ‡å‘åŒæºçš„bé¡µé¢, åœ¨bé¡µé¢ä¸­å°±å¯ä»¥æ‹¿åˆ°æ•°æ®ï¼Œ çœ‹ç€æŒºç»•ï¼Œçœ‹ä¸‹ä»£ç ğŸ‘‡<br>ä¸¾ä¸ªæ —å­<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// html </span></span><br><span class="line">  &lt;iframe src=<span class="string">"http://localhost:3000/public/C.html"</span> id=<span class="string">"frame"</span> frameborder=<span class="string">"0"</span> onload=<span class="string">'load()'</span>&gt;&lt;/iframe&gt;</span><br><span class="line"><span class="comment">// js</span></span><br><span class="line">  <span class="keyword">let</span> flag = <span class="literal">true</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">load</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(flag) &#123;</span><br><span class="line">      <span class="keyword">let</span> frame = <span class="built_in">document</span>.querySelector(<span class="string">'iframe'</span>)</span><br><span class="line">      frame.src = <span class="string">'http://localhost:1688/public/b.html'</span></span><br><span class="line">      flag = <span class="literal">false</span></span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> data =  frame.contentWindow.name</span><br><span class="line">      <span class="built_in">console</span>.log(data) <span class="comment">// æ‹¿åˆ°æ•°æ®</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><h1 id="WebSocket-è·¨åŸŸ"><a href="#WebSocket-è·¨åŸŸ" class="headerlink" title="WebSocket è·¨åŸŸ"></a>WebSocket è·¨åŸŸ</h1><h2 id="ä»€ä¹ˆæ˜¯WebSocket"><a href="#ä»€ä¹ˆæ˜¯WebSocket" class="headerlink" title="ä»€ä¹ˆæ˜¯WebSocket"></a>ä»€ä¹ˆæ˜¯WebSocket</h2><p><code>WebSocket</code>æ˜¯ä¸€ç§åè®®ï¼Œç±»ä¼¼äºæˆ‘ä»¬ç†ŸçŸ¥çš„<code>HTTPåè®®</code>ï¼Œ ä½†æ˜¯httpåè®®å‘¢åªæ”¯æŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯ï¼Œè€ŒWebSocketåˆ™æ”¯æŒå…¨åŒå·¥é€šä¿¡ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥ä¸»åŠ¨å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼Œè¿˜æœ‰ç‚¹ä¸åŒï¼Œé‚£å°±æ˜¯WebSocketåè®®ä¸å—åŒæºç­–ç•¥çš„é™åˆ¶ï¼Œ æ­¤å¤„åªæ˜¯ç®€å•åˆ—ä¸‹ç”¨æ³•ï¼Œ å…³äºè¯¦ç»†çŸ¥è¯†ï¼Œå†æ¨é€<a href="http://www.ruanyifeng.com/blog/2017/05/websocket.html" target="_blank" rel="noopener">é˜®ä¸€å³°è€å¸ˆçš„è¿™ç¯‡æ–‡ç« </a>ï¼Œ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹æ€ä¹ˆä½¿ç”¨</p><p>å®¢æˆ·ç«¯(<a href="http://localhost:1688" target="_blank" rel="noopener">http://localhost:1688</a>)<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> socket = <span class="keyword">new</span> WebSocket(<span class="string">'ws://localhost:4000'</span>)</span><br><span class="line">socket.onopen = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  socket.send(<span class="string">'How are you'</span>)</span><br><span class="line">&#125;</span><br><span class="line">socket.onmessage =<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e.data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æœåŠ¡ç«¯(<a href="http://localhost:3000" target="_blank" rel="noopener">http://localhost:3000</a>)<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> WebSocket  <span class="keyword">from</span> <span class="string">'ws'</span></span><br><span class="line"><span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">'express'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = express()</span><br><span class="line"><span class="keyword">let</span> wss = <span class="keyword">new</span> WebSocket.Server(&#123;<span class="attr">port</span> :<span class="number">4000</span>&#125;)</span><br><span class="line"></span><br><span class="line">wss.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">ws</span>) </span>&#123;</span><br><span class="line">  ws.on(<span class="string">'message'</span>, data =&gt; &#123;</span><br><span class="line">    <span class="comment">// console.log(data)</span></span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">    ws.send(<span class="string">'So far so good'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure></p><h1 id="JSONPè·¨åŸŸ"><a href="#JSONPè·¨åŸŸ" class="headerlink" title="JSONPè·¨åŸŸ"></a>JSONPè·¨åŸŸ</h1><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>ä¸çŸ¥å¤§å®¶æœ‰æ²¡æœ‰å‘ç°ï¼Œhtmlé™æ€æ ‡ç­¾çš„<code>src</code>æˆ–è€…<code>href</code>è¯·æ±‚çš„å†…å®¹æ˜¯ä¸å—åŒæºç­–ç•¥çš„é™åˆ¶çš„ï¼Œè¿™å°±æ˜¯<code>JSONP</code>çš„ç²¾é«“æ‰€åœ¨<br>ä¸¾ä¸ªæ —å­<br>æˆ‘ä»¬æ–°å»ºä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œç„¶åæ·»åŠ ä»¥ä¸‹ä»£ç <br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"http://localhost:1688"</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬æŠŠnodeæœåŠ¡å™¨å¯åŠ¨èµ·æ¥ï¼Œç›‘å¬1688ç«¯å£,ç›‘å¬è·¯ç”±æ·»åŠ ä»¥ä¸‹ä»£ç <br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">'/'</span>, (req, res)=&gt;&#123;</span><br><span class="line">  res.end(<span class="string">'body&#123;background: red&#125;'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>ç„¶åæˆ‘ä»¬æ‰“å¼€htmlæ–‡ä»¶ï¼Œå±•ç°åœ¨é¢å‰çš„æ˜¯ä¸€ä¸ªèƒŒæ™¯ä¸ºçº¢è‰²çš„ç©ºé¡µé¢<br>æˆ‘ä»¬å†æ‹¿scriptåšä¸ªå®éªŒ<br>æ–°å»ºhtmlæ–‡ä»¶ï¼Œç„¶åæ·»åŠ å·²ä¸‹ä»£ç <br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125; </span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script src="http:/</span><span class="regexp">/localhost:1688"&gt;&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure></p><p>ä¿®æ”¹nodeè·¯ç”±<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">router.get(&apos;/&apos;, (req, res)=&gt;&#123;</span><br><span class="line">  res.end(&apos;callback(&#123;name: &quot;éŸ“ä»è¼&quot;, age: 21&#125;)&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>æ‰“å¼€htmlæ–‡ä»¶<br><figure class="image-box">                <img src="2.png" alt="" title="" class="">                <p></p>            </figure><br>è¿™å°±æ˜¯JSONPçš„æ ¸å¿ƒæ€æƒ³ï¼Œå°†å‡½æ•°åœ¨å‰ç«¯æå‰å®šä¹‰å¥½ï¼Œç„¶ååˆ©ç”¨scriptæ ‡ç­¾ä»åå°è¿”å›è°ƒç”¨è¯­å¥</p><h2 id="æ‰‹æ’¸ä¸€ä¸ªJSONP"><a href="#æ‰‹æ’¸ä¸€ä¸ªJSONP" class="headerlink" title="æ‰‹æ’¸ä¸€ä¸ªJSONP"></a>æ‰‹æ’¸ä¸€ä¸ªJSONP</h2><p>æ˜ç™½åŸç†ä»¥åæˆ‘ä»¬æ¥å†™ä¸€ä¸ªï¼Œå¤§ä½“æ€æƒ³å°±æ˜¯å°è£…ä¸€ä¸ªjsonpå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åŠ¨æ€çš„åˆ›å»ºä¸€ä¸ªscriptæ ‡ç­¾å¹¶appendToåˆ°bodyé‡Œå»ï¼Œæ ‡ç­¾çš„srcç”±å¤–ç•Œä¼ å…¥<br>å‰ç«¯ä»£ç <br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsonp</span>(<span class="params">option</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// åŠ¨æ€åˆ›å»ºä¸€ä¸ªscriptæ ‡ç­¾</span></span><br><span class="line">   <span class="keyword">let</span> scrip = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">   <span class="comment">// callbackName è¿™ç§æ–¹å¼æ˜¯é˜²æ­¢æµè§ˆå™¨cache</span></span><br><span class="line">   <span class="keyword">let</span> callbackName = <span class="string">`myfunc_<span class="subst">$&#123;<span class="built_in">Math</span>.random().toString().substr(<span class="number">2</span>)&#125;</span>`</span></span><br><span class="line">   <span class="comment">// å°†scriptçš„srcæŒ‡å‘å¤–ç•Œä¼ è¿›æ¥çš„url</span></span><br><span class="line">   scrip.src = <span class="string">`<span class="subst">$&#123;option.url&#125;</span>?callback=<span class="subst">$&#123;callbackName&#125;</span>`</span>;</span><br><span class="line">   <span class="comment">// å°†æ–°å»ºçš„script æ·»åŠ åˆ°bodyä¸­ï¼Œæ·»åŠ å®Œæˆå°±ä¼šè‡ªåŠ¨å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›å‡½æ•°æ‰§è¡Œè¯­å¥ï¼Œ</span></span><br><span class="line">   <span class="built_in">document</span>.body.appendChild(scrip);</span><br><span class="line">   <span class="comment">// è¿™æ˜¯æ˜¯ä¸Šè¾¹æˆ‘ä»¬æ‰€è¯´çš„æå‰å®šä¹‰çš„å‡½æ•°</span></span><br><span class="line">   <span class="built_in">window</span>[callbackName] = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">     option.success(data);</span><br><span class="line">     <span class="comment">// æ‰§è¡Œå®Œä»¥åå°±æŠŠå¤šä½™çš„scriptæ ‡ç­¾å»é™¤</span></span><br><span class="line">     <span class="built_in">document</span>.body.removeChild(scrip);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> jsonp(&#123;</span><br><span class="line">   url: <span class="string">'http://localhost:1688'</span>,</span><br><span class="line">   success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(data);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure></p><p>åç«¯ä»£ç <br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">'/'</span>, (req, res)=&gt;&#123;</span><br><span class="line">  <span class="comment">// å°†è¦ä¼ ç»™å‰ç«¯çš„æ•°æ®åŒ…è£…æˆjsonå­—ç¬¦ä¸²</span></span><br><span class="line">  <span class="keyword">let</span> data = <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">    name: <span class="string">'éŸ“ä»è¼'</span>,</span><br><span class="line">    age: <span class="number">21</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// å°†å‡½æ•°æ‰§è¡Œè¯­å¥è¿”å›ç»™å‰ç«¯</span></span><br><span class="line">  res.end(<span class="string">`<span class="subst">$&#123;req.query.callback&#125;</span>(<span class="subst">$&#123;data&#125;</span>)`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h1 id="CORS-è·¨åŸŸ"><a href="#CORS-è·¨åŸŸ" class="headerlink" title="CORS è·¨åŸŸ"></a>CORS è·¨åŸŸ</h1><blockquote><p>CORSæ˜¯ä¸€ä¸ªW3Cæ ‡å‡†ï¼Œå…¨ç§°æ˜¯â€è·¨åŸŸèµ„æºå…±äº«â€ï¼ˆCross-origin resource sharingï¼‰ã€‚å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡ºXMLHttpRequestè¯·æ±‚ï¼Œä»è€Œå…‹æœäº†AJAXåªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚CORSéœ€è¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŒæ—¶æ”¯æŒã€‚ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒè¯¥åŠŸèƒ½ï¼ŒIEæµè§ˆå™¨ä¸èƒ½ä½äºIE10ã€‚æ•´ä¸ªCORSé€šä¿¡è¿‡ç¨‹ï¼Œéƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦ç”¨æˆ·å‚ä¸ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼ŒCORSé€šä¿¡ä¸åŒæºçš„AJAXé€šä¿¡æ²¡æœ‰å·®åˆ«ï¼Œä»£ç å®Œå…¨ä¸€æ ·ã€‚æµè§ˆå™¨ä¸€æ—¦å‘ç°AJAXè¯·æ±‚è·¨æºï¼Œå°±ä¼šè‡ªåŠ¨æ·»åŠ ä¸€äº›é™„åŠ çš„å¤´ä¿¡æ¯ï¼Œæœ‰æ—¶è¿˜ä¼šå¤šå‡ºä¸€æ¬¡é™„åŠ çš„è¯·æ±‚ï¼Œä½†ç”¨æˆ·ä¸ä¼šæœ‰æ„Ÿè§‰ã€‚å› æ­¤ï¼Œå®ç°CORSé€šä¿¡çš„å…³é”®æ˜¯æœåŠ¡å™¨ã€‚åªè¦æœåŠ¡å™¨å®ç°äº†CORSæ¥å£ï¼Œå°±å¯ä»¥è·¨æºé€šä¿¡ã€‚</p></blockquote><p>æˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡å™¨ç«¯åšå¦‚ä¸‹é…ç½®ï¼Œå°±å¯ä»¥å®ç°corsè·¨åŸŸ<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">app.all(<span class="string">"*"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä¸Šè¾¹è¯´äº†ï¼Œæµè§ˆå™¨ä¸€æ—¦æ£€æµ‹åˆ°ajaxè¯·æ±‚è·¨åŸŸï¼Œå°±ä¼šé™„åŠ ä¸€äº›å¤´ä¿¡æ¯ï¼Œå…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯ORiginè¿™ä¸ªå­—æ®µï¼Œ</span></span><br><span class="line">  <span class="comment">// è¿™å¥ä»£ç æ£€æµ‹è¯·æ±‚ä¸­æ˜¯å¦å¸¦æœ‰è¯¥å­—æ®µï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¸æ˜¯è·¨åŸŸè¯·æ±‚ï¼Œç›´æ¥è·³è¿‡ï¼Œä¸å½’å’±ç®¡</span></span><br><span class="line">  <span class="keyword">if</span> (!req.get(<span class="string">"Origin"</span>)) <span class="keyword">return</span> next();</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//è¿™ä¸ªå¤´éƒ¨å­—æ®µè¡¨ç¤ºè¯¥æœåŠ¡å™¨æ¥æ”¶å“ªäº›åŸŸçš„è·¨åŸŸè¯·æ±‚ï¼Œå¯ä¸ºæ˜Ÿå·(*)è¡¨ç¤ºä»»æ„è¯·æ±‚ï¼Œæˆ–è€…å…·ä½“æŸä¸ªåŸŸåï¼Œè¡¨ç¤ºåªæ¥å—è¯¥åŸŸåçš„è¯·æ±‚</span></span><br><span class="line">  res.set(<span class="string">"Access-Control-Allow-Origin"</span>,<span class="string">"http://127.0.0.1:5500"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½®å…è®¸çš„è¯·æ±‚ç±»å‹ é»˜è®¤åªå…è®¸ get head post</span></span><br><span class="line">  res.set(<span class="string">"Access-Control-Allow-Methods"</span>, <span class="string">"PUT"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœå‰ç«¯æƒ³è¦è®¾ç½®è¯·æ±‚å¤´çš„è¯ï¼Œè¿™é‡Œå°±è¦è®¾ç½®ä¸€ä¸‹å‰ç«¯è¦è®¾ç½®çš„è¯·æ±‚å¤´</span></span><br><span class="line">  res.set(<span class="string">"Access-Control-Allow-Headers"</span>: <span class="string">"name,age,..."</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœåœ¨æœ¬æ¬¡è¯·æ±‚çš„å“åº”ä¸­ åç«¯è¦setHeaderè®¾ç½®å“åº”å¤´çš„è¯ï¼Œå‰ç«¯è¦é€šè¿‡xhr.getResponseHeader("name")æ‹¿çš„è¯ä¹Ÿä¼šæŠ¥é”™éœ€è¦è¿™æ ·è®¾ç½®ä¸€ä¸‹</span></span><br><span class="line">  res.set(<span class="string">"Access-Control-Expose-Headers"</span>: <span class="string">"name, age , ...."</span>)</span><br><span class="line">  <span class="comment">// å¦‚æœæƒ³è¦å…è®¸å‰ç«¯å‘é€cookieï¼Œåˆ™è¦è®¾ç½®æ­¤å­—æ®µï¼ŒåŒæ—¶å‰å°å‘èµ·ajaxè¯·æ±‚çš„æ—¶å€™åšå¦‚ä¸‹è®¾ç½®</span></span><br><span class="line">  <span class="comment">// var xhr = new XMLHttpRequest();</span></span><br><span class="line">  <span class="comment">// document.cookie = 'hertz'</span></span><br><span class="line">  <span class="comment">// xhr.withCredentials = true;</span></span><br><span class="line">  <span class="comment">// æ³¨æ„ï¼šå¦‚æœè¦æƒ³å‰ç«¯æºå¸¦cookieé‚£ä¹ˆaccess-control-allow-originå°±åªèƒ½è®¾ç½®ç‰¹å®šçš„åŸŸ</span></span><br><span class="line">  res.set(<span class="string">"Access-Control-Allow-Credentials"</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤æ‚è¯·æ±‚çš„é¢„æ£€è¯·æ±‚ï¼Œéš”6ç§’å‘ä¸€æ¬¡ï¼Œ å†è¿™6ç§’å†…ï¼Œå¦‚æœå‘è¿‡é¢„è¯·æ±‚å°±ä¸ä¼šå†å‘</span></span><br><span class="line">  <span class="comment">//  å…³äºç®€å•è¯·æ±‚å’Œå¤æ‚è¯·æ±‚ï¼Œå¯å‚è€ƒ[é˜®ä¸€å³°å¤§ä½¬çš„è¿™ç¯‡æ—¥å¿—](http://www.ruanyifeng.com/blog/2016/04/cors.html)</span></span><br><span class="line">  res.set(<span class="string">"Access-Control-Max-Age"</span>: <span class="number">6</span>);</span><br><span class="line">  <span class="comment">// å¤æ‚è¯·æ±‚çš„é¢„è¯·æ±‚ï¼Œç›´æ¥ç»“æŸæœ¬æ¬¡è¯·æ±‚å°±å¥½ï¼Œé¢„è¯·æ±‚çš„methodä¸ºoptions</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">"OPTIONS"</span> === req.method) <span class="keyword">return</span> res.json(<span class="number">200</span>);</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h1 id="webpack-ä»£ç†è·¨åŸŸ"><a href="#webpack-ä»£ç†è·¨åŸŸ" class="headerlink" title="webpack ä»£ç†è·¨åŸŸ"></a>webpack ä»£ç†è·¨åŸŸ</h1><p>é€šè¿‡è®¾ç½®webpack devServerçš„poxyå±æ€§ï¼Œè®©å…¶ä»£ç†è·¨åŸŸ<br>å…·ä½“è®¾ç½®å¦‚ä¸‹<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: ...,</span><br><span class="line">  output: ...,</span><br><span class="line">  <span class="built_in">module</span>: ...,</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="string">'/api'</span>: &#123;  <span class="comment">//ä½¿ç”¨"/api"æ¥ä»£æ›¿çº¿ä¸ŠæœåŠ¡å™¨åœ°å€</span></span><br><span class="line">        target: <span class="string">'http://mobile.yangkeduo.com'</span>, <span class="comment">//æºåœ°å€</span></span><br><span class="line">        changeOrigin: <span class="literal">true</span>, <span class="comment">//æ”¹å˜æº</span></span><br><span class="line">        pathRewrite: &#123;</span><br><span class="line">          <span class="string">'^/api'</span>: <span class="string">''</span> <span class="comment">//è·¯å¾„é‡å†™</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>åŒæºç­–ç•¥é’ˆå¯¹çš„æ˜¯å‰ç«¯ï¼Œå¯¹æœåŠ¡å™¨å¹¶æ— è¦æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®©å‰ç«¯å¯¹åŒæºçš„æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œç„¶ååŒæºæœåŠ¡å™¨ä½œä¸ºä»£ç†å»å‘ç›®æ ‡æœåŠ¡å™¨è¯·æ±‚æ•°æ®ï¼Œç„¶åæŠŠæ•°æ®ç»™æˆ‘ä»¬, è¿™å°±æ˜¯<code>devServer</code>çš„åŸç†ï¼Œå†…éƒ¨ç”¨çš„æ˜¯<code>http-proxy-middleware</code>ä¸­é—´ä»¶</p><h1 id="Nginxåå‘ä»£ç†"><a href="#Nginxåå‘ä»£ç†" class="headerlink" title="Nginxåå‘ä»£ç†"></a>Nginxåå‘ä»£ç†</h1><p>è¿™ä¹Ÿæ˜¯ç›®å‰å®ç°è·¨åŸŸéå¸¸å¸¸è§çš„æ‰‹æ®µï¼Œä½†æ˜¯ç”±äºæœ¬äººè¿˜æœªå­¦ä¹ åˆ°è¿™éƒ¨åˆ†å†…å®¹ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œä¹Ÿæ”¾ä¸ªæ ‡é¢˜ï¼ŒåæœŸå†è¡¥å……â€¦.</p>]]></content>
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> è·¨åŸŸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> è·¨åŸŸ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä»EventLoopè°ˆjsè¿è¡Œæœºåˆ¶</title>
      <link href="/blog/2018/12/01/js%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6/"/>
      <url>/blog/2018/12/01/js%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6/</url>
      <content type="html"><![CDATA[<p>ä¹‹å‰åŒå­¦é—®äº†æˆ‘ä¸€å¥ <code>jsè¿è¡Œæœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ</code> ï¼Œå½“æ—¶æ˜¯æˆ‘ç¬¬ä¸€æ¬¡è§åˆ°è¿™ä¸ªæ¦‚å¿µï¼Œè„‘å­é‡Œä¸€å›¢æµ†ç³Šï¼Œæˆ‘è¯¥å›ç­”ä»€ä¹ˆã€‚ åŒæ­¥å¼‚æ­¥ï¼Ÿ Event Loop? è„‘å­é‡Œå…¨æ˜¯ä¸€äº›ç¢ç‰‡åŒ–çš„æ¦‚å¿µï¼Œ å¦‚æœè¿™æ˜¯é“é¢è¯•é¢˜é‚£æˆ‘å°±å‡‰äº†,å›å®¿èˆä»¥åå°±æŸ¥çœ‹äº†ä¸€äº›æ–‡ç« ï¼Œæ€»ç®—æ˜¯å¯¹jsçš„è¿è¡Œæœºåˆ¶æœ‰äº†ä¸€å®šçš„äº†è§£,åˆšå¥½ä»Šå¤©å‘¨æœ«æŠŠç¢ç‰‡åŒ–çš„çŸ¥è¯†æ¢³ç†ä¸€ä¸‹ï¼Œæ•´ç†æˆä¸€ç¯‡ç¬”è®°ï¼ˆä»æµè§ˆå™¨çš„å¤šè¿›ç¨‹ä¸€ç›´åˆ°jsçš„çº¿ç¨‹ï¼‰;</p><hr><h1 id="å¤šè¿›ç¨‹çš„æµè§ˆå™¨"><a href="#å¤šè¿›ç¨‹çš„æµè§ˆå™¨" class="headerlink" title="å¤šè¿›ç¨‹çš„æµè§ˆå™¨"></a>å¤šè¿›ç¨‹çš„æµè§ˆå™¨</h1><p>æµè§ˆå™¨åŒ…å«ä»¥ä¸‹å‡ ç§è¿›ç¨‹ğŸ‘‡:</p><ul><li><strong>Browserè¿›ç¨‹</strong>ï¼šæµè§ˆå™¨çš„ä¸»è¿›ç¨‹ (è´Ÿè´£åè°ƒä¸ä¸»æ§)</li><li><strong>ç¬¬ä¸‰æ–¹æ’ä»¶è¿›ç¨‹</strong> : æ¯ç§ç±»å‹çš„æ’ä»¶å¯¹åº”ä¸€ä¸ªè¿›ç¨‹ï¼Œåªæœ‰å½“ä½¿ç”¨è¯¥æ’ä»¶çš„æ—¶å€™æ‰ä¼šåˆ›å»º</li><li><strong>GPUè¿›ç¨‹</strong>: æœ€å¤šä¸€ä¸ªï¼Œç”¨äº3Dç»˜åˆ¶ç­‰â€¦.</li><li><strong>æµè§ˆå™¨æ¸²æŸ“è¿›ç¨‹(Rendererè¿›ç¨‹)</strong>ï¼šä¹Ÿå°±æ˜¯å¸¸è¯´çš„æµè§ˆå™¨å†…æ ¸ï¼šé»˜è®¤æ¯ä¸ªTabé¡µé¢ä¸€ä¸ªè¿›ç¨‹ï¼Œå¤šä¸ªé¡µé¢ä¹‹é—´äº’ä¸å½±å“ï¼Œç”¨äºé¡µé¢æ¸²æŸ“ï¼Œè„šæœ¬æ‰§è¡Œï¼Œäº‹ä»¶å¤„ç†ç­‰</li></ul><figure class="image-box">                <img src="1.png" alt="" title="" class="">                <p></p>            </figure><h1 id="å¤šçº¿ç¨‹çš„æµè§ˆå™¨æ¸²æŸ“è¿›ç¨‹-æµè§ˆå™¨å†…æ ¸"><a href="#å¤šçº¿ç¨‹çš„æµè§ˆå™¨æ¸²æŸ“è¿›ç¨‹-æµè§ˆå™¨å†…æ ¸" class="headerlink" title="å¤šçº¿ç¨‹çš„æµè§ˆå™¨æ¸²æŸ“è¿›ç¨‹(æµè§ˆå™¨å†…æ ¸)"></a>å¤šçº¿ç¨‹çš„æµè§ˆå™¨æ¸²æŸ“è¿›ç¨‹(æµè§ˆå™¨å†…æ ¸)</h1><p><code>Rendererè¿›ç¨‹</code>åŒ…å«ä»¥ä¸‹å‡ ä¸ªå¸¸é©»çº¿ç¨‹</p><ul><li><em>GUIæ¸²æŸ“çº¿ç¨‹</em>ï¼šè´Ÿè´£æ¸²æŸ“æµè§ˆå™¨çš„é¡µé¢ï¼Œè§£æHTMLæˆ<code>DOMæ ‘</code>,è§£æCSSæˆ<code>CSSOMæ ‘</code>,DOMå’ŒCSSOMç»„åˆæˆ<code>RenderTree</code>; è´Ÿè´£é‡ç»˜(repaint)å’Œå›æµ(reflow)ç­‰â€¦..</li><li><em>jså¼•æ“çº¿ç¨‹</em>: æœ¬æ–‡é‡ç‚¹ï¼Œä¹Ÿç§°ä¸º<strong>jså†…æ ¸</strong>ï¼Œè´Ÿè´£å¤„ç†jsçš„è„šæœ¬ç¨‹åº(æ³¨æ„ï¼šè¯¥çº¿ç¨‹ä¸GUIçº¿ç¨‹æ˜¯äº’æ–¥çš„ï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹è¿è¡Œï¼Œå¦ä¸€ä¸ªå°±ä¼šæŒ‚èµ·)</li><li><em>äº‹ä»¶è§¦å‘çº¿ç¨‹</em>: è´Ÿè´£æ§åˆ¶äº‹ä»¶çš„å¾ªç¯<ul><li>å½“jså¼•æ“å¤„ç†jsè„šæœ¬é‡åˆ°<code>setTimeOut</code>ç­‰å¼‚æ­¥äº‹ä»¶æ—¶ï¼Œä¼šå°†å¯¹åº”çš„ä»»åŠ¡æ·»åŠ åˆ°äº‹ä»¶çº¿ç¨‹ä¸­</li><li>å½“å¯¹åº”çš„äº‹ä»¶æœ‰äº†ç»“æœä»¥åï¼Œäº‹ä»¶è§¦å‘çº¿ç¨‹ä¼šå°†è¯¥ä»»åŠ¡æ·»åŠ åˆ°å¼‚æ­¥äº‹ä»¶é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œç­‰å¾…jså¼•æ“ç©ºé—²çš„æ—¶å€™æ¥å¤„ç†</li></ul></li><li><em>å®šæ—¶è§¦å‘å™¨çº¿ç¨‹</em>ï¼š è´Ÿè´£å®šæ—¶è®¡æ•°å™¨ï¼ˆå› ä¸ºjsæ˜¯å•çº¿ç¨‹ï¼Œå¤„äºé˜»å¡çŠ¶æ€çš„è¯ä¼šå½±å“è®¡æ—¶ï¼Œæ‰€ä»¥æµè§ˆå™¨æ‰å¤šå¼€ä¸€æ¡çº¿ç¨‹æ¥è¾…åŠ©jsçº¿ç¨‹ï¼‰</li><li><em>å¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹</em>: åœ¨<code>XMLHttpRequest</code>åœ¨è¿æ¥åæ˜¯é€šè¿‡æµè§ˆå™¨æ–°å¼€ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚;æ£€æµ‹åˆ°çŠ¶æ€å˜æ›´æ—¶ï¼Œå¦‚æœè®¾ç½®æœ‰å›è°ƒå‡½æ•°ï¼Œå¼‚æ­¥çº¿ç¨‹å°±äº§ç”ŸçŠ¶æ€å˜æ›´äº‹ä»¶ï¼Œå°†è¿™ä¸ªå›è°ƒå†æ”¾å…¥äº‹ä»¶é˜Ÿåˆ—ä¸­,å†ç”±JavaScriptå¼•æ“æ‰§è¡Œã€‚</li></ul><p><img src="2.png" alt=""></p><h1 id="ä»Event-Loopè°ˆJSçš„è¿è¡Œæœºåˆ¶"><a href="#ä»Event-Loopè°ˆJSçš„è¿è¡Œæœºåˆ¶" class="headerlink" title="ä»Event Loopè°ˆJSçš„è¿è¡Œæœºåˆ¶"></a>ä»Event Loopè°ˆJSçš„è¿è¡Œæœºåˆ¶</h1><p>è°ˆä¹‹å‰ï¼Œå…ˆç†è§£ä¸€äº›æ¦‚å¿µæ€§çš„ä¸œè¥¿</p><ul><li>jsåˆ†ä¸ºåŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡</li><li>åŒæ­¥ä»»åŠ¡åœ¨<code>ä¸»çº¿ç¨‹</code>ä¸Šè¿è¡Œï¼Œä¼šå½¢æˆä¸€ä¸ª<code>æ‰§è¡Œæ ˆ</code></li><li>äº‹ä»¶è§¦å‘çº¿ç¨‹ç®¡ç†ç€ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼ŒæŒ‰é¡ºåºä¿å­˜æœ‰äº†ç»“æœçš„å¼‚æ­¥äº‹ä»¶</li><li>ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„å¼‚æ­¥äº‹ä»¶åœ¨jså¼•æ“ç©ºé—²æ—¶ï¼ˆä¹Ÿå°±æ˜¯åŒæ­¥ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œçš„æ—¶å€™ï¼‰ï¼Œè¢«jså¼•æ“æ‰§è¡Œ</li><li>jsä¸­çš„ä»»åŠ¡åˆåˆ†ä¸º<strong>macrotask</strong>ï¼ˆå®ä»»åŠ¡ï¼‰å’Œ<strong>microtask</strong>ï¼ˆå¾®ä»»åŠ¡ï¼‰</li></ul><p>æˆ‘ä»¬æ­£å¼è¿›å…¥jså¼•æ“çš„è¿è¡Œæœºåˆ¶çš„åˆ†æ<br>å…ˆç›—å¼ å›¾ğŸ‘‡<br><figure class="image-box">                <img src="5.png" alt="" title="" class="">                <p></p>            </figure><br>æˆ‘ä»¬æ ¹æ®ä¸Šå›¾æ¥çœ‹,ä¸»çº¿ç¨‹è¿è¡Œçš„æ—¶å€™ä¼šå½¢æˆä¸€ä¸ªæ‰§è¡Œæ ˆï¼Œæ ˆä¸­çš„ä»£ç åœ¨è°ƒç”¨ä¸€äº›å¼‚æ­¥çš„APIæ—¶ï¼ˆç›¸å½“äºå¼‚æ­¥äº‹ä»¶æœ‰äº†ç»“æœï¼‰ï¼Œä¾¿ä¼šåœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­æ·»åŠ å¯¹åº”çš„å¼‚æ­¥äº‹ä»¶ï¼Œåœ¨jså¼•æ“ç©ºé—²çš„æ—¶å€™ï¼ˆä¹Ÿå°±æ˜¯æ‰§è¡Œæ ˆä¸­çš„ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œï¼‰ï¼Œä¾¿ä¼šéå†ä»»åŠ¡é˜Ÿåˆ—ï¼ŒæŒ‰ç…§å…ˆåé¡ºåºå°†ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„äº‹ä»¶å‹åˆ°æ‰§è¡Œæ ˆä¸­è¢«jså¼•æ“æ‰§è¡Œ,å¦‚æ­¤åå¤å½¢æˆä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰;<br>ä½†æ˜¯è¿™äº›è¿˜ä¸å¤Ÿï¼Œå› ä¸ºåœ¨ES6çš„Promiseä¸­åˆæœ‰äº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œå¾®ä»»åŠ¡ï¼ˆmicrotaskï¼‰;</p><h2 id="å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡"><a href="#å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡" class="headerlink" title="å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡"></a>å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡</h2><ul><li>å®ä»»åŠ¡ï¼šè¿™å°±åƒæ˜¯ä½ åœ¨åŒ»é™¢æŒ‚äº†å·æ’é˜Ÿä¸€æ ·ï¼Œæ­£åœ¨ç­‰å¾…çš„ç—…äººå°±æ˜¯ä¸€ä¸ªä¸ªçš„å®ä»»åŠ¡ï¼Œï¼Œé•¿é•¿çš„é˜Ÿä¼å°±å¯ä»¥çœ‹ä½œæ˜¯ä»»åŠ¡é˜Ÿåˆ—ï¼Œä»»åŠ¡é˜Ÿåˆ—ä¸­ä¿å­˜äº†æœ‰ç»“æœçš„å¼‚æ­¥äº‹ä»¶ï¼ˆä¸æ˜¯è¯´æ³¨å†Œäº†å°±å¾€é˜Ÿåˆ—ä¸­æ·»åŠ ï¼Œè€Œæ˜¯æœ‰ç»“æœä»¥å,æ¯”å¦‚clickäº‹ä»¶è§¦å‘ä»¥åï¼ŒsetTimeOutå»¶è¿Ÿæ—¶é—´åˆ°äº†ä»¥åâ€¦..ï¼‰ï¼Œçœ‹ç—…çš„åŒ»ç”Ÿå°±æ˜¯jså¼•æ“ï¼›åŒ»ç”Ÿä¸€æ¬¡åªèƒ½çœ‹ä¸€ä¸ªç—…äººï¼Œä¹Ÿå°±æ˜¯è¯´jså¼•æ“ä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œå¤„äºç©ºé—²çŠ¶æ€æ—¶æ‰ä¼šå»æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡;</li><li>å¾®ä»»åŠ¡ï¼š å®ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥æå¸¦ä¸€äº›å¾®ä»»åŠ¡ï¼Œç»“åˆåˆ°åˆšæ‰çš„ä¾‹å­é‡Œå°±æ˜¯ï¼Œå·²ç»è½®åˆ°ä½ çœ‹ç—…äº†ï¼Œä½†æ˜¯å¯èƒ½ç”±äºä½ å‰é¢çš„ç—…äººè®°æ€§ä¸å¤ªå¥½æŠŠåŒ»ç”Ÿçš„å˜±æ‰˜å¿˜è®°äº†ï¼Œåˆå›è¿‡å¤´æ¥é—®åŒ»ç”Ÿï¼Œé‚£è¿™ä¸ªæ—¶å€™åŒ»ç”Ÿæ€»ä¸èƒ½è®©ç—…äººé‡æ–°æ’é˜Ÿå§ï¼Œé‚£è¿™æ—¶å€™ä½ å°±åªèƒ½ç­‰ç€,åœ¨å½“å‰çš„å¾®ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œçš„æ—¶å€™æ˜¯ä¸ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡çš„ï¼›</li></ul><p>å®ä»»åŠ¡</p><figure class="image-box">                <img src="3.png" alt="" title="" class="">                <p></p>            </figure><p>å¾®ä»»åŠ¡<br><figure class="image-box">                <img src="4.png" alt="" title="" class="">                <p></p>            </figure></p><p>ç†è§£äº†å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ä»¥åï¼Œæˆ‘ä»¬å†æ¥å®Œå–„ä¸‹ä¸Šè¾¹æ‰€è¯´çš„Event Loopï¼›</p><ul><li>ä¸»çº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç  å½¢æˆä¸€ä¸ªæ‰§è¡Œæ ˆï¼ŒåŒæ—¶å¼‚æ­¥ä»»åŠ¡è¿›å…¥Event Tableå¹¶æ³¨å†Œå‡½æ•°</li><li>å¼‚æ­¥ä»»åŠ¡æœ‰äº†ç»“æœï¼Œè¢«äº‹ä»¶è§¦å‘çº¿ç¨‹æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå®ä»»åŠ¡è¿›å…¥å®ä»»åŠ¡é˜Ÿåˆ—(callbackqueue)ï¼Œå¾®ä»»åŠ¡è¿›å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—(taskqueue)ï¼›</li><li>å¾…æ‰§è¡Œæ ˆä¸­çš„ä»»åŠ¡æ‰§è¡Œå®Œä»¥åï¼Œå¼•æ“å…ˆæ¥æŸ¥çœ‹<code>taskqueue</code>ä¸­æ˜¯å¦æœ‰å¯æ‰§è¡Œçš„å¾®ä»»åŠ¡ï¼Œæœ‰çš„è¯æ‰§è¡Œæ‰€æœ‰çš„å¾®ä»»åŠ¡ï¼Œæ¸…ç©ºtaskqueue</li><li>å¾®ä»»åŠ¡æ‰§è¡Œå®Œï¼Œè¯»å–å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸€æ¬¡è¯»å–ä¸€ä¸ªï¼ˆä¸åŒäºå¾®ä»»åŠ¡ï¼‰ï¼Œè¯»å–ä¸€ä¸ªå°±å‹å…¥æ‰§è¡Œæ ˆä¸­æ‰§è¡Œ, æ¯æ‰§è¡Œå®Œä¸€ä¸ªå®ä»»åŠ¡å°±æ¸…ç©ºå¾®taskqueue,</li><li>å¦‚æ­¤å¾ªç¯ï¼Œå½¢æˆä¸€ä¸ªEvent Loop;</li></ul>]]></content>
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> javascript </category>
          
          <category> è¿è¡Œæœºåˆ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> javascript </tag>
            
            <tag> è¿è¡Œæœºåˆ¶ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä»å˜é‡æå‡çš„è§’åº¦æ¯”è¾ƒvarå’Œlet</title>
      <link href="/blog/2018/10/19/%E4%BB%8E%E5%8F%98%E9%87%8F%E6%8F%90%E5%8D%87%E7%9A%84%E8%A7%92%E5%BA%A6%E6%AF%94%E8%BE%83var%E5%92%8Clet/"/>
      <url>/blog/2018/10/19/%E4%BB%8E%E5%8F%98%E9%87%8F%E6%8F%90%E5%8D%87%E7%9A%84%E8%A7%92%E5%BA%A6%E6%AF%94%E8%BE%83var%E5%92%8Clet/</url>
      <content type="html"><![CDATA[<h1 id="ç¢ç¢å¿µ"><a href="#ç¢ç¢å¿µ" class="headerlink" title="ç¢ç¢å¿µ"></a>ç¢ç¢å¿µ</h1><p>å…¶å®è¿™ç¯‡ç¬”è®°æ˜¯åœ¨çœ‹ç”±ä¸€ä¸ªåä¸º<code>varçš„å˜é‡æå‡çš„åº•å±‚åŸç†</code>çš„é¢è¯•é¢˜è€Œå¼•èµ·çš„ï¼Œå½“æ—¶åªæ˜¯çŸ¥é“varå£°æ˜å˜é‡ä¼šå­˜åœ¨å˜é‡æå‡çš„æƒ…å†µï¼Œç„¶è€Œåº•å±‚å®ç°åŸç†å´æ¯«æ— æ¶‰åŠï¼Œåœ¨ç½‘ä¸Šçœ‹äº†å¤šç¯‡ç›¸å…³æ–‡ç« ï¼Œæ€»ç»“å‡ºè¿™ä¹ˆä¸€ç¯‡å°ç¬”è®°ï¼Œçº¯å±ä¸ªäººæµ…é™‹è§è§£ï¼Œè¯´çš„ä¸å¯¹çš„åœ°æ–¹ï¼Œå‹¿å–·ï¼Œå‹¿å–·ã€‚ã€‚ã€‚</p><hr><h1 id="ä»€ä¹ˆæ˜¯å˜é‡æå‡ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å˜é‡æå‡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å˜é‡æå‡ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å˜é‡æå‡ï¼Ÿ</h1><p>æ—¢ç„¶è¦æ¯”è¾ƒ<code>var</code>å’Œ<code>let</code>ï¼Œé‚£ä¸å¦¨æŠŠå˜é‡æå‡çš„æ¦‚å¿µå…ˆå†™ä¸€ä¸‹å§ï¼ğŸ‘‡</p><blockquote><p>JavaScript ä¸­ï¼Œå‡½æ•°åŠå˜é‡çš„å£°æ˜éƒ½å°†è¢«æå‡åˆ°å‡½æ•°çš„æœ€é¡¶éƒ¨ã€‚<code>JavaScript</code>ä¸­ï¼Œå˜é‡å¯ä»¥åœ¨ä½¿ç”¨åå£°æ˜ï¼Œä¹Ÿå°±æ˜¯å˜é‡å¯ä»¥å…ˆä½¿ç”¨å†å£°æ˜ã€‚</p></blockquote><p>ä¸¾ä¸ªæ —å­ï¼Ÿ<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(swag); <span class="comment">// undefined</span></span><br><span class="line">    <span class="keyword">var</span> swag = <span class="string">"hello,world"</span>;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p><p>æœ‰å…¶ä»–ç¼–ç¨‹è¯­è¨€åŸºç¡€çš„ç«¥é‹ä¼šè§‰å¾—ï¼Œåœ¨æˆ‘å®šä¹‰<code>swag</code>å˜é‡ä¹‹å‰è°ƒç”¨å®ƒï¼Œè‚¯å®šè¦æŠ¥é”™çš„å•Šï¼Œç„¶è€Œjsçš„å˜é‡æ¯”è¾ƒç¥å¥‡ï¼Œå®ƒç»™ä½ åœ¨åº•å±‚è¿™ä¹ˆå¹²äº†ğŸ‘‡</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> swagï¼›</span><br><span class="line">    <span class="built_in">console</span>.log(swag);</span><br><span class="line">    swag = <span class="string">"hello,world"</span>;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>ç°åœ¨æ˜¯ä¸æ˜¯è§‰å¾—è¾“å‡º<code>undefined</code>å°±æœ‰é“ç†çš„å¤šäº†ï¼Ÿ<br>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå˜é‡çš„å£°æ˜è¢«æå‡åˆ°ä½œç”¨åŸŸçš„é¡¶éƒ¨ï¼Œè¿™å°±æ˜¯<code>å˜é‡æå‡</code>(å‡½æ•°å®šä¹‰å…·æœ‰åŒæ ·çš„æ•ˆæœï¼Œä½†æ˜¯å‡½æ•°æå‡ä¼šæåˆ°å˜é‡å£°æ˜ä¸Šé¢)ï¼Œææ¸…æ¥šäº†varï¼Œä½ å¯èƒ½ä¼šåƒï¼ŒES6é‡Œçš„letï¼Œéš¾é“ä¹Ÿä¸€æ ·ä¹ˆï¼Ÿï¼Œé‚£æˆ‘ä»¬æŠŠvaræ¢æˆletè¯•è¯•ğŸ‘‡<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(swag); <span class="comment">// Uncaught ReferenceError: swag is not defined</span></span><br><span class="line">    <span class="keyword">let</span> swag = <span class="string">"hello,world"</span>;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p><p>ç„¶è€ŒæŠ¥é”™äº†ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿä¸æ€¥ï¼Œæˆ‘ä»¬ä¸€ç‚¹ç‚¹æ¥è¯´varå’Œletåœ¨<strong>å˜é‡æå‡è§’åº¦çš„åŒºåˆ«</strong>!</p><h1 id="å˜é‡ç”Ÿå‘½å‘¨æœŸ"><a href="#å˜é‡ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="å˜é‡ç”Ÿå‘½å‘¨æœŸ"></a>å˜é‡ç”Ÿå‘½å‘¨æœŸ</h1><p>å½“å¼•æ“è®¿é—®å˜é‡çš„æ—¶å€™ï¼Œå˜é‡ä¼šç»è¿‡ä»¥ä¸‹ä¸‰ç§ç”Ÿå‘½å‘¨æœŸ:</p><ul><li>å£°æ˜é˜¶æ®µ ï¼ˆè¿™ä¸ªé˜¶æ®µè®¿é—®å˜é‡çš„è¯ä¼šæŠ¥é”™ï¼‰</li><li>åˆå§‹åŒ–é˜¶æ®µ (åœ¨è¿™ä¸ªé˜¶æ®µå˜é‡å°±å¯ä»¥è®¿é—®äº†ï¼Œä½†æ˜¯å€¼æ˜¯undefined)</li><li>èµ‹å€¼é˜¶æ®µ</li></ul><h1 id="javascriptå¼•æ“çš„å·¥ä½œæ–¹å¼"><a href="#javascriptå¼•æ“çš„å·¥ä½œæ–¹å¼" class="headerlink" title="javascriptå¼•æ“çš„å·¥ä½œæ–¹å¼"></a>javascriptå¼•æ“çš„å·¥ä½œæ–¹å¼</h1><ul><li>å…ˆè§£æä»£ç ï¼Œè·å–æ‰€æœ‰è¢«å£°æ˜çš„å˜é‡</li><li>ç„¶åä¸€è¡Œè¡Œè¿è¡Œä»£ç </li></ul><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œjså¼•æ“ä¼šåˆ†ä¸ºé¢„å¤„ç†å’Œæ‰§è¡Œä¸¤ä¸ªé˜¶æ®µï¼Œå½“jså¼•æ“é‡åˆ°ä¸€ä¸ªä½œç”¨åŸŸæ—¶ï¼Œå¦‚æœæœ‰varå£°æ˜çš„å˜é‡ï¼ˆå¹¶ä¸æ˜¯ä»£ç æ‰§è¡Œåˆ°è¿™ä¸€è¡Œï¼Œè€Œæ˜¯å¼•æ“ç…äº†ä¸€çœ¼è¯¥åŸŸä¸­å…¨éƒ¨ä»£ç ,å‘ç°è¿™ä¸ªä½œç”¨åŸŸé‡Œæœ‰varå£°æ˜çš„å˜é‡ï¼‰ï¼Œä¾¿ä¼šé¦–å…ˆå¯¹è¿™ä¸ªå˜é‡ å£°æ˜å’Œåˆå§‹åŒ–(<strong>å¼•æ“é¢„å¤„ç†é˜¶æ®µ</strong>)ï¼Œä¹Ÿå°±æ˜¯å˜é‡ç”Ÿå‘½å‘¨æœŸçš„å‰ä¸¤ä¸ªé˜¶æ®µï¼Œå°±ç›¸å½“äºåœ¨ä½œç”¨äºå¤´éƒ¨<code>var</code>äº†ä¸€ä¸ªå˜é‡ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰èµ‹å€¼ï¼ˆæ­¤æ—¶çš„å€¼ä¸º<code>undefined</code>ï¼‰;è¿›è¡Œå®Œè¿™ä¸¤ä¸ªé˜¶æ®µä»¥åjså¼•æ“æ‰æ­£å¼ä»ä½œç”¨åŸŸå¤´éƒ¨å¼€å§‹ä¸€è¡Œè¡Œæ‰§è¡Œä»£ç (<strong>å¼•æ“æ‰§è¡Œé˜¶æ®µ</strong>)ï¼Œåœ¨ç¢°åˆ°å˜é‡çš„èµ‹å€¼è¯­å¥ä¹‹å‰ï¼Œæ‰€æœ‰è®¿é—®è¯¥å˜é‡çš„ä»£ç éƒ½è¿”å›<code>undefined</code>ï¼Œæ‰§è¡Œå®Œèµ‹å€¼è¯­å¥åè¯¥å˜é‡æ‰æ­£å¼æ‹¥æœ‰å€¼ï¼Œä»£ç ä¹Ÿæ‰å¯ä»¥æ­£å¸¸è®¿é—®è¯¥å€¼;</p><h1 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h1><p>é‚£ä¹ˆvarå’Œletçš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Œå˜é‡æ— è®ºæ˜¯é€šè¿‡letå£°æ˜ï¼Œè¿˜æ˜¯varå£°æ˜ï¼Œå˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸ä¼šå˜çš„ï¼Œä¸åŒç‚¹åœ¨äºvaré‡æ—¶ï¼Œå£°æ˜é˜¶æ®µå’Œåˆå§‹åŒ–é˜¶æ®µæ˜¯ä¸€èµ· çš„ï¼Œè€Œletå˜é‡æ˜¯åˆ†å¼€çš„ï¼Œä¸Šè¾¹è¯´åˆ°ï¼Œjsé‡åˆ°ä¸€ä¸ªä½œç”¨åŸŸï¼Œæ‰“çœ¼ä¸€çœ‹å¯¹varå£°æ˜çš„æ‰€æœ‰å˜é‡è¿›è¡Œå£°æ˜å’Œåˆå§‹åŒ–,æ­¤æ—¶å˜é‡å¯ä»¥è®¿é—®ï¼Œä½†æ˜¯å€¼è¦ç­‰åˆ°æ‰§è¡Œå®Œèµ‹å€¼è¯­å¥æ‰ä¼šæœ‰ï¼›è€Œletå‘¢ï¼Œletå®šä¹‰çš„å˜é‡ï¼Œjså¼•æ“åœ¨é¢„å¤„ç†é˜¶æ®µï¼Œåªä¼šå¯¹è¿™äº›å˜é‡è¿›è¡Œå£°æ˜è¿™ä¸€æ­¥æ“ä½œï¼Œç­‰åˆ°let a æ‰§è¡Œçš„æ—¶å€™æ‰ä¼šå®Œæˆåˆå§‹åŒ–é˜¶æ®µï¼Œè€Œåœ¨let a æ‰§è¡Œä¹‹å‰æ˜¯ä¸èƒ½è®¿é—®åˆ°let å®šä¹‰çš„æ‰€æœ‰å˜é‡çš„ï¼Œè¿™éš¾é“å°±æ˜¯es6é‡Œçš„æš‚æ—¶æ€§æ­»åŒºï¼Ÿlet a æ‰§è¡Œä¹‹åæ‰ä¼šæŠŠå˜é‡ä»æš‚æ—¶æ€§æ­»åŒºä¸­æ”¾å‡ºæ¥ï¼Œæœ€åèµ‹å€¼è¯­å¥æ‰§è¡Œå®Œä»¥åå°±å¯ä»¥æ‹¿åˆ°açš„å‡†ç¡®å€¼äº†</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>å…¶å®varå’Œletéƒ½ä¼šå­˜åœ¨æå‡çš„è¿™æ ·ä¸€ç§æƒ…å†µï¼Œåªä¸è¿‡var çš„è¯ä¼šå®Œæˆå˜é‡å£°æ˜å‘¨æœŸçš„å‰ä¸¤ä¸ªé˜¶æ®µï¼Œç›¸å½“äºvar aï¼›æ‰€ä»¥ä¹‹åå°±å¯ä»¥è®¿é—®åˆ°äº†ï¼Œè€Œletçš„è¯åªæ˜¯å®Œæˆç”Ÿå‘½å‘¨æœŸçš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œæ­¤æ—¶çš„å˜é‡è¢«æ”¾å…¥äº†æš‚æ—¶æ€§æ­»åŒºï¼Œåœ¨ä½œç”¨åŸŸä¸­æœªåˆå§‹åŒ–é˜¶æ®µè®¿é—®ä¼šæŠ¥é”™ï¼š<br>ä»¥ä¸Š</p>]]></content>
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> javascript </category>
          
          <category> ES6 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> javascript </tag>
            
            <tag> ES6 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æµ®åŠ¨-å¡Œé™·é—®é¢˜</title>
      <link href="/blog/2018/09/24/%E6%B5%AE%E5%8A%A8-%E5%A1%8C%E9%99%B7%E9%97%AE%E9%A2%98/"/>
      <url>/blog/2018/09/24/%E6%B5%AE%E5%8A%A8-%E5%A1%8C%E9%99%B7%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<h1 id="ä¸€ç‚¹åºŸè¯"><a href="#ä¸€ç‚¹åºŸè¯" class="headerlink" title="ä¸€ç‚¹åºŸè¯"></a>ä¸€ç‚¹åºŸè¯</h1><p>æ˜¨æ™šå­¦ä¹ äº†è§£å†³æµ®åŠ¨å¸¦æ¥çš„çˆ¶å…ƒç´ é«˜åº¦å¡Œé™·çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ³•è¿˜æŒºå¤šï¼Œå°±åœ¨è¿™è®°å½•ä¸€ä¸‹åŠ æ·±ä¸‹å°è±¡ï¼Œä¹Ÿæ–¹ä¾¿åè¾¹çš„æŸ¥é˜…ï¼›è€è§„çŸ©ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œç›´å¥”ä¸»é¢˜;</p><h1 id="ä»€ä¹ˆæ˜¯é«˜åº¦å¡Œé™·"><a href="#ä»€ä¹ˆæ˜¯é«˜åº¦å¡Œé™·" class="headerlink" title="ä»€ä¹ˆæ˜¯é«˜åº¦å¡Œé™·"></a>ä»€ä¹ˆæ˜¯é«˜åº¦å¡Œé™·</h1><p>å¤§å®¶éƒ½çŸ¥é“å—çº§å…ƒç´ çš„é«˜åº¦ä¼šç”±å­å…ƒç´ æ’‘èµ·æ¥ï¼Œä½†æ˜¯å­å…ƒç´ ä¸€æ—¦æµ®åŠ¨ä»¥åï¼Œå—çº§å…ƒç´ çš„é«˜åº¦å°±æ²¡æœ‰äº†ï¼Œå°±åƒä¸‹å›¾è¿™æ ·ï¼š</p><figure class="image-box">                <img src="æœªæµ®åŠ¨.png" alt="[æœªæµ®åŠ¨]" title="" class="">                <p>[æœªæµ®åŠ¨]</p>            </figure><figure class="image-box">                <img src="æµ®åŠ¨.png" alt="[æµ®åŠ¨ä»¥å]" title="" class="">                <p>[æµ®åŠ¨ä»¥å]</p>            </figure><p>å…¶å®æœ€ç®€å•çš„è§£å†³æ–¹å¼å°±æ˜¯ç»™<strong>å—çº§å…ƒç´ ä¸€ä¸ªé«˜åº¦</strong>ï¼Œè®©å®ƒä¸ä¾èµ–å­å…ƒç´ çš„é«˜åº¦ï¼Œä½†æ˜¯åœ¨å®é™…åº”ç”¨å½“ä¸­ï¼Œæˆ‘ä»¬å¾ˆå°‘ä¼šç»™çˆ¶å…ƒç´ é«˜åº¦ï¼Œå› ä¸ºå­å…ƒç´ çš„å†…å®¹æ˜¯ä»åå°å–å‡ºæ¥çš„ï¼Œæœ‰å¤šå°‘å†…å®¹ä½ ä¹Ÿä¸çŸ¥é“ï¼Œè‡ªç„¶ä¸èƒ½ç»™æ˜ç¡®çš„é«˜åº¦ï¼›é‚£æ€ä¹ˆæ? ä¸æ€¥å¾€ä¸‹çœ‹ï¼›</p><h1 id="æ–¹å¼ä¸€-å¼€å¯çˆ¶å…ƒç´ BFC"><a href="#æ–¹å¼ä¸€-å¼€å¯çˆ¶å…ƒç´ BFC" class="headerlink" title="æ–¹å¼ä¸€:å¼€å¯çˆ¶å…ƒç´ BFC"></a>æ–¹å¼ä¸€:å¼€å¯çˆ¶å…ƒç´ BFC</h1><p>è‡³äºBFCçš„ä¸€äº›å…·ä½“æ¦‚å¿µï¼Œåœ¨è¿™ä¸åšé˜è¿°ï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ï¼Œæˆ‘æŠŠ <a href="https://juejin.im/post/59b73d5bf265da064618731d" target="_blank" rel="noopener">é“¾æ¥æ”¾è¿™</a>;</p><h2 id="å¼€å¯æ–¹å¼"><a href="#å¼€å¯æ–¹å¼" class="headerlink" title="å¼€å¯æ–¹å¼"></a>å¼€å¯æ–¹å¼</h2><ul><li>è®¾ç½®çˆ¶å…ƒç´ ä¸ºæµ®åŠ¨å…ƒç´ </li><li>è®¾ç½®çˆ¶å…ƒç´ ä¸ºç»å¯¹å®šä½</li><li>è®¾ç½®çˆ¶å…ƒç´ ä¸ºè¡Œå†…å—çº§å…ƒç´ (display: inline-block)</li><li>è®¾ç½®çˆ¶å…ƒç´ overflow: hidden</li></ul><p>å¦‚æœåªæ˜¯å•çº¯çš„æƒ³è¦å¼€å¯BFCï¼Œå‰ä¸‰ç§æ–¹å¼æœ‰ç‚¹æš´åŠ›ï¼Œæ‰€ä»¥å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€‰æ‹©<strong>ç¬¬å››ç§</strong></p><h2 id="å¼€å¯åçš„ç‰¹æ€§"><a href="#å¼€å¯åçš„ç‰¹æ€§" class="headerlink" title="å¼€å¯åçš„ç‰¹æ€§"></a>å¼€å¯åçš„ç‰¹æ€§</h2><ul><li>çˆ¶å…ƒç´ çš„å‚ç›´å¤–è¾¹è·ä¸ä¼šä¸å­å…ƒç´ çš„é‡å </li><li>ä¸ä¼šè¢«æµ®åŠ¨å…ƒç´ ç›–ä½</li><li>å¯ä»¥åŒ…å«æµ®åŠ¨å…ƒç´ </li></ul><p>æˆ‘ä»¬å°±æ˜¯åˆ©ç”¨<strong>ç¬¬ä¸‰ç‚¹</strong>æ¥è§£å†³é«˜åº¦å¡Œé™·é—®é¢˜</p><h1 id="æ–¹å¼äºŒ-åœ¨å¡Œé™·çš„çˆ¶å…ƒç´ çš„æœ€åæ·»åŠ ä¸€ä¸ªç©ºç™½çš„divï¼Œç„¶åå¯¹è¯¥divè¿›è¡Œæ¸…é™¤æµ®åŠ¨"><a href="#æ–¹å¼äºŒ-åœ¨å¡Œé™·çš„çˆ¶å…ƒç´ çš„æœ€åæ·»åŠ ä¸€ä¸ªç©ºç™½çš„divï¼Œç„¶åå¯¹è¯¥divè¿›è¡Œæ¸…é™¤æµ®åŠ¨" class="headerlink" title="æ–¹å¼äºŒ: åœ¨å¡Œé™·çš„çˆ¶å…ƒç´ çš„æœ€åæ·»åŠ ä¸€ä¸ªç©ºç™½çš„divï¼Œç„¶åå¯¹è¯¥divè¿›è¡Œæ¸…é™¤æµ®åŠ¨"></a>æ–¹å¼äºŒ: åœ¨å¡Œé™·çš„çˆ¶å…ƒç´ çš„æœ€åæ·»åŠ ä¸€ä¸ªç©ºç™½çš„divï¼Œç„¶åå¯¹è¯¥divè¿›è¡Œæ¸…é™¤æµ®åŠ¨</h1><p>åƒè¿™æ ·<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"box1"</span>&gt;</span><br><span class="line">&lt;div id=<span class="string">"box2"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;div id =<span class="string">'box3'</span> style=<span class="string">"clear:both"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure></p><p>ä¸ºä»€ä¹ˆè¿™æ ·å°±å¯ä»¥è§£å†³é—®é¢˜äº†å‘¢ï¼Œè¿™é‡Œæ¶‰åŠä¸€ä¸ªæ¸…é™¤æµ®åŠ¨çš„é—®é¢˜ï¼Œ<code>clear:both</code>,æ¸…é™¤æµ®åŠ¨å¯¹è¯¥å…ƒç´ çš„å½±å“ï¼Œæ¢å¥è¯è¯´ï¼šå‰ä¸€ä¸ªå…ƒç´ æµ®åŠ¨ä»¥åï¼Œå› ä¸ºæµ®åŠ¨å…ƒç´ è„±ç¦»äº†æ ‡å‡†æµï¼Œåè¾¹å…ƒç´ çš„ä½ç½®æ˜¯ä¼šå‘ç”Ÿå˜åŒ–çš„ï¼Œå¦‚æœä¸æƒ³å‘ç”Ÿå˜åŒ–ï¼Œå°±éœ€è¦ç»™åè¾¹çš„å…ƒç´ åŠ ä¸Šä¸€å¥ï¼š<code>clear:both</code>;<br>åº”ç”¨åˆ°æˆ‘ä»¬è¿™å‡ è¡Œä»£ç ä¸­å°±æ˜¯ï¼Œbox3çš„ä½ç½®ä¸ä¼šå› ä¸ºbox2çš„æµ®åŠ¨è€Œå˜åŒ–ï¼Œbox3ä¸€ç›´åœ¨åŸåœ°æ’‘ç€ï¼Œé‚£ä¹ˆbox1çš„é«˜åº¦ä¹Ÿä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚overï¼</p><h1 id="æ–¹å¼ä¸‰ï¼šä½¿ç”¨afterä¼ªç±»ï¼Œå‘çˆ¶å…ƒç´ åæ·»åŠ ä¸€ä¸ªå—å…ƒç´ ï¼Œå¹¶å¯¹å…¶æ¸…é™¤æµ®åŠ¨"><a href="#æ–¹å¼ä¸‰ï¼šä½¿ç”¨afterä¼ªç±»ï¼Œå‘çˆ¶å…ƒç´ åæ·»åŠ ä¸€ä¸ªå—å…ƒç´ ï¼Œå¹¶å¯¹å…¶æ¸…é™¤æµ®åŠ¨" class="headerlink" title="æ–¹å¼ä¸‰ï¼šä½¿ç”¨afterä¼ªç±»ï¼Œå‘çˆ¶å…ƒç´ åæ·»åŠ ä¸€ä¸ªå—å…ƒç´ ï¼Œå¹¶å¯¹å…¶æ¸…é™¤æµ®åŠ¨"></a>æ–¹å¼ä¸‰ï¼šä½¿ç”¨afterä¼ªç±»ï¼Œå‘çˆ¶å…ƒç´ åæ·»åŠ ä¸€ä¸ªå—å…ƒç´ ï¼Œå¹¶å¯¹å…¶æ¸…é™¤æµ®åŠ¨</h1><p>å¤§å®¶å¯èƒ½å‘ç°äº†ï¼Œæ–¹å¼äºŒçš„è§£å†³æ–¹æ³•å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºå®ƒå¹³ç™½æ— æ•…åœ¨box1é‡Œæ·»åŠ äº†ä¸€ä¸ªå¤šä½™æ ‡ç­¾ï¼Œæ–¹å¼ä¸‰å°±æ˜¯ä¸ºäº†è§£å†³æ‰æ–¹å¼äºŒå­˜åœ¨çš„é—®é¢˜ï¼ŒåŒæ—¶åˆèƒ½è§£å†³å¡Œé™·<br>cssä»£ç å¦‚ä¸‹<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.clearfix</span><span class="selector-pseudo">:after</span>&#123;</span><br><span class="line"><span class="attribute">content</span>:<span class="string">""</span>;</span><br><span class="line"><span class="attribute">display</span>:block;</span><br><span class="line"><span class="attribute">clear</span>:both;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>htmlä»£ç å¦‚ä¸‹<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box1"</span> <span class="attr">class</span> = <span class="string">'clearfix'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"box2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><strong>æ–¹å¼äºŒå’Œæ–¹å¼ä¸‰çš„è§£å†³åŠæ³•æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯åœ¨å­å…ƒç´ åè¾¹æ·»åŠ ä¸€äº›å†…å®¹ï¼Œå¹¶å¯¹è¿™äº›å†…å®¹æ¸…é™¤æµ®åŠ¨ï¼Œä½†æ˜¯æ–¹å¼ä¸‰ç›¸æ¯”æ–¹å¼äºŒä¸éœ€è¦æ·»åŠ å¤šä½™çš„ç»“æ„</strong></p><p>ä»¥ä¸Š</p>]]></content>
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> CSS </category>
          
          <category> æµ®åŠ¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> CSS </tag>
            
            <tag> æµ®åŠ¨ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CSSå¸¸è§å¸ƒå±€æ–¹å¼(äºŒ)</title>
      <link href="/blog/2018/09/03/CSS%E5%B8%B8%E8%A7%81%E5%B8%83%E5%B1%80%E6%96%B9%E5%BC%8F-%E4%BA%8C/"/>
      <url>/blog/2018/09/03/CSS%E5%B8%B8%E8%A7%81%E5%B8%83%E5%B1%80%E6%96%B9%E5%BC%8F-%E4%BA%8C/</url>
      <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¿™ç¯‡æ–‡ç« è®°å½•ä¸‹<code>åœ£æ¯å¸ƒå±€</code>å’Œ<code>åŒé£ç¿¼å¸ƒå±€</code>ï¼Œä¸¤ç§å¸ƒå±€è¾¾åˆ°æ•ˆæœä¸ŠåŸºæœ¬ç›¸åŒï¼Œéƒ½æ˜¯ä¸¤è¾¹ä¸¤æ å®½åº¦å›ºå®šï¼Œä¸­é—´æ å®½åº¦è‡ªé€‚åº”ã€‚åœ¨HTMLç»“æ„ä¸Šä¸­é—´æ åœ¨æœ€å‰é¢ä¿è¯äº†æœ€å…ˆæ¸²æŸ“ä¸­é—´æå‡æ€§èƒ½ï¼›</p><h1 id="åœ£æ¯å¸ƒå±€çš„å®ç°"><a href="#åœ£æ¯å¸ƒå±€çš„å®ç°" class="headerlink" title="åœ£æ¯å¸ƒå±€çš„å®ç°"></a>åœ£æ¯å¸ƒå±€çš„å®ç°</h1><p>åœ£æ¯å¸ƒå±€çš„å…³é”®åœ¨äºè®©ä¸­é—´æ çš„å®½åº¦å¯ä»¥è‡ªé€‚åº”ï¼Œæƒ³è¦é€‚åº”æµè§ˆå™¨å®½åº¦çš„å˜åŒ–ï¼Œç”¨ç™¾åˆ†æ¯”æ¥è®¾ç½®ä¸­é—´æ çš„å®½åº¦æœ€åˆé€‚ä¸è¿‡äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†ä¸­é—´éƒ¨åˆ†çš„å®½åº¦è®¾ç½®ä¸º<strong>100%</strong>ï¼ŒåŒæ—¶éœ€è¦å·¦å³ä¸¤æ ç´§é æµè§ˆå™¨ä¸¤ç«¯ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œä¸Šä»£ç <br>æ—¢ç„¶æ˜¯ä¸‰æ å¸ƒå±€ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ä¸‰ä¸ªç›’å­ï¼Œå¤–åŠ ç»™å®ƒå¥—ä¸ªå®¹å™¨</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"middle"</span>&gt;</span>æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•æˆ‘æ˜¯æµ‹è¯•<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span>æˆ‘æ˜¯left<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span>æˆ‘æ˜¯right<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç»™å®ƒæ·»åŠ å¦‚ä¸‹çš„CSSæ ·å¼</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.left</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#000</span>;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">200px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: seagreen;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#000</span>;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">200px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.middle</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: steelblue;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›®å‰æ˜¯è¿™ä¸ªé€¼æ ·ğŸ‘‡</p><figure class="image-box">                <img src="1.png" alt="" title="" class="">                <p></p>            </figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠè¿™ä»¨å“¥ä»¬æ”¾åˆ°åŒä¸€è¡Œï¼Œè¿™éœ€è¦åˆ©ç”¨<strong>è´Ÿmargin</strong>çš„æŠ€å·§ï¼šæˆ‘ä»¬ç»™leftå’Œrightçš„CSSæ ·å¼åšå¦‚ä¸‹ä¿®æ”¹ï¼š<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.left</span>&#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: -<span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span>&#123;</span><br><span class="line">    <span class="attribute">margin-left</span>: -<span class="number">200px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç°åœ¨å¸ƒå±€å˜æˆè¿™æ ·ğŸ‘‡<br><figure class="image-box">                <img src="2.png" alt="" title="" class="">                <p></p>            </figure></p><p>æ­¤æ—¶ä¸­é—´éƒ¨åˆ†çš„å†…å®¹æ˜¯ç›–ä½çš„ï¼Œä¸ºäº†å†…å®¹ä¸è¢«ç›–ä½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™çˆ¶ç›’å­è®¾ç½®<code>padding</code>çš„æ–¹å¼æ¥è®©ä¸­é—´çš„å†…å®¹åªæ˜¾ç¤ºåœ¨ä¸­é—´ï¼›åŒæ—¶ä¸ºäº†ä¸¤è¾¹çš„ç›’å­ä½ç½®ä¸å˜ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ å¦‚ä¸‹çš„CSSæ ·å¼ä»£ç <br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.left</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>:relative;</span><br><span class="line">    <span class="attribute">left</span>:-<span class="number">200px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>:relative;</span><br><span class="line">    <span class="attribute">right</span>:-<span class="number">200px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">200px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç°åœ¨æ˜¯æœ€ç»ˆå¸ƒå±€ï¼šğŸ‘‡<br><figure class="image-box">                <img src="3.png" alt="" title="" class="">                <p></p>            </figure><br>è¯•ç€å‹ç¼©æµè§ˆå™¨å®½åº¦åï¼šğŸ‘‡<br><figure class="image-box">                <img src="4.png" alt="" title="" class="">                <p></p>            </figure></p><h1 id="åŒé£ç¿¼å¸ƒå±€"><a href="#åŒé£ç¿¼å¸ƒå±€" class="headerlink" title="åŒé£ç¿¼å¸ƒå±€"></a>åŒé£ç¿¼å¸ƒå±€</h1><p>å…¶å®åŒé£ç¿¼å¸ƒå±€æ˜¯ä¸ºäº†è§£å†³åœ£æ¯å¸ƒå±€çš„å¼Šç«¯æå‡ºçš„ï¼Œä¸Šé¢çš„åœ£æ¯å¸ƒå±€çš„ä»£ç å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå½“ä½ å°†æµè§ˆå™¨å®½åº¦ç¼©çŸ­åˆ°ä¸€å®šç¨‹åº¦ï¼Œä½¿å¾—ä¸­é—´å­å…ƒç´ çš„å®½åº¦æ¯”å·¦å³å­å…ƒç´ å®½åº¦å°çš„æ—¶å€™ï¼Œè¿™æ—¶å€™å¸ƒå±€å°±ä¼šå‡ºç°é—®é¢˜ã€‚æ‰€ä»¥é¦–å…ˆï¼Œè¿™æç¤ºäº†æˆ‘ä»¬åœ¨ä½¿ç”¨åœ£æ¯å¸ƒå±€çš„æ—¶å€™ä¸€å®šè¦è®¾ç½®æ•´ä¸ªå®¹å™¨çš„æœ€å°å®½åº¦ã€‚</p><figure class="image-box">                <img src="5.png" alt="" title="" class="">                <p></p>            </figure><h1 id="åŒé£ç¿¼å¸ƒå±€å’Œåœ£æ¯å¸ƒå±€çš„åŒºåˆ«"><a href="#åŒé£ç¿¼å¸ƒå±€å’Œåœ£æ¯å¸ƒå±€çš„åŒºåˆ«" class="headerlink" title="åŒé£ç¿¼å¸ƒå±€å’Œåœ£æ¯å¸ƒå±€çš„åŒºåˆ«"></a>åŒé£ç¿¼å¸ƒå±€å’Œåœ£æ¯å¸ƒå±€çš„åŒºåˆ«</h1><blockquote><p>åœ£æ¯å¸ƒå±€å’ŒåŒé£ç¿¼å¸ƒå±€è§£å†³é—®é¢˜çš„æ–¹æ¡ˆåœ¨å‰ä¸€åŠæ˜¯ç›¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯ä¸‰æ å…¨éƒ¨floatæµ®åŠ¨ï¼Œä½†å·¦å³ä¸¤æ åŠ ä¸Šè´Ÿmarginè®©å…¶è·Ÿä¸­é—´æ divå¹¶æ’ï¼Œä»¥å½¢æˆä¸‰æ å¸ƒå±€ã€‚<br>ä¸åŒåœ¨äºè§£å†³â€ä¸­é—´æ divå†…å®¹ä¸è¢«é®æŒ¡â€œé—®é¢˜çš„æ€è·¯ä¸ä¸€æ ·ï¼šåœ£æ¯å¸ƒå±€ï¼Œä¸ºäº†ä¸­é—´divå†…å®¹ä¸è¢«é®æŒ¡ï¼Œå°†ä¸­é—´divè®¾ç½®äº†å·¦å³padding-leftå’Œpadding-rightåï¼Œå°†å·¦å³ &gt; ä¸¤ä¸ªdivç”¨ç›¸å¯¹å¸ƒå±€position: relativeå¹¶åˆ†åˆ«é…åˆrightå’Œleftå±æ€§ï¼Œä»¥ä¾¿å·¦å³ä¸¤æ divç§»åŠ¨åä¸é®æŒ¡ä¸­é—´divã€‚<br>åŒé£ç¿¼å¸ƒå±€ï¼Œä¸ºäº†ä¸­é—´divå†…å®¹ä¸è¢«é®æŒ¡ï¼Œç›´æ¥åœ¨ä¸­é—´divå†…éƒ¨åˆ›å»ºå­divç”¨äºæ”¾ç½®å†…å®¹ï¼Œåœ¨è¯¥å­divé‡Œç”¨margin-leftå’Œmargin-rightä¸ºå·¦å³ä¸¤æ divç•™å‡ºä½ç½®ã€‚</p></blockquote><figure class="image-box">                <img src="6.png" alt="" title="" class="">                <p></p>            </figure>]]></content>
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> CSS </tag>
            
            <tag> åœ£æ¯å¸ƒå±€ </tag>
            
            <tag> åŒé£ç¿¼å¸ƒå±€ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CSSå¸¸è§å¸ƒå±€æ–¹å¼(ä¸€)</title>
      <link href="/blog/2018/09/02/CSS%E5%B8%B8%E8%A7%81%E5%B8%83%E5%B1%80%E6%96%B9%E5%BC%8F/"/>
      <url>/blog/2018/09/02/CSS%E5%B8%B8%E8%A7%81%E5%B8%83%E5%B1%80%E6%96%B9%E5%BC%8F/</url>
      <content type="html"><![CDATA[<h1 id="flexå¸ƒå±€"><a href="#flexå¸ƒå±€" class="headerlink" title="flexå¸ƒå±€"></a>flexå¸ƒå±€</h1><p>å¸ƒå±€çš„ä¼ ç»Ÿè§£å†³æ–¹æ¡ˆï¼ŒåŸºäºç›’çŠ¶æ¨¡å‹ï¼Œä¾èµ– <code>display</code>å±æ€§ + <code>position</code>å±æ€§ + <code>float</code>å±æ€§ã€‚å®ƒå¯¹äºé‚£äº›ç‰¹æ®Šå¸ƒå±€éå¸¸ä¸æ–¹ä¾¿ï¼Œæ¯”å¦‚ï¼Œå‚ç›´å±…ä¸­å°±ä¸å®¹æ˜“å®ç°ã€‚äºæ˜¯W3Cæå‡ºäº†ä¸€ç§æ–°çš„æ–¹æ¡ˆâ€”-Flexå¸ƒå±€ï¼Œå¯ä»¥ç®€ä¾¿ã€å®Œæ•´ã€å“åº”å¼åœ°å®ç°å„ç§é¡µé¢å¸ƒå±€ã€‚ç›®å‰ï¼Œå®ƒå·²ç»å¾—åˆ°äº†æ‰€æœ‰æµè§ˆå™¨çš„æ”¯æŒï¼Œè¿™æ„å‘³ç€ï¼Œç°åœ¨å°±èƒ½å¾ˆå®‰å…¨åœ°ä½¿ç”¨è¿™é¡¹åŠŸèƒ½ã€‚<br><a id="more"></a></p><figure class="image-box">                <img src="1.png" alt="" title="" class="">                <p></p>            </figure><h2 id="ä»€ä¹ˆæ˜¯flexå¸ƒå±€"><a href="#ä»€ä¹ˆæ˜¯flexå¸ƒå±€" class="headerlink" title="ä»€ä¹ˆæ˜¯flexå¸ƒå±€"></a>ä»€ä¹ˆæ˜¯flexå¸ƒå±€</h2><p>Flex æ˜¯ Flexible Box çš„ç¼©å†™ï¼Œæ„ä¸ºâ€å¼¹æ€§å¸ƒå±€â€ï¼Œç”¨æ¥ä¸ºç›’çŠ¶æ¨¡å‹æä¾›æœ€å¤§çš„çµæ´»æ€§ã€‚flex æ˜¯ä¸€ç§æ–°å‹çš„å¸ƒå±€æ–¹å¼ï¼Œä½¿ç”¨è¯¥å¸ƒå±€æ–¹å¼å¯ä»¥å®ç°å‡ ä¹æ‰€æœ‰ä½ æƒ³è¦çš„æ•ˆæœã€‚</p><h2 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h2><p>flexçš„ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œåªéœ€è¦å°†å…¶ display å±æ€§è®¾ç½®ä¸º flex å°±å¯ä»¥ï¼Œä¹Ÿå¯ä»¥è®¾ç½®è¡Œå†…çš„ flexã€‚<strong>æ³¨æ„ï¼Œè®¾ä¸º Flex å¸ƒå±€ä»¥åï¼Œå­å…ƒç´ çš„ floatã€clear å’Œ vertical-align å±æ€§å°†å¤±æ•ˆã€‚</strong></p><h2 id="ç¢ç¢çš„æ¦‚å¿µ"><a href="#ç¢ç¢çš„æ¦‚å¿µ" class="headerlink" title="ç¢ç¢çš„æ¦‚å¿µ"></a>ç¢ç¢çš„æ¦‚å¿µ</h2><p>é‡‡ç”¨Flexå¸ƒå±€çš„å…ƒç´ ï¼Œç§°ä¸ºFlexå®¹å™¨ï¼ˆflex containerï¼‰ï¼Œç®€ç§°â€å®¹å™¨â€ã€‚å®ƒçš„æ‰€æœ‰å­å…ƒç´ è‡ªåŠ¨æˆä¸ºå®¹å™¨æˆå‘˜ï¼Œç§°ä¸ºFlexé¡¹ç›®ï¼ˆflex itemï¼‰ï¼Œç®€ç§°â€é¡¹ç›®â€ã€‚</p><figure class="image-box">                <img src="2.png" alt="[]" title="" class="">                <p>[]</p>            </figure><blockquote><p>å®¹å™¨é»˜è®¤å­˜åœ¨ä¸¤æ ¹è½´ï¼šæ°´å¹³çš„ä¸»è½´ï¼ˆmain axisï¼‰å’Œå‚ç›´çš„äº¤å‰è½´ï¼ˆcross axisï¼‰ã€‚ä¸»è½´çš„å¼€å§‹ä½ç½®ï¼ˆä¸è¾¹æ¡†çš„äº¤å‰ç‚¹ï¼‰å«åšmain startï¼Œç»“æŸä½ç½®å«åšmain endï¼›äº¤&gt;å‰è½´çš„å¼€å§‹ä½ç½®å«åšcross startï¼Œç»“æŸä½ç½®å«åšcross endã€‚<br>é¡¹ç›®é»˜è®¤æ²¿ä¸»è½´æ’åˆ—ã€‚å•ä¸ªé¡¹ç›®å æ®çš„ä¸»è½´ç©ºé—´å«åšmain sizeï¼Œå æ®çš„äº¤å‰è½´ç©ºé—´å«åšcross sizeã€‚</p></blockquote><h2 id="çˆ¶å®¹å™¨å±æ€§"><a href="#çˆ¶å®¹å™¨å±æ€§" class="headerlink" title="çˆ¶å®¹å™¨å±æ€§"></a>çˆ¶å®¹å™¨å±æ€§</h2><p>çˆ¶å®¹å™¨ä¸Šæœ‰å…­ä¸ªå±æ€§ï¼š</p><ul><li>flex-directionï¼šä¸»è½´çš„æ–¹å‘ï¼ˆé»˜è®¤æ°´å¹³ï¼‰ã€‚</li><li>flex-wrapï¼šè¶…å‡ºçˆ¶å®¹å™¨å­å®¹å™¨çš„æ’åˆ—æ ·å¼ã€‚</li><li>flex-flowï¼šflex-direction å±æ€§å’Œ flex-wrap å±æ€§çš„ç®€å†™å½¢å¼ã€‚</li><li>justify-contentï¼šå­å®¹å™¨åœ¨ä¸»è½´çš„æ’åˆ—æ–¹å‘ã€‚</li><li>align-itemsï¼šå­å®¹å™¨åœ¨äº¤å‰è½´çš„æ’åˆ—æ–¹å‘ã€‚</li><li>align-contentï¼šå¤šæ ¹è½´çº¿çš„å¯¹é½æ–¹å¼ã€‚</li></ul><h3 id="flex-direction-å±æ€§"><a href="#flex-direction-å±æ€§" class="headerlink" title="flex-direction å±æ€§"></a>flex-direction å±æ€§</h3><p>è¿™ä¸ªå±æ€§æ˜¯ç”¨æ¥è®¾ç½®ä¸»è½´çš„æ–¹å‘çš„ï¼Œé»˜è®¤æ˜¯æ°´å¹³æ–¹å‘ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥è®¾ç½®å…¶ä»–æ–¹å‘ï¼Œshow you the codeï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.box &#123;</span><br><span class="line">    flex-direction: row;                <span class="comment">// é»˜è®¤å€¼ï¼Œä¸»è½´ä¸ºæ°´å¹³æ–¹å‘ï¼Œèµ·ç‚¹åœ¨å·¦ç«¯ã€‚</span></span><br><span class="line">    flex-direction: row-reverse;        <span class="comment">// ä¸»è½´ä¸ºæ°´å¹³æ–¹å‘ï¼Œèµ·ç‚¹åœ¨å³ç«¯ã€‚</span></span><br><span class="line">    flex-direction: column;             <span class="comment">// ä¸»è½´ä¸ºå‚ç›´æ–¹å‘ï¼Œèµ·ç‚¹åœ¨ä¸Šã€‚</span></span><br><span class="line">    flex-direction: column-reverse;     <span class="comment">// ä¸»è½´ä¸ºå‚ç›´æ–¹å‘ï¼Œèµ·ç‚¹åœ¨ä¸‹ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="image-box">                <img src="3.png" alt="[]" title="" class="">                <p>[]</p>            </figure><h3 id="flex-wrap"><a href="#flex-wrap" class="headerlink" title="flex-wrap"></a>flex-wrap</h3><p><code>flex-wrap</code> å±æ€§å†³å®šå­å®¹å™¨å¦‚æœåœ¨ä¸€æ¡è½´çº¿æ’ä¸ä¸‹æ—¶ï¼Œå¦‚ä½•æ¢è¡Œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.box &#123;</span><br><span class="line">    flex-wrap: nowrap;          <span class="comment">// é»˜è®¤ï¼Œä¸æ¢è¡Œ</span></span><br><span class="line">    flex-wrap: wrap;            <span class="comment">// æ¢è¡Œï¼Œç¬¬ä¸€è¡Œåœ¨ä¸Šæ–¹ã€‚</span></span><br><span class="line">    flex-wrap: wrap-reverse     <span class="comment">// æ¢è¡Œï¼Œç¬¬ä¸€è¡Œåœ¨ä¸‹æ–¹ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="image-box">                <img src="4.png" alt="[flex-wrap:nowrap(å­ç›’å­å®½åº¦è¢«æŒ¤å‹)]" title="" class="">                <p>[flex-wrap:nowrap(å­ç›’å­å®½åº¦è¢«æŒ¤å‹)]</p>            </figure><figure class="image-box">                <img src="5.png" alt="[flex-warp:warp]" title="" class="">                <p>[flex-warp:warp]</p>            </figure><figure class="image-box">                <img src="6.png" alt="[flex-warp:warp-reverse]" title="" class="">                <p>[flex-warp:warp-reverse]</p>            </figure><h3 id="flex-flow"><a href="#flex-flow" class="headerlink" title="flex-flow"></a>flex-flow</h3><p><code>flex-flow</code> å±æ€§æ˜¯ flex-direction å±æ€§å’Œ flex-wrap å±æ€§çš„ç®€å†™å½¢å¼ï¼Œé»˜è®¤å€¼ä¸º row nowrapã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.box &#123;</span><br><span class="line">  flex-flow: &lt;flex-direction&gt; || &lt;flex-wrap&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="justify-content"><a href="#justify-content" class="headerlink" title="justify-content"></a>justify-content</h3><p><code>justify-content</code> å±æ€§å®šä¹‰äº†å­å®¹å™¨åœ¨ä¸»è½´ä¸Šçš„å¯¹é½æ–¹å¼ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.box&#123;</span><br><span class="line">    justify-content: flex-start;      <span class="comment">// é»˜è®¤ï¼Œå·¦å¯¹é½</span></span><br><span class="line">    justify-content: flex-end;        <span class="comment">// å³å¯¹é½</span></span><br><span class="line">    justify-content: center;          <span class="comment">// å±…ä¸­</span></span><br><span class="line">    justify-content: space-between;   <span class="comment">// ä¸¤ç«¯å¯¹é½ï¼Œé¡¹ç›®ä¹‹é—´çš„é—´éš”éƒ½ç›¸ç­‰ã€‚</span></span><br><span class="line">    justify-content: space-around;    <span class="comment">// æ¯ä¸ªé¡¹ç›®ä¸¤ä¾§çš„é—´éš”ç›¸ç­‰ã€‚æ‰€ä»¥ï¼Œé¡¹ç›®ä¹‹é—´çš„é—´éš”æ¯”é¡¹ç›®ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€ã€‚</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <img src="7.png" alt=""></p><h3 id="align-items"><a href="#align-items" class="headerlink" title="align-items"></a>align-items</h3><p><code>align-items</code>å±æ€§å®šä¹‰å­å®¹å™¨åœ¨äº¤å‰è½´ä¸Šå¦‚ä½•å¯¹é½ã€‚è€è§„çŸ©ï¼Œshow you the code;<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.box&#123;</span><br><span class="line">    align-items: flex-start;    <span class="comment">// äº¤å‰è½´çš„èµ·ç‚¹å¯¹é½ã€‚</span></span><br><span class="line">    align-items: flex-end;      <span class="comment">// äº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½ã€‚</span></span><br><span class="line">    align-items: center;        <span class="comment">// äº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½ã€‚</span></span><br><span class="line">    align-items: baseline;      <span class="comment">// é¡¹ç›®çš„ç¬¬ä¸€è¡Œæ–‡å­—çš„åŸºçº¿å¯¹é½ã€‚</span></span><br><span class="line">    align-items: stretch;       <span class="comment">// é»˜è®¤ï¼Œå¦‚æœé¡¹ç›®æœªè®¾ç½®é«˜åº¦æˆ–è®¾ä¸ºautoï¼Œå°†å æ»¡æ•´ä¸ªå®¹å™¨çš„é«˜åº¦ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="image-box">                <img src="8.png" alt="" title="" class="">                <p></p>            </figure><h3 id="align-content"><a href="#align-content" class="headerlink" title="align-content"></a>align-content</h3><p><code>align-content</code> å±æ€§å®šä¹‰äº†å¤šæ ¹è½´çº¿çš„å¯¹é½æ–¹å¼ã€‚å¦‚æœé¡¹ç›®åªæœ‰ä¸€æ ¹è½´çº¿ï¼Œè¯¥å±æ€§ä¸èµ·ä½œç”¨ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.box&#123;</span><br><span class="line">    align-content: flex-start;   <span class="comment">// ä¸äº¤å‰è½´çš„èµ·ç‚¹å¯¹é½</span></span><br><span class="line">    align-content; flex-end;     <span class="comment">// ä¸äº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½ã€‚</span></span><br><span class="line">    align-content: center;       <span class="comment">// ä¸äº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½ã€‚</span></span><br><span class="line">    align-content: space-between;<span class="comment">// ä¸äº¤å‰è½´ä¸¤ç«¯å¯¹é½ï¼Œè½´çº¿ä¹‹é—´çš„é—´éš”å¹³å‡åˆ†å¸ƒã€‚</span></span><br><span class="line">    align-content: space-around; <span class="comment">// æ¯æ ¹è½´çº¿ä¸¤ä¾§çš„é—´éš”éƒ½ç›¸ç­‰ã€‚æ‰€ä»¥ï¼Œè½´çº¿ä¹‹é—´çš„é—´éš”æ¯”è½´çº¿ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€ã€‚</span></span><br><span class="line">    align-content: stretch;     <span class="comment">// é»˜è®¤ è½´çº¿å æ»¡æ•´ä¸ªäº¤å‰è½´ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="image-box">                <img src="9.png" alt="[æ­¤å›¾å‡ºè‡ªèœé¸Ÿæ•™ç¨‹]" title="" class="">                <p>[æ­¤å›¾å‡ºè‡ªèœé¸Ÿæ•™ç¨‹]</p>            </figure><h2 id="å­å®¹å™¨å±æ€§"><a href="#å­å®¹å™¨å±æ€§" class="headerlink" title="å­å®¹å™¨å±æ€§"></a>å­å®¹å™¨å±æ€§</h2><p>å­å®¹å™¨ä¹Ÿæœ‰ 6 ä¸ªå±æ€§ï¼š</p><ul><li>orderï¼šå­å®¹å™¨çš„æ’åˆ—é¡ºåº</li><li>flex-growï¼šå­å®¹å™¨å‰©ä½™ç©ºé—´çš„æ‹‰ä¼¸æ¯”ä¾‹</li><li>flex-shrinkï¼šå­å®¹å™¨è¶…å‡ºç©ºé—´çš„å‹ç¼©æ¯”ä¾‹</li><li>flex-basisï¼šå­å®¹å™¨åœ¨ä¸ä¼¸ç¼©æƒ…å†µä¸‹çš„åŸå§‹å°ºå¯¸</li><li>flexï¼šå­å…ƒç´ çš„ flex å±æ€§æ˜¯ flex-grow,flex-shrink å’Œ  flex-basis çš„ç®€å†™</li><li>align-self å…è®¸å•ä¸ªé¡¹ç›®æœ‰ä¸å…¶ä»–é¡¹ç›®ä¸ä¸€æ ·çš„å¯¹é½æ–¹å¼</li></ul><h3 id="order"><a href="#order" class="headerlink" title="order"></a>order</h3><p><code>order</code> å±æ€§å®šä¹‰é¡¹ç›®çš„æ’åˆ—é¡ºåºã€‚æ•°å€¼è¶Šå°ï¼Œæ’åˆ—è¶Šé å‰ï¼Œé»˜è®¤ä¸º 0ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.box&#123;</span><br><span class="line">   order: num; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="image-box">                <img src="10.png" alt="" title="" class="">                <p></p>            </figure><h3 id="flex-grow"><a href="#flex-grow" class="headerlink" title="flex-grow"></a>flex-grow</h3><p><code>flex-grow</code> å±æ€§å®šä¹‰å­å®¹å™¨çš„ä¼¸ç¼©æ¯”ä¾‹ã€‚æŒ‰ç…§è¯¥æ¯”ä¾‹ç»™å­å®¹å™¨åˆ†é…ç©ºé—´ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.box&#123;</span><br><span class="line">    flex-grow: num; <span class="comment">//é»˜è®¤ä¸ºé›¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="image-box">                <img src="11.png" alt="" title="" class="">                <p></p>            </figure><figure class="image-box">                <img src="12.png" alt="" title="" class="">                <p></p>            </figure><h3 id="flex-shrink"><a href="#flex-shrink" class="headerlink" title="flex-shrink"></a>flex-shrink</h3><p><code>flex-shrink</code>å±æ€§å®šä¹‰äº†é¡¹ç›®çš„ç¼©å°æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º1ï¼Œå³å¦‚æœç©ºé—´ä¸è¶³ï¼Œè¯¥é¡¹ç›®å°†ç¼©å°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.box &#123;</span><br><span class="line">    flex-shrink: num; <span class="comment">// default 1 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="image-box">                <img src="13.png" alt="[ä¸è®¾ç½®çš„æƒ…å†µä¸‹]" title="" class="">                <p>[ä¸è®¾ç½®çš„æƒ…å†µä¸‹]</p>            </figure><figure class="image-box">                <img src="14.png" alt="[æŠŠç¬¬äºŒä¸ªå­ç›’å­çš„flex-shrinkè®¾ç½®ä¸º0]" title="" class="">                <p>[æŠŠç¬¬äºŒä¸ªå­ç›’å­çš„flex-shrinkè®¾ç½®ä¸º0]</p>            </figure><h3 id="flex-basis"><a href="#flex-basis" class="headerlink" title="flex-basis"></a>flex-basis</h3><p><code>flex-basis</code>å±æ€§å®šä¹‰äº†å­å®¹å™¨åœ¨ä¸ä¼¸ç¼©æƒ…å†µä¸‹çš„åŸå§‹å°ºå¯¸ï¼Œä¸»è½´ä¸ºæ¨ªå‘æ—¶ä»£è¡¨å®½åº¦ï¼Œä¸»è½´ä¸ºçºµå‘æ—¶ä»£è¡¨é«˜åº¦ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.box&#123;</span><br><span class="line">    flex-basis: <span class="xml"><span class="tag">&lt;<span class="name">length</span>&gt;</span> | auto; /* default auto */</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><figure class="image-box">                <img src="15.png" alt="[]" title="" class="">                <p>[]</p>            </figure><h3 id="flex"><a href="#flex" class="headerlink" title="flex"></a>flex</h3><p>å­å…ƒç´ çš„ <code>flex</code> å±æ€§æ˜¯ <code>flex-grow</code>,<code>flex-shrink</code> å’Œ <code>flex-basis</code> çš„ç®€å†™ï¼Œé»˜è®¤å€¼ä¸º 0 1 autoã€‚åä¸¤ä¸ªå±æ€§å¯é€‰ã€‚</p><p>è¯¥å±æ€§æœ‰ä¸¤ä¸ªå¿«æ·å€¼ï¼šauto (1 1 auto) å’Œ none (0 0 auto)ã€‚</p><h3 id="align-self"><a href="#align-self" class="headerlink" title="align-self"></a>align-self</h3><p>å­å®¹å™¨çš„<code>align-self</code>å±æ€§å…è®¸å•ä¸ªé¡¹ç›®æœ‰ä¸å…¶ä»–é¡¹ç›®ä¸ä¸€æ ·çš„å¯¹é½æ–¹å¼ï¼Œå¯è¦†ç›–çˆ¶å®¹å™¨ <code>align-items</code>å±æ€§ã€‚é»˜è®¤å€¼ä¸º autoï¼Œè¡¨ç¤ºç»§æ‰¿çˆ¶å…ƒç´ çš„ align-itemså±æ€§ï¼Œå¦‚æœæ²¡æœ‰çˆ¶å…ƒç´ ï¼Œåˆ™ç­‰åŒäº stretchã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.box&#123;</span><br><span class="line">    align-self: auto;             <span class="comment">// ç»§æ‰¿çˆ¶å…ƒç´ çš„ align-items å±æ€§</span></span><br><span class="line">    align-self: flex-start;       <span class="comment">// äº¤å‰è½´çš„èµ·ç‚¹å¯¹é½ã€‚</span></span><br><span class="line">    align-self: flex-end;         <span class="comment">// äº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½ã€‚</span></span><br><span class="line">    align-self: center;           <span class="comment">// äº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½ã€‚</span></span><br><span class="line">    align-self: baseline;         <span class="comment">// é¡¹ç›®çš„ç¬¬ä¸€è¡Œæ–‡å­—çš„åŸºçº¿å¯¹é½ã€‚</span></span><br><span class="line">    align-self: stretch;          <span class="comment">// é»˜è®¤ï¼Œå¦‚æœé¡¹ç›®æœªè®¾ç½®é«˜åº¦æˆ–è®¾ä¸ºautoï¼Œå°†å æ»¡æ•´ä¸ªå®¹å™¨çš„é«˜åº¦ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> CSS </tag>
            
            <tag> flexå¼¹æ€§å¸ƒå±€ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title> jsç‰¹æ•ˆä¹‹ç€‘å¸ƒæµ</title>
      <link href="/blog/2018/08/24/js%E7%89%B9%E6%95%88%E4%B9%8B%E7%80%91%E5%B8%83%E6%B5%81/"/>
      <url>/blog/2018/08/24/js%E7%89%B9%E6%95%88%E4%B9%8B%E7%80%91%E5%B8%83%E6%B5%81/</url>
      <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>jsä¸­çš„ç‰¹æ•ˆéƒ¨åˆ†çœŸçš„æŒºæœ‰æ„æ€ï¼Œä¸éœ€è¦ç¯‡å¹…è¿‡é•¿çš„ä»£ç å°±å¯ä»¥å†™å‡ºä¸€ä¸ªå°ç©æ„å„¿æ¥è·å¾—å†…å¿ƒå¾—ä¸€ç‚¹ç‚¹æˆå°±æ„Ÿï¼Œè€Œä¸”è¿˜å¯ä»¥åŠ å…¥ä¸€äº›è‡ªå·±çš„æƒ³æ³•å’Œè®¾è®¡ï¼Œè¿™ç¯‡æ–‡ç« è®°å½•ä¸‹æˆ‘å°è£…çš„å®ç°ç€‘å¸ƒæµçš„æ–¹æ³•</p><h1 id="ä½•ä¸ºç€‘å¸ƒæµ"><a href="#ä½•ä¸ºç€‘å¸ƒæµ" class="headerlink" title="ä½•ä¸ºç€‘å¸ƒæµ"></a>ä½•ä¸ºç€‘å¸ƒæµ</h1><p>è¯´ç™½äº†å°±æ˜¯ä¸€å †ç…§ç‰‡çš„æ’åˆ—ï¼Œä½†è¿™äº›ç…§ç‰‡çš„æ’åˆ—æ˜¯æœ‰ä¸€å®šè§„åˆ™çš„ï¼Œè¯­è¨€è¡¨è¾¾èƒ½åŠ›å·®ï¼Œshow you the picture:</p><figure class="image-box">                <img src="1.png" alt="" title="" class="">                <p></p>            </figure><p>so,can you see that? æˆ‘éƒ½çœ‹å‡ºç‰¹ç‚¹äº†ï¼Œå„ä½ä¸€å®šä¹Ÿèƒ½çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹è¿™äº›å›¾ç‰‡çš„<code>è§„å¾‹</code>ï¼š</p><ul><li><strong>å®½åº¦ç›¸åŒ</strong></li><li><strong>é«˜åº¦ä¸åŒ</strong></li><li><strong>æ’åˆ—ç‰¹åˆ«æ•´é½</strong></li></ul><h1 id="å®ç°é€»è¾‘"><a href="#å®ç°é€»è¾‘" class="headerlink" title="å®ç°é€»è¾‘"></a>å®ç°é€»è¾‘</h1><p>ç€‘å¸ƒæµæ•ˆæœçš„å®ç°é€»è¾‘éå¸¸ç®€å•ï¼Œæˆ‘å¤§è‡´ç»™å®ƒåˆ†ä¸ºå¦‚ä¸‹å‡ ç‚¹ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">é¦–å…ˆæˆ‘ä»¬å…ˆå‡†å¤‡ä¸€ä¸ªçˆ¶å…ƒç´ boxï¼Œç»™å®ƒè®¾ç½®å®½åº¦é«˜åº¦ç„¶åå°†å…¶å±…ä¸­ï¼Œæˆ‘ä»¬çš„æ‰€æœ‰ç…§ç‰‡å°±åœ¨è¿™ä¸ªboxä¸­ä¹–ä¹–æ’åˆ—</span><br><span class="line">ç¬¬ä¸€æ­¥ï¼š è®¡ç®—ä¸€è¡Œæ”¾å¤šå°‘å¼ ç…§ç‰‡</span><br><span class="line">ç¬¬äºŒæ­¥ï¼š éå†æ‰€æœ‰ç…§ç‰‡ï¼ŒæŠŠç¬¬ä¸€è¡Œç…§ç‰‡çš„é«˜åº¦å­˜å…¥ä¸€ä¸ªæ•°ç»„å½“ä¸­ </span><br><span class="line">ç¬¬ä¸‰æ­¥ï¼š æ±‚å‡ºç¬¬ä¸€è¡Œç…§ç‰‡çš„æœ€ä½é«˜åº¦ï¼ŒæŠŠä¸‹ä¸€å¼ æ”¾å®ƒå±è‚¡åé¢</span><br><span class="line">ç¬¬å››æ­¥ï¼š æ›´æ”¹æ•°ç»„ä¸­æœ€å°çš„é‚£ä¸€ä¸ªå€¼ä¸ºï¼šæœ€ä½é«˜åº¦+ç¬¬äºŒè¡Œç¬¬ä¸€å¼ ç…§ç‰‡çš„é«˜åº¦</span><br><span class="line">ç¬¬äº”æ­¥ï¼š é‡å¤ä¸‰å››æ­¥</span><br></pre></td></tr></table></figure></p><p>ä¸‹é¢<code>show the code</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waterFull</span> (<span class="params">parent,childrens</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> main = $(<span class="string">'.main'</span>);</span><br><span class="line">    <span class="comment">// è·å–å±å¹•å®½åº¦</span></span><br><span class="line">    <span class="keyword">let</span> clientWidth = <span class="built_in">document</span>.documentElement.clientWidth;</span><br><span class="line">    <span class="keyword">let</span> width  = childrens[<span class="number">0</span>].offsetWidth;</span><br><span class="line">    <span class="comment">// å±å¹•å®½åº¦é™¤ä»¥ä¸€ä¸ªå°ç›’å­çš„å®½åº¦ï¼Œç¡®å®šåˆ—æ•°</span></span><br><span class="line">    <span class="keyword">let</span> columns = <span class="built_in">parseInt</span>(clientWidth/childrens[<span class="number">0</span>].offsetWidth);</span><br><span class="line">    <span class="comment">// ç¡®å®šçˆ¶ç›’å­çš„å®½åº¦  ä¸€ä¸ªå­å…ƒç´ çš„å®½åº¦ä¹˜ä»¥åˆ—æ•°</span></span><br><span class="line">    main.style.width = columns*childrens[<span class="number">0</span>].offsetWidth + <span class="string">'px'</span>;</span><br><span class="line">    <span class="comment">// å­˜æ”¾ç¬¬ä¸€è¡Œå­å…ƒç´ çš„é«˜åº¦</span></span><br><span class="line">    <span class="keyword">let</span> arr = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;childrens.length;i++)&#123; </span><br><span class="line">        <span class="keyword">if</span>(i&lt;columns)&#123;</span><br><span class="line">            arr.push(childrens[i].offsetHeight);</span><br><span class="line">            <span class="comment">// ç¬¬ä¸€æ’ä¸éœ€è¦æ·»åŠ ç»å¯¹å®šä½ é€šè¿‡box1ç±»æ¥æ§åˆ¶å®šä½</span></span><br><span class="line">            childrens[i].classList.remove(<span class="string">'box1'</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// é™¤äº†ç¬¬ä¸€æ’ï¼Œå…¶ä»–çš„éƒ½éœ€è¦ç»å¯¹å®šä½</span></span><br><span class="line">            childrens[i].classList.add(<span class="string">'box1'</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ‰¾å‡ºæœ€å°æ•°ç»„ä¸­çš„æœ€å°é«˜åº¦</span></span><br><span class="line">            <span class="keyword">let</span> minHeight = <span class="built_in">Math</span>.min(...arr);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> minIndex = <span class="number">0</span>;</span><br><span class="line">            <span class="comment">// æ‰¾å‡ºæœ€å°é«˜åº¦åœ¨æ•°ç»„ä¸­å¯¹åº”çš„index</span></span><br><span class="line">            minIndex =  arr.findIndex(<span class="function">(<span class="params">value,index</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> value == minHeight;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å°†å›¾ç‰‡æ”¾åˆ°æœ€å°é«˜åº¦çš„å›¾ç‰‡å±è‚¡åè¾¹</span></span><br><span class="line">            childrens[i].style.left = minIndex*width + <span class="string">'px'</span>;</span><br><span class="line">            childrens[i].style.top = minHeight + <span class="string">'px'</span>;</span><br><span class="line">            <span class="comment">// æ›´æ–°æ•°ç»„ä¸­å­˜æ”¾çš„é«˜åº¦</span></span><br><span class="line">            arr[minIndex] += childrens[i].offsetHeight; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™æ˜¯å¤–å±‚å®¹å™¨</span></span><br><span class="line"><span class="keyword">let</span> bigbox = <span class="built_in">document</span>.querySelector(<span class="string">".box"</span>);</span><br><span class="line"><span class="comment">//è¿™æ˜¯æ‰€æœ‰å›¾ç‰‡</span></span><br><span class="line"><span class="keyword">let</span> smallbox = <span class="built_in">document</span>.querySelectorAll(<span class="string">".sbox"</span>);</span><br><span class="line"></span><br><span class="line">waterfull(bigbox,smallbox);</span><br></pre></td></tr></table></figure><p>OKæå®šï¼Œä¸‹æ¬¡é‡åˆ°ä½¿ç”¨ç€‘å¸ƒæµçš„åœ°æ–¹åªè¦è°ƒç”¨<code>waterfull()</code>å‡½æ•°ï¼ŒæŠŠå›¾ç‰‡çš„å¤–å±‚å®¹å™¨ï¼Œå’Œè£…ç€æ‰€æœ‰å›¾ç‰‡çš„æ•°ç»„ä¼ è¿›å»å³å¯ï¼</p>]]></content>
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> javascript </category>
          
          <category> ç‰¹æ•ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> javascript </tag>
            
            <tag> ç‰¹æ•ˆ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>jsä¸­çš„åŸå‹é“¾ï¼Œprototypeå’Œå’Œ_proto_çš„å…³ç³»</title>
      <link href="/blog/2018/08/19/js%E4%B8%AD%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%EF%BC%8Cprototype%E5%92%8C%E5%92%8C-proto-%E7%9A%84%E5%85%B3%E7%B3%BB/"/>
      <url>/blog/2018/08/19/js%E4%B8%AD%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%EF%BC%8Cprototype%E5%92%8C%E5%92%8C-proto-%E7%9A%84%E5%85%B3%E7%B3%BB/</url>
      <content type="html"><![CDATA[<p>åŸå‹é“¾æ˜¯å®ç°ç»§æ‰¿çš„ä¸»è¦æ–¹å¼ï¼Œå…¶åŸºæœ¬æ€æƒ³å°±æ˜¯åˆ©ç”¨åŸå‹é“¾è®©ä¸€ä¸ªå¼•ç”¨ç±»å‹ç»§æ‰¿å¦ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å±æ€§å’Œæ–¹æ³•ï¼›ä¸¾ä¸ªæ —å­<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125;;</span><br><span class="line">Person.prototype.Say = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Person say"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Man = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">Man.prototype = <span class="keyword">new</span> Person();<span class="comment">//è¿™å¥æ˜¯é‡ç‚¹</span></span><br><span class="line"><span class="keyword">var</span> man = <span class="keyword">new</span> Man();</span><br><span class="line">man.Say();  <span class="comment">//Person say</span></span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆ<code>Man.prototype = new Person();</code>è¿™å¥è¯æ˜¯å¦‚ä½•å®ç°ç»§æ‰¿çš„å‘¢ï¼Ÿåœ¨å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹<code>new</code>çš„è¿‡ç¨‹ä¸­çš„å‘ç”Ÿäº†ä»€ä¹ˆï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">'hrh'</span>;</span><br><span class="line">    <span class="keyword">this</span>.age = <span class="number">21</span>;</span><br><span class="line">&#125;;</span><br><span class="line">Person.prototype.Say = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Person say"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person();</span><br><span class="line">p.Say();</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬å¯ä»¥æŠŠnewçš„è¿‡ç¨‹æ‹†åˆ†æˆä»¥ä¸‹å‡ æ­¥ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡</li><li>å°†æ„é€ å‡½æ•°çš„ä½œç”¨åŸŸèµ‹ç»™æ–°å¯¹è±¡ </li><li>å°†æ–°å¯¹è±¡çš„<strong>proto</strong>å±æ€§æŒ‡å‘æ„é€ å‡½æ•°çš„prototype</li><li>æ‰§è¡Œæ„é€ å‡½æ•°ä¸­çš„ä»£ç </li><li>è¿”å›åˆ›å»ºçš„æ–°å¯¹è±¡ </li></ul><p>æ‰€ä»¥å¯¹äºä¸Šè¾¹çš„æ„é€ å‡½æ•°ï¼Œåœ¨<code>new</code>çš„è¿‡ç¨‹ä¸­ï¼Œå¼•æ“åœ¨åº•å±‚ç»™ä½ è¿™ä¹ˆå¹²äº†ğŸ‘‡<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">let</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŠŠæ„é€ å‡½æ•°çš„ä½œç”¨åŸŸèµ‹ç»™æ–°å¯¹è±¡</span></span><br><span class="line">    Person.call(obj);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†æ–°å¯¹è±¡çš„__proto__å±æ€§æŒ‡å‘æ„é€ å‡½æ•°çš„prototype</span></span><br><span class="line">    obj.__proto__ = Person.prototype;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰§è¡Œæ„é€ å‡½æ•°ä¸­çš„ä»£ç </span></span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">'hrh'</span>;</span><br><span class="line">    <span class="keyword">this</span>.age = <span class="number">21</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›æ–°åˆ›å»ºçš„å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å…¶å®æ¯ä¸ªå¯¹è±¡çš„å†…éƒ¨éƒ½æœ‰ä¸€ä¸ª<em>proto</em>å±æ€§ï¼Œåœ¨<code>new</code>çš„è¿‡ç¨‹ä¸­ï¼Œå®ä¾‹å¯¹è±¡<code>p</code>å†…éƒ¨çš„<strong>proto</strong>å±æ€§å°±ä¼šæŒ‡å‘æ„é€ å‡½æ•°å†…éƒ¨çš„prototypeå±æ€§,å½“è°ƒç”¨<code>p.Say()</code>æ–¹æ³•æ—¶ï¼Œä¼šå…ˆå»på†…éƒ¨æ‰¾<code>Say()</code>æ–¹æ³•ï¼Œå¦‚æœæ‰¾ä¸åˆ°åˆ™ä¼šå»æ‰¾<em>proto</em>å¯¹è±¡ï¼Œè€Œæ­¤æ—¶çš„<em>proto</em>å¯¹è±¡æ­£æŒ‡å‘æ„é€ å‡½æ•°çš„prototypeå¯¹è±¡,æ‰€æœ‰å°±ä¼šå»æ„é€ å‡½æ•°å†…éƒ¨çš„prototypeå¯¹è±¡å†…éƒ¨æ‰¾ï¼›<br>è¿™ç‚¹æ˜ç™½ä»¥åæˆ‘ä»¬å†å›å»çœ‹å¼€å¤´é‚£ä¸ªæ —å­,<code>var p = new Person();</code>è¿™å¥è¯ï¼Œåˆšæ‰æˆ‘ä»¬è¯´på†…éƒ¨çš„<em>proto</em>å±æ€§ä¼šæŒ‡å‘æ„é€ å‡½æ•°å†…éƒ¨çš„prototypeå±æ€§ï¼Œç±»æ¯”ä¸€ä¸‹ï¼Œé‚£ä¹ˆ<code>Man.prototype = new Person();</code>è¿™å¥è¯å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿæ²¡é”™Man.prototypeå†…éƒ¨çš„<em>proto</em>å±æ€§ä¼šæŒ‡å‘çˆ¶ç±»æ„é€ å‡½æ•°å†…éƒ¨çš„prototypeå¯¹è±¡ï¼›</p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>å‰é¢è¯´è¿‡æ¯ä¸ªå¯¹è±¡çš„å†…éƒ¨éƒ½æœ‰ä¸€ä¸ª<em>proto</em>å¯¹è±¡ï¼Œå½“æˆ‘ä»¬è°ƒç”¨man.Say()æ–¹æ³•æ—¶ï¼Œä¼šå…ˆå»manå†…éƒ¨æ‰¾ï¼Œmanå†…éƒ¨æ‰¾ä¸åˆ°å°±å›å»æ‰¾å†…éƒ¨çš„<em>proto</em>å¯¹è±¡ï¼Œ<em>proto</em>å¯¹è±¡æŒ‡å‘Man.prototype,å†åœ¨è¿™é‡Œé¢æ‰¾ï¼Œè¿˜æ‰¾ä¸åˆ°ï¼Œå†æ‰¾<em>proto</em>(Man.prototypeå†…éƒ¨çš„),è€Œæ­¤æ—¶Man.prototypeå†…éƒ¨çš„<em>proto</em>å±æ€§æ­£æŒ‡å‘çˆ¶ç±»çš„æ„é€ å‡½æ•°çš„prototypeï¼Œå†ç»§ç»­å¯»æ‰¾ä¸‹å»ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ï¼Œå¦‚æœä¸€ç›´æ‰¾ä¸åˆ°å‘¢ï¼Ÿé“¾æ¡çš„é¡¶éƒ¨å°±æ˜¯<code>Object.prototype</code>(Object.prototypeä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ—¢ç„¶æ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯é€šè¿‡Objectæ„é€ å‡½æ•°åˆ›å»ºå‡ºæ¥çš„ï¼Œé‚£ä¹ˆç»“åˆä¸Šé¢è®²çš„ï¼Œobject.prototypeå†…éƒ¨ä¹Ÿæœ‰ä¸ªæŒ‡å‘æ„é€ å‡½æ•°çš„protoå±æ€§),è€Œ<code>Object.prototype</code>å†…éƒ¨çš„<code>proto</code>å±æ€§ä¸º<code>null</code>ï¼›<br><figure class="image-box">                <img src="1.png" alt="[]" title="" class="">                <p>[]</p>            </figure></p><p><strong>è¿™ä¹Ÿå°±æ˜¯åŸå‹é“¾çš„å®ç°åŸç†ã€‚æœ€åï¼Œå…¶å®prototypeåªæ˜¯ä¸€ä¸ªå‡è±¡ï¼Œä»–åœ¨å®ç°åŸå‹é“¾ä¸­åªæ˜¯èµ·åˆ°äº†ä¸€ä¸ªè¾…åŠ©ä½œç”¨ï¼Œæ¢å¥è¯è¯´ï¼Œä»–åªæ˜¯åœ¨newçš„æ—¶å€™æœ‰ç€ä¸€å®šçš„ä»·å€¼ï¼Œè€ŒåŸå‹é“¾çš„æœ¬è´¨ï¼Œå…¶å®åœ¨äº<strong>proto</strong>ï¼</strong></p><blockquote><p><strong>proto</strong>ã€prototypeå‚»å‚»åˆ†ä¸æ¸…æ¥šï¼Ÿ è®°ä½ä»¥ä¸‹ä¸¤ç‚¹:<br><strong>proto</strong>æ˜¯æ¯ä¸ªå¯¹è±¡éƒ½æœ‰çš„ä¸€ä¸ªå±æ€§ï¼Œè€Œprototypeæ˜¯å‡½æ•°æ‰ä¼šæœ‰çš„å±æ€§ã€‚<br><strong>proto</strong>æŒ‡å‘çš„æ˜¯å½“å‰å¯¹è±¡çš„åŸå‹å¯¹è±¡ï¼Œè€ŒprototypeæŒ‡å‘çš„ï¼Œæ˜¯ä»¥å½“å‰å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°æ„é€ å‡ºæ¥çš„å¯¹è±¡çš„åŸå‹å¯¹è±¡;</p></blockquote>]]></content>
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ES6è¯­æ³•ä¹‹ç®­å¤´å‡½æ•°</title>
      <link href="/blog/2018/08/14/ES6%E8%AF%AD%E6%B3%95%E4%B9%8B%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0/"/>
      <url>/blog/2018/08/14/ES6%E8%AF%AD%E6%B3%95%E4%B9%8B%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0/</url>
      <content type="html"><![CDATA[<p>  ä½¿ç”¨ES6ç®­å¤´å‡½æ•°ä¹Ÿæœ‰ä¸€å°æ®µæ—¶é—´äº†ï¼Œè™½ç„¶ç”¨èµ·æ¥ç‰¹åˆ«ç®€æ´å’Œæ–¹ä¾¿ï¼Œä½†æ˜¯é‡Œé¢çš„ä¸€äº›é›·åŒºè€æ˜¯è¸©åˆ°ï¼Œä»Šå¤©åˆç³»ç»Ÿçš„å­¦ä¹ äº†ä¸€ä¸‹ï¼Œè¿™ç¯‡ç¬”è®°ä¸»è¦è®°å½•ç®­å¤´å‡½æ•°é‡Œçš„thisæŒ‡å‘é—®é¢˜è¿˜æœ‰ç®­å¤´å‡½æ•°çš„ä½¿ç”¨ç¦åŒºï¼Œä¹Ÿæ–¹ä¾¿ä»¥åæŸ¥é˜…å’Œå¤ä¹ ï¼›</p><hr><h1 id="ç®­å¤´å‡½æ•°ä½¿ç”¨æ³¨æ„ç‚¹"><a href="#ç®­å¤´å‡½æ•°ä½¿ç”¨æ³¨æ„ç‚¹" class="headerlink" title="ç®­å¤´å‡½æ•°ä½¿ç”¨æ³¨æ„ç‚¹"></a>ç®­å¤´å‡½æ•°ä½¿ç”¨æ³¨æ„ç‚¹</h1>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å‡½æ•°ä½“å†…çš„<span class="keyword">this</span>å¯¹è±¡ï¼Œå°±æ˜¯å®šä¹‰æ—¶æ‰€åœ¨çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ—¶æ‰€åœ¨çš„å¯¹è±¡ã€‚</span><br><span class="line">ä¸å¯ä»¥å½“ä½œæ„é€ å‡½æ•°ï¼ˆå†…éƒ¨æ²¡æœ‰<span class="keyword">this</span>æŒ‡é’ˆï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯ä»¥ä½¿ç”¨<span class="keyword">new</span>å‘½ä»¤ã€‚</span><br><span class="line">ä¸å¯ä»¥ä½¿ç”¨<span class="built_in">arguments</span>å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åœ¨å‡½æ•°ä½“å†…ä¸å­˜åœ¨ã€‚å¦‚æœè¦ç”¨ï¼Œå¯ä»¥ç”¨restå‚æ•°ä»£æ›¿ã€‚</span><br><span class="line">ä¸å¯ä»¥ä½¿ç”¨<span class="keyword">yield</span>å‘½ä»¤ï¼Œå› æ­¤ç®­å¤´å‡½æ•°ä¸èƒ½ç”¨ä½œGeneratorå‡½æ•°ã€‚</span><br></pre></td></tr></table></figure><p>ä»Šå¤©é‡ç‚¹æ¥è®°å½•ä¸€ä¸‹ç¬¬ä¸€æ¡ã€‚</p><h2 id="å…³äºthiså¯¹è±¡"><a href="#å…³äºthiså¯¹è±¡" class="headerlink" title="å…³äºthiså¯¹è±¡"></a>å…³äºthiså¯¹è±¡</h2><p>å…ˆæ¥çœ‹ä¸‹ES5ä¸­çš„thiså¯¹è±¡<code>jsé«˜çº§ç¨‹åºè®¾è®¡ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰</code>é‡Œæœ‰è¿™ä¹ˆä¸ªä¾‹å­<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">"The Window"</span>;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    name: <span class="string">"My obj"</span>,</span><br><span class="line">        getNameFunc :<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj.getNameFunc()()); <span class="comment">// The Window</span></span><br></pre></td></tr></table></figure></p><p>æœ‰äººä¼šè®¤ä¸ºè¾“å‡ºâ€œMy objâ€,ä½†å…¶å®äº‹å®æ˜¯ï¼šæ¯ä¸ªå‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶éƒ½ä¼šè‡ªåŠ¨è·å¾—ä¸¤ä¸ªç‰¹æ®Šå˜é‡ï¼š<code>this</code>å’Œ<code>arguments</code>ï¼Œå†…éƒ¨å‡½æ•°åœ¨æœç´¢è¿™ä¸¤ä¸ªå˜é‡æ—¶åªä¼šæœç´¢åˆ°å…¶æ´»åŠ¨å˜é‡ä¸ºæ­¢,å†…éƒ¨å‡½æ•°çš„æ´»åŠ¨å˜é‡åªåŒ…æ‹¬è‡ªèº«æ´»åŠ¨å¯¹è±¡,å¤–éƒ¨å‡½æ•°<code>getNameFunc</code>çš„æ´»åŠ¨å¯¹è±¡å’Œå…¨å±€å˜é‡å¯¹è±¡,ä¸åŒ…æ‹¬objçš„ï¼Œå› æ­¤æ°¸è¿œä¸å¯èƒ½ç›´æ¥è®¿é—®å¤–éƒ¨å‡½æ•°çš„è¿™ä¸¤ä¸ªå˜é‡;</p><p><strong>çœ‹ä¸€ä¸‹ä¹¦ä¸Šçš„è§£å†³æ–¹æ¡ˆ</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">"The Window"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    name: <span class="string">"My obj"</span>,</span><br><span class="line">        getNameFunc :<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> that.name</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(obj.getNameFunc()()); <span class="comment">// My obj,</span></span><br></pre></td></tr></table></figure></p><p>é€šè¿‡ç¼“å­˜thisï¼Œå°±å¯ä»¥æ‹¿åˆ°æœŸå¾…çš„ç»“æœã€‚ä½†æ˜¯è¿™æ ·ç¡®å®æœ‰ç‚¹éº»çƒ¦ï¼Œç®­å¤´å‡½æ•°ä¾¿å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼›<br>çœ‹ä¸‹é¢æ —å­<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">"The Window"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    name: <span class="string">"My obj"</span>,</span><br><span class="line">        getNameFunc :<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(obj.getNameFunc()()); <span class="comment">// My obj,</span></span><br></pre></td></tr></table></figure></p><p>ç”¨ç®­å¤´å‡½æ•°ä¸ºä»€ä¹ˆå¯ä»¥è§£å†³å‘¢ï¼Ÿå…¶å®ç®­å¤´å‡½æ•°å†…éƒ¨æ˜¯ä¸ç»‘å®šthisçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒ<strong>æ ¹æœ¬æ²¡æœ‰è‡ªå·±çš„this</strong>ï¼Œå®ƒå†…éƒ¨çš„thiså°±æ˜¯å¤–å±‚ä»£ç å—çš„thisï¼›</p><p><strong>å°ç»“</strong></p><blockquote><p>ç®­å¤´å‡½æ•°ä¸­æ²¡æœ‰thisï¼Œåœ¨ç®­å¤´å‡½æ•°å†…éƒ¨ä½¿ç”¨thisï¼Œæ˜¯ä½¿ç”¨çš„å¤–å±‚ä»£ç å—çš„thisã€‚</p></blockquote><hr><h1 id="ç®­å¤´å‡½æ•°ä½¿ç”¨ç¦å¿Œ"><a href="#ç®­å¤´å‡½æ•°ä½¿ç”¨ç¦å¿Œ" class="headerlink" title="ç®­å¤´å‡½æ•°ä½¿ç”¨ç¦å¿Œ"></a>ç®­å¤´å‡½æ•°ä½¿ç”¨ç¦å¿Œ</h1><h2 id="å¯¹è±¡å­—é¢é‡ä¸­ä½¿ç”¨"><a href="#å¯¹è±¡å­—é¢é‡ä¸­ä½¿ç”¨" class="headerlink" title="å¯¹è±¡å­—é¢é‡ä¸­ä½¿ç”¨"></a>å¯¹è±¡å­—é¢é‡ä¸­ä½¿ç”¨</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = &#123;</span><br><span class="line">    array: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    sum: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span> === <span class="built_in">window</span>); <span class="comment">// true</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.array.reduce(<span class="function">(<span class="params">result, item</span>) =&gt;</span> result + item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">foo.sum(); <span class="comment">// Throws"TypeError: Cannot read property 'reduce' of undefined"</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæ —å­ä¸­ï¼Œthisæ˜¯å–ä¸åˆ°arrayçš„ï¼Œä¸Šé¢å’±ä»¬è¯´è¿‡ç®­å¤´å‡½æ•°å†…éƒ¨çš„thiså°±æ˜¯å¤–å±‚ä»£ç å—çš„thisï¼Œæœ‰äººä¼šæƒ³ï¼Œå¤–å±‚ä»£ç å—è¿™ä¸æ˜¯<code>foo</code>ä¹ˆï¼Œæ€ä¹ˆå–ä¸åˆ°äº†ï¼Œè¿™é‡Œæœ‰ä¸ªæ³¨æ„ç‚¹ï¼š<strong>å¯¹è±¡çš„ä¸€å¯¹å¤§æ‹¬å·æ˜¯æ„ä¸æˆä»£ç å—çš„</strong>ï¼Œæ‰€ä»¥å¤–å±‚ä»£ç å—çš„thiså°±æ˜¯windowï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆï¼ˆthis===windowï¼‰æ‰“å°<code>true</code>çš„åŸå› ï¼Œè¦æƒ³å–åˆ°arrayçš„è¯åªèƒ½ä¹–ä¹–ä½¿ç”¨ä¼ ç»Ÿ<code>function</code>äº†ï¼›</p><h2 id="åœ¨å¯¹è±¡åŸå‹ä¸­ä½¿ç”¨"><a href="#åœ¨å¯¹è±¡åŸå‹ä¸­ä½¿ç”¨" class="headerlink" title="åœ¨å¯¹è±¡åŸå‹ä¸­ä½¿ç”¨"></a>åœ¨å¯¹è±¡åŸå‹ä¸­ä½¿ç”¨</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params">name</span>) </span>&#123;  </span><br><span class="line">  <span class="keyword">this</span>.Name = name;</span><br><span class="line">&#125;</span><br><span class="line">Dog.prototype.sayName = <span class="function"><span class="params">()</span> =&gt;</span> &#123;  </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span> === <span class="built_in">window</span>); <span class="comment">// =&gt; true</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.Name;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> Dog(<span class="string">'wc'</span>);  </span><br><span class="line">cat.sayName(); <span class="comment">// =&gt; undefined</span></span><br></pre></td></tr></table></figure><p>åŸç†åŒä¸Šï¼Œè¿™é‡Œçš„thisåŒæ ·æŒ‡å‘windowï¼Œä½¿ç”¨ä¼ ç»Ÿæ–¹å¼å³å¯æ­£å¸¸å·¥ä½œ</p><h2 id="å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨"><a href="#å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨" class="headerlink" title="å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨"></a>å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨</h2><p>åœ¨domå…ƒç´ ä¸Šç»‘å®šäº‹ä»¶ç›‘å¬å‡½æ•°æ˜¯éå¸¸æ™®éçš„è¡Œä¸ºï¼Œåœ¨domäº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œå›è°ƒå‡½æ•°ä¸­çš„thisæŒ‡å‘è¯¥dom,å¯å½“æˆ‘ä»¬ä½¿ç”¨ç®­å¤´å‡½æ•°æ—¶ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">button.addEventListener(<span class="string">'click'</span>, () =&gt; &#123;  </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span> === <span class="built_in">window</span>); <span class="comment">// =&gt; true</span></span><br><span class="line">    <span class="keyword">this</span>.innerHTML = <span class="string">'Clicked button'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><blockquote><p>æ¯«æ— ç–‘é—®ï¼Œç®­å¤´å‡½æ•°æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„ç‰¹æ€§,ä½†æœ‰ä¸€äº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨ç®­å¤´å‡½æ•°ä¹Ÿæœ‰ä¸€äº›ä¸ä¾¿ï¼Œä¸èƒ½åœ¨å¯¹è±¡å­—é¢é‡ä¸­ä½¿ç”¨ï¼Œä¸èƒ½å†å¯¹è±¡åŸå‹ä¸­ä½¿ç”¨ï¼Œä¸èƒ½ç”¨ä½œå›è°ƒå‡½æ•°ï¼Œå†…éƒ¨æ²¡æœ‰thisä¸èƒ½ç”¨ä½œæ„é€ å‡½æ•°ç­‰ç­‰ã€‚</p></blockquote>]]></content>
      
      <categories>
          
          <category> ç¬”è®° </category>
          
          <category> ES6è¯­æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
            <tag> ES6è¯­æ³• </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Hexo+Codingæ­å»ºä¸ªäººåšå®¢åŠç»‘å®šä¸ªäººåŸŸå</title>
      <link href="/blog/2018/08/11/Hexo-Coding%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E5%8F%8A%E7%BB%91%E5%AE%9A%E5%9F%9F%E5%90%8D/"/>
      <url>/blog/2018/08/11/Hexo-Coding%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E5%8F%8A%E7%BB%91%E5%AE%9A%E5%9F%9F%E5%90%8D/</url>
      <content type="html"><![CDATA[<p>å…³äºè¿™ä¸ªä¸»é¢˜<a href="https://hexo.io/zh-cn/docs/index.html" target="_blank" rel="noopener">hexoå®˜æ–¹æ–‡æ¡£</a>ä¸Šè¯´çš„å¾ˆè¯¦ç»†ï¼Œä½†è¿˜æ˜¯å¾ˆéš¾ä»…é€šè¿‡ä¸€ç¯‡æ–‡ç« å°±èƒ½è¿‡ä¸€å£æ°”å®Œç¾æ­å»ºï¼Œä¸­é—´è¿˜æ˜¯è¸©åˆ°ä¸å°‘é›·ï¼ˆä¸€æŠŠè¾›é…¸æ³ªï¼‰ï¼Œæ‰€ä»¥è¿˜æ˜¯æƒ³æ‹¿è¿™ç¯‡æ–‡ç« æ¥è®°å½•ä¸‹ã€‚<br><a id="more"></a></p><hr><h1 id="æŠ€æœ¯åšå®¢çš„é€‰æ‹©"><a href="#æŠ€æœ¯åšå®¢çš„é€‰æ‹©" class="headerlink" title="æŠ€æœ¯åšå®¢çš„é€‰æ‹©"></a>æŠ€æœ¯åšå®¢çš„é€‰æ‹©</h1><p>ç°åœ¨ç½‘ä¸Šå¾ˆå¤šçš„æ•™ç¨‹éƒ½æ˜¯åŸºäº<strong>hexo+github</strong>çš„ï¼ŒåŒ…æ‹¬æˆ‘ä¹‹å‰ä¹Ÿæ˜¯æ‰˜ç®¡åœ¨Github Pagesä¸Šé¢ï¼Œä½†æ˜¯ç”±äºæ˜¯å›½å¤–æœåŠ¡å™¨æ‰€ä»¥è®¿é—®èµ·æ¥æœ‰ç‚¹æ…¢ï¼ˆå…¶å®ç›¸å½“æ…¢ï¼Œæˆ‘ä¼šçè¯´ï¼Ÿï¼‰äºæ˜¯æœcodingæŠ•æ€€é€æŠ±ï¼Œæ”¯æŒä¸‹å›½äº§ã€‚</p><h1 id="å®‰è£…å¿…è¦ä¾èµ–"><a href="#å®‰è£…å¿…è¦ä¾èµ–" class="headerlink" title="å®‰è£…å¿…è¦ä¾èµ–"></a>å®‰è£…å¿…è¦ä¾èµ–</h1><p>è¿™ä¸¤ä¸ªç¯å¢ƒç›´æ¥ä¸‹è½½å®‰è£…å°±è¡Œäº†ï¼Œåº”è¯¥ä¸ä¼šæœ‰ä»€ä¹ˆå¤§é—®é¢˜</p><ul><li><a href="https://nodejs.org/en/" target="_blank" rel="noopener">Node.js</a></li><li><a href="https://gitforwindows.org/" target="_blank" rel="noopener">Git</a></li></ul><h1 id="Hexoå®‰è£…"><a href="#Hexoå®‰è£…" class="headerlink" title="Hexoå®‰è£…"></a>Hexoå®‰è£…</h1><p>å®‰è£…å¥½gitä»¥åŠnode.jsä¹‹åï¼Œåœ¨ç”µè„‘çš„ä»»æ„ç›˜é‡Œæ–°å»ºä¸€ä¸ªç©ºæ–‡ä»¶å¤¹ï¼Œå‘½åéšæ„(æ¯”å¦‚<code>blog</code>)ï¼Œæœ€å¥½æ˜¯çº¯è‹±æ–‡ã€‚ç„¶åæ‰“å¼€è¿™ä¸ªç©ºæ–‡ä»¶å¤¹ï¼Œé¼ æ ‡å³é”®é€‰æ‹©Git Bashã€‚</p><p>è¾“å…¥ä»¥ä¸‹ä¸€ä¸‹å‘½ä»¤å®‰è£…Hexo<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo -g</span><br><span class="line">å¯èƒ½ä¼šå®‰è£…å¤±è´¥ï¼ˆè¿™æ˜¯æˆ‘é‡åˆ°çš„ç¬¬ä¸€ä¸ªå‘ï¼‰ï¼Œå®‰è£…å¤±è´¥é€‰æ‹©ä¸‹è¾¹è¿™ç§æ–¹å¼(æ·˜å®æºå®‰è£…):</span><br><span class="line">npm install -g cnpm --registry=https:<span class="comment">//registry.npm.taobao.org</span></span><br><span class="line">cnpm install hexo-cli -g</span><br><span class="line">Hexoå®‰è£…å®Œæˆä¹‹åï¼Œè¾“å…¥ä¸‹é¢æŒ‡ä»¤åˆå§‹åŒ–Hexo</span><br><span class="line">hexo init</span><br></pre></td></tr></table></figure></p><h1 id="æœ¬åœ°è¿è¡Œ"><a href="#æœ¬åœ°è¿è¡Œ" class="headerlink" title="æœ¬åœ°è¿è¡Œ"></a>æœ¬åœ°è¿è¡Œ</h1><p>åœ¨ä½ åˆšæ‰æ–°å»ºçš„ç©ºæ–‡ä»¶å¤¹ï¼ˆblogï¼‰ä¸‹å³é”®é€‰æ‹©<code>Git Bash</code><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean # æ¸…é™¤å†å²ç”Ÿæˆçš„é™æ€æ–‡ä»¶</span><br><span class="line">hexo generate # ç”Ÿæˆé™æ€æ–‡ä»¶(ç®€å†™ï¼šhexo g)</span><br><span class="line">hexo server # å¯åŠ¨æœ¬åœ°æœåŠ¡(ç®€å†™: hexo s)</span><br></pre></td></tr></table></figure></p><p> ä¸€é¡¿æ“ä½œçŒ›å¦‚è™ä»¥åï¼Œçœ‹åˆ°ä¸‹é¢è¿™æ¡æŒ‡ä»¤ï¼Œä»£è¡¨æœåŠ¡å¼€å¯æˆåŠŸï¼Œ<em>æµè§ˆå™¨ä¸­è¾“å…¥ä»¥ä¸‹ç½‘ç«™</em>å°±å¯ä»¥çœ‹åˆ°åˆšåˆšæ­å»ºçš„é™æ€ç½‘é¡µã€‚<br> <code>INFO  Start processing</code><br><code>INFO  Hexo is running at http://localhost:4000/. Press Ctrl+C to stop.</code></p><h1 id="Coding-pages-è®¾ç½®"><a href="#Coding-pages-è®¾ç½®" class="headerlink" title="Coding pages è®¾ç½®"></a>Coding pages è®¾ç½®</h1><p>ç°åœ¨æˆ‘ä»¬å·²ç»åœ¨æœ¬åœ°æ­å»ºå¥½äº†æˆ‘ä»¬çš„åšå®¢ï¼Œéº»æºœå„¿éƒ¨ç½²èµ·æ¥è®©å¤§å®¶çœ‹åˆ°ã€‚</p><p>å…ˆæ‰“å¼€<a href="https://coding.net/" target="_blank" rel="noopener">coding</a>,å³ä¸Šè§’æ³¨å†Œä¸€ä¸‹ã€‚</p><h2 id="åˆ›å»ºä¸€ä¸ªæ–°ä»“åº“"><a href="#åˆ›å»ºä¸€ä¸ªæ–°ä»“åº“" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæ–°ä»“åº“"></a>åˆ›å»ºä¸€ä¸ªæ–°ä»“åº“</h2><figure class="image-box">                <img src="0.png" alt="[ åˆ›å»ºæ–°ä»“åº“ ]" title="" class="">                <p>[ åˆ›å»ºæ–°ä»“åº“ ]</p>            </figure><p><img src="1.png" alt="[ æ³¨æ„ä»“åº“åçš„æ ¼å¼æ˜¯å›ºå®šçš„ï¼Œç”¨æˆ·å+coding.me ä¸ä¸€è‡´ä¼šå‡ºé”™ ]"></p><h2 id="å¼€å¯é™æ€pages"><a href="#å¼€å¯é™æ€pages" class="headerlink" title="å¼€å¯é™æ€pages"></a>å¼€å¯é™æ€pages</h2><p><img src="2.png" alt="[è¿™æ˜¯å¼€å¯å±•ç¤ºåŠŸèƒ½ ]"></p><h3 id="ç»‘å®šä¸ªäººåŸŸåï¼Œå¦‚æœä¸éœ€è¦å¯ç›´æ¥è·³åˆ°æ·»åŠ éƒ¨ç½²å¯†é’¥"><a href="#ç»‘å®šä¸ªäººåŸŸåï¼Œå¦‚æœä¸éœ€è¦å¯ç›´æ¥è·³åˆ°æ·»åŠ éƒ¨ç½²å¯†é’¥" class="headerlink" title="ç»‘å®šä¸ªäººåŸŸåï¼Œå¦‚æœä¸éœ€è¦å¯ç›´æ¥è·³åˆ°æ·»åŠ éƒ¨ç½²å¯†é’¥"></a>ç»‘å®šä¸ªäººåŸŸåï¼Œå¦‚æœä¸éœ€è¦å¯ç›´æ¥è·³åˆ°æ·»åŠ éƒ¨ç½²å¯†é’¥</h3><figure class="image-box">                <img src="3.png" alt="[ç‚¹å‡»è®¾ç½®]" title="" class="">                <p>[ç‚¹å‡»è®¾ç½®]</p>            </figure><figure class="image-box">                <img src="4.png" alt="[å°†ä½ çš„ä¸ªäººåŸŸåè¾“å…¥ ]" title="" class="">                <p>[å°†ä½ çš„ä¸ªäººåŸŸåè¾“å…¥ ]</p>            </figure><blockquote><p>æ³¨æ„ä¸ªäººåŸŸåçš„è§£æå‚è€ƒ <a href="https://coding.net/help/doc/pages/domain.html" target="_blank" rel="noopener">coding å®˜æ–¹å¸®åŠ©æ–‡æ¡£</a></p></blockquote><h2 id="æ·»åŠ éƒ¨ç½²å¯†é’¥"><a href="#æ·»åŠ éƒ¨ç½²å¯†é’¥" class="headerlink" title="æ·»åŠ éƒ¨ç½²å¯†é’¥"></a>æ·»åŠ éƒ¨ç½²å¯†é’¥</h2><p>æ‰“å¼€<code>Git bash</code>ï¼Œè¾“å…¥<code>ssh-keygen -t rsa -C &quot;897691781@qq.com</code>â€œ,è¿™ä¸ªé‚®ç®±åœ°å€æ¢æˆä½ çš„ã€‚è¿ç»­å››æ¬¡å›è½¦å°±ç”Ÿæˆäº†ä¸€å¯¹å¯†é’¥ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Your identification has been saved <span class="keyword">in</span> /c/Users/éŸ“ä»è¼/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /c/Users/éŸ“ä»è¼/.ssh/id_rsa.pub.</span><br></pre></td></tr></table></figure></p><p>å®ƒä¼šå‘Šè¯‰ä½ å¯†é’¥ç”Ÿæˆåœ¨é‚£ä¸ªæ–‡ä»¶å¤¹,ä¸Šé¢æ˜¯æˆ‘çš„å¯†é’¥ç”Ÿæˆè·¯å¾„ï¼Œä¸‹é¢è¦ç›¸åº”æ›¿æ¢æˆä½ çš„ï¼Œä½¿ç”¨catæ¥æŸ¥çœ‹å…¬é’¥å†…å®¹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /c/Users/éŸ“ä»è¼/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure><p>å¤åˆ¶è¾“å‡ºçš„å†…å®¹ï¼Œæ‰“å¼€<code>coding</code>ä½ åˆšåˆšåˆ›å»ºçš„é¡¹ç›®ï¼Œç‚¹å‡»é¡µé¢å·¦ä¾§è®¾ç½®é‡Œçš„éƒ¨ç½²å…¬é’¥ï¼Œç‚¹å‡»æ–°å»ºå…¬é’¥ï¼ŒæŠŠä½ åˆšåˆšå¤åˆ¶çš„å†…å®¹ç²˜è´´è¿›å»å°±å¯ä»¥äº†ã€‚</p><h1 id="gitéƒ¨ç½²é™æ€ç•Œé¢"><a href="#gitéƒ¨ç½²é™æ€ç•Œé¢" class="headerlink" title="gitéƒ¨ç½²é™æ€ç•Œé¢"></a>gitéƒ¨ç½²é™æ€ç•Œé¢</h1><p>é€šè¿‡gitå°†ä½ çš„é™æ€é¡µé¢pushåˆ°ä½ åˆšåˆšåˆ›å»ºçš„coding pagesä¸Šå»</p><p>è¿˜æ˜¯åœ¨<code>blog</code>æ ¹ç›®å½•ä¸‹ï¼Œå³é”®<code>Git Bash</code>ï¼Œè¾“å…¥ä»¥ä¸‹æŒ‡ä»¤å®‰è£…ä¸€ä¸ªhexoçš„éƒ¨ç½²å·¥å…·<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure></p><p>å®‰è£…å®Œæˆä»¥åï¼Œéœ€è¦é…ç½®éƒ¨ç½²è·¯å¾„ï¼Œæ‰“å¼€blogæ–‡ä»¶å¤¹ä¸‹çš„<code>_config.yml</code>ï¼ˆæ‰“å¼€æ–¹å¼åˆ«é€‰è®°äº‹æœ¬ï¼Œç¼–ç ä¸æ”¯æŒä¸­æ–‡ï¼‰ï¼Œä¸‹æ»‘æ‰¾åˆ°<code>deploy:</code>ï¼Œå°†deployä¿®æ”¹ä¸º<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy: </span><br><span class="line">  type: git</span><br><span class="line">  repo:  git@git.coding.net:HanRenHui/HanRenHui.coding.me.git #æ³¨æ„å°†ç”¨æˆ·åæ¢ä¸ºä½ è‡ªå·±çš„</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure></p><p>åˆ«å¿˜è®°<code>ctril+s</code>ä¿å­˜ä¸€ä¸‹ï¼Œè¿˜æ˜¯åœ¨<code>blog/</code>ç›®å½•ä¸‹ï¼Œç”¨hexoå‘½ä»¤å®Œæˆæœ€ç»ˆéƒ¨ç½²ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br><span class="line"># 2 3å¯ä»¥ç®€å†™ä¸º hexo g -d</span><br></pre></td></tr></table></figure></p><p>æ­å–œï¼Œæ‰“å¼€æµè§ˆå™¨åœ¨åœ°å€æ è¾“å…¥ç”¨æˆ·å.coding.meï¼ˆæœ‰ä¸ªäººåŸŸåç›´æ¥è¾“å…¥ä¸ªäººåŸŸåï¼‰å°±å¯ä»¥è®¿é—®è‡ªå·±çš„åšå®¢å•¦!!!</p>]]></content>
      
      <categories>
          
          <category> æ•™ç¨‹ </category>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Hello World</title>
      <link href="/blog/2018/08/04/hello-world/"/>
      <url>/blog/2018/08/04/hello-world/</url>
      <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
        <tags>
            
            <tag> Hello World </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
